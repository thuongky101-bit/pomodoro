<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="A Pomodoro application for studying, featuring Gemini AI integration and a modern interface." />
    <title>Pomodoro Study App — Gemini AI Integration (New UI)</title>
    <style>
    /*
    =============================================
    POMODORO STUDY APP — FOCUSED UI VERSION (v1.0)
    =============================================
    */

    :root {
      /* Theme Dark (Default) - Updated from file 2 */
      --bg: #0f1222;
      --panel: #171a2e;
      --panel-rgb: 23, 26, 46; /* Add RGB variable for panel */
      --muted: #212646;
      --text: #f4f6ff;
      --sub: #b7c1ff;
      --acc: #6c8cff;
      --acc-rgb: 108, 140, 255;
      --acc-2: #27d3a2;
      --purple: #a78bfa;
      --warn: #ffb020;
      --danger: #ff5c7a;
      --shadow: 0px 1.8px 2.2px rgba(0, 0, 0, 0.054), 0px 4.3px 5.3px rgba(0, 0, 0, 0.077), 0px 8.1px 10px rgba(0, 0, 0, 0.095), 0px 14.5px 17.9px rgba(0, 0, 0, 0.113), 0px 27.2px 33.4px rgba(0, 0, 0, 0.136), 0px 65px 80px rgba(0, 0, 0, 0.19);
      --radius: 16px;
      --panel-opacity: 0.85;
      --gradient-border: linear-gradient(135deg, var(--acc), var(--acc-2));
    }
    
    /* === START: ADD NEW THEMES === */
    [data-theme='light'] {
      --bg: #f5f0e8; --panel: #ffffff; --panel-rgb: 255, 255, 255; --muted: #eaddcf; --text: #4a4a4a; --sub: #8a817c; --acc: #d4a373; --acc-rgb: 212, 163, 115; --acc-2: #a3b18a; --warn: #e76f51; --danger: #d00000;
      --shadow: 0px 1.8px 2.2px rgba(0, 0, 0, 0.024), 0px 4.3px 5.3px rgba(0, 0, 0, 0.037), 0px 8.1px 10px rgba(0, 0, 0, 0.045), 0px 14.5px 17.9px rgba(0, 0, 0, 0.053), 0px 27.2px 33.4px rgba(0, 0, 0, 0.066), 0px 65px 80px rgba(0, 0, 0, 0.09);
      --panel-opacity: 0.9;
      /* Prevent default dark background when no image */
      --bg-image: none;
    }

    [data-theme='pastel'] {
      --bg: #fde2e4; --panel: #fff1f2; --panel-rgb: 255, 241, 242; --muted: #fad2e1; --text: #595260; --sub: #8c7a8a; --acc: #c78283; --acc-rgb: 199, 130, 131; --acc-2: #7ec4cf; --warn: #f9bf45; --danger: #d7263d;
      --shadow: 0 5px 20px rgba(200,150,150,0.2);
      --panel-opacity: 0.9;
      /* Prevent default dark background when no image */
      --bg-image: none;
    }
    
    [data-theme='lofi'] {
      --bg: #2a2a3e; --panel: #3c3c52; --panel-rgb: 60, 60, 82; --muted: #4d4d66; --text: #e0e0ff; --sub: #a0a0c0; --acc: #ff8c69; --acc-rgb: 255, 140, 105; --acc-2: #69c6ff; --warn: #ffd700; --danger: #ff6961;
      /* === Replaced external GIF with inline data URI (offline-safe) === */
      --bg-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPSc4MDAnIGhlaWdodD0nNjAwJz48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9J2cnIHgxPScwJyB5MT0nMCcgeDI9JzEnIHkyPScxJz48c3RvcCBvZmZzZXQ9JzAlJyBzdG9wLWNvbG9yPScjMmEyYTNlJy8+PHN0b3Agb2Zmc2V0PScxMDAlJyBzdG9wLWNvbG9yPScjM2MzYzUyJy8+PC9saW5lYXJHcmFkaWVudD48L2RlZnM+PHJlY3Qgd2lkdGg9JzEwMCUnIGhlaWdodD0nMTAwJScgZmlsbD0ndXJsKCNnKScvPjwvc3ZnPg==');
      --panel-opacity: 0.8;
    }
    
    [data-theme='space'] {
        --bg: #000000; --panel: #1a1a2e; --panel-rgb: 26, 26, 46; --muted: #2a2a4e; --text: #e0e0ff; --sub: #b0b0e0; --acc: #00aaff; --acc-rgb: 0, 170, 255; --acc-2: #aaff00; --warn: #ffaa00; --danger: #ff0055;
        /* === Replaced external GIF with inline data URI (offline-safe) === */
        --bg-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPSc4MDAnIGhlaWdodD0nNjAwJz48ZGVmcz48cmFkaWFsR3JhZGllbnQgaWQ9J2cnIGN4PSc1MCUnIGN5PSc0MCUnIHI9JzcwJSc+PHN0b3Agb2Zmc2V0PScwJScgc3RvcC1jb2xvcj0nIzBiMGIxYScvPjxzdG9wIG9mZnNldD0nMTAwJScgc3RvcC1jb2xvcj0nIzAwMDAwMCcvPjwvcmFkaWFsR3JhZGllbnQ+PC9kZWZzPjxyZWN0IHdpZHRoPScxMDAlJyBoZWlnaHQ9JzEwMCUnIGZpbGw9J3VybCgjZyknLz48L3N2Zz4=');
        --panel-opacity: 0.75;
    }
    /* === END: ADD NEW THEMES === */

    *:focus-visible {
      outline: 2px solid var(--acc); outline-offset: 2px; border-radius: 4px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body {
      margin:0; 
      font-family: system-ui, -apple-system, 'Segoe UI Variable', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Inter', sans-serif; 
      
      background-color: var(--bg);
      background-image: var(--bg-image, radial-gradient(1200px 800px at 10% -10%, #20285b 0%, #0f1222 50%, #0b0e1a 100%));
      
      background-size: cover; 
      background-position: center; 
      color:var(--text); 
      transition: background 0.5s ease, color 0.5s ease, filter 0.5s ease;
      text-shadow: 0px 0px 5px rgba(0, 0, 0, 0.5);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: optimizeLegibility;
    }
    a{color:var(--acc)}

    .app{display:flex; min-height:100vh}
    
    .app-nav {
        width: 60px;
        padding: 16px 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 16px;
        z-index: 100;
    }
    .nav-btn {
        background: transparent;
        border: none;
        color: var(--sub);
        width: 44px;
        height: 44px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all .2s ease;
        position: relative;
    }
    .nav-btn:hover { background: var(--muted); color: var(--text); }
    .nav-btn.active { background: var(--acc); color: white; }
    .nav-btn svg { width: 24px; height: 24px; }
    .nav-btn .tooltip {
        position: absolute;
        left: 110%;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text);
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 12px;
        box-shadow: var(--shadow);
        white-space: nowrap;
        opacity: 0;
        visibility: hidden;
        transition: opacity .2s ease, visibility .2s ease;
        pointer-events: none;
        z-index: 200;
    }
    .nav-btn:hover .tooltip { opacity: 1; visibility: visible; }

    .app-content {
        flex: 1;
        padding: 24px;
        overflow-y: auto;
        max-height: 100vh;
    }

    .view { display: none; }
    .view.active { display: grid; gap: 24px; animation: fadeIn .3s ease; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    .main.reloading { opacity: 0; transition: opacity 0.2s ease-out; }

    .panel-bg{
        background: rgba(23, 26, 46, var(--panel-opacity));
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border:1px solid rgba(255,255,255,.08);
    }
    /* Add border rules for light/pastel themes */
    [data-theme='light'] .panel-bg, [data-theme='pastel'] .panel-bg { border:1px solid rgba(0,0,0,0.05); }
    [data-theme='lofi'] .panel-bg { border:1px solid rgba(255,255,255,0.1); }
    [data-theme='space'] .panel-bg { border:1px solid rgba(255,255,255,0.12); }


header.app-header{display:flex; align-items:center; justify-content:space-between; padding:10px 14px; border-radius:var(--radius); box-shadow:var(--shadow); margin-bottom: 24px; position: relative; z-index: 2000;}
    header .actions{display:flex; gap:8px; align-items:center}
    
    .btn {
      background: rgba(255, 255, 255, 0.08);
      color: var(--text);
      border: none; /* Modified: remove default border */
      padding: 10px 14px;
      border-radius: 12px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: inset 0 -2px 0 rgba(0,0,0,0.08);
      font-weight: 600;
      transition: all .15s ease;
      position: relative;
      overflow: hidden;
    }
    .btn::before {
        content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
        border: 2px solid transparent; border-radius: 12px; background: var(--gradient-border) border-box;
        -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
        -webkit-mask-composite: destination-out; mask-composite: exclude; opacity: 0; transition: opacity 0.3s ease;
    }
    .btn:hover::before { opacity: 1; }
    .btn:hover { background: rgba(255, 255, 255, 0.12); }
    .btn:active { transform: translateY(1px) scale(0.98); filter: brightness(1); }
    .btn:disabled { cursor: not-allowed; filter: brightness(0.8) saturate(0.5); }
    .btn.ghost { background: transparent; border: 1px solid rgba(255, 255, 255, 0.2); }
    .btn.ghost:hover { background: rgba(255, 255, 255, 0.1); border-color: rgba(255, 255, 255, 0.3); }
    .btn.acc { background: var(--acc); color: white; }
    .btn.warn { background: var(--warn); color: white; }
    .btn.danger { background: var(--danger); color: white; }
    .btn.small { padding: 6px 10px; font-size: 14px; border-radius: 9px; }
    .btn.small::before { border-radius: 9px; }
    .btn > svg { width: 16px; height: 16px; stroke-width: 2.5px; }

    /* === START: UPDATE TOPIC MANAGEMENT UI === */
    #view-topics { grid-template-columns: 1fr; }
    .topic-item { background:rgba(255,255,255,.04); border:1px solid var(--muted); border-radius:12px; padding:8px; margin-bottom:8px; } /* Modified */
    .topic-header, .sub-row { display:flex; align-items:center; gap:8px; position: relative; }
    .topic-header { cursor: pointer; }
    .topic-header .topic-actions { cursor: default; }
    .topic-header .topic-actions * { cursor: pointer; }
    .topic-item { cursor: pointer; }
    .topic-item .topic-actions { cursor: default; }
    .topic-item .topic-actions * { cursor: pointer; }
    .topic-title { flex:1; font-weight:600; cursor: pointer; }
    .chev { width:28px; height:28px; border-radius:8px; display:inline-flex; align-items:center; justify-content:center; flex-shrink: 0; cursor: pointer; }
    .chev .ico { display:inline-block; transition: transform .18s ease; }
    .chev[aria-expanded="false"] .ico { transform: rotate(-90deg); }
    .subtopics { margin-top:8px; display:flex; flex-direction:column; gap:6px; }
    .subtopics.hidden { display:none; }
    
    .topic-actions, .sub-row .actions {
        opacity: 0;
        visibility: hidden;
        transition: opacity .2s ease, visibility .2s ease;
        display: flex;
        gap: 6px;
        align-items: center;
    }
    .topic-item:hover .topic-actions, .topic-item:focus-within .topic-actions,
    .sub-row:hover .actions, .sub-row:focus-within .actions {
      opacity: 1;
      visibility: visible;
    }
    .actions-menu-btn {
        padding: 0;
        width: 28px;
        height: 28px;
        font-size: 1.2em;
        line-height: 1;
    }
    .actions-menu {
        position: absolute;
        top: 100%;
        right: 0;
        border-radius: 8px;
        padding: 6px;
        box-shadow: var(--shadow);
        z-index: 10;
        min-width: 150px;
        display: none;
        flex-direction: column;
        gap: 4px;
    }
    /* Raise the open menu block above others */
    .topic-item.menu-active { position: relative; z-index: 20; }
    
    .actions-menu.show { display: flex; }
    .menu-item {
        background: transparent; border: none; color: var(--text);
        padding: 8px 10px; border-radius: 6px; text-align: left;
        width: 100%; cursor: pointer; transition: background .2s ease;
        display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 500;
    }
    .menu-item:hover { background: var(--acc); color: white; }
    .menu-item.danger:hover { background: var(--danger); }
    /* === END: UPDATE TOPIC MANAGEMENT UI === */

    .subtopic-btn{
        flex:1; 
        text-align:left;
        background-color: rgba(0,0,0,0.02); /* Modified */
    }
    .subtopic-btn:hover {
        background-color: transparent; /* Hover transparent to avoid blue background */
    }
    .subtopic-btn.active{
        outline:2px solid var(--acc); 
    }
    .subtopic-btn.active:hover {
        background: transparent; /* Keep background transparent on hover */
    }
    
    .panel{border-radius:var(--radius); padding:24px; box-shadow:var(--shadow)}

    .timer-header { display: flex; justify-content: space-between; align-items: center; gap: 12px; flex-wrap: wrap; }
    .timer{display:grid; gap:16px; grid-template-columns: 1fr; align-items:center; text-align:center}
    .big-time{font-size: clamp(60px, 12vw, 96px); letter-spacing:1px; font-weight:700; color: var(--text)}
    .state{font-weight:700; letter-spacing:.6px}
    .state.work{color:var(--acc-2)} /* Color tweak */
    .state.break{color:var(--warn)}
    .state.long{color:var(--danger)} /* Color tweak */
    .controls{display:flex; flex-wrap:wrap; gap:12px; justify-content:center}    
    #btnStart { padding: 14px 28px; font-size: 1.2em; }
    #btnPause, #btnResume { padding: 12px 24px; font-size: 1.1em; }

    /* === START: SOFTER DIVIDER CUSTOMIZATION === */
    #view-timer .panel-bg hr {
        border: none; /* Remove default border */
        height: 1px;  /* Set divider height */
        background-color: var(--muted); /* Use theme's secondary color */
        opacity: 0.3; /* Make it subtle to blend with background */
        margin-top: 0; /* Adjust spacing */
    }
    /* === END: SOFTER DIVIDER CUSTOMIZATION === */

    .stats-grid{display:grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap:12px}
    .stat-card{background:rgba(255,255,255,0.04); border:1px solid var(--muted); border-radius:14px; padding:12px; text-align:center} /* Modified */
    .stat-card h4{margin:4px 0 8px; color:var(--sub); font-weight:600; font-size: 14px;}
    .stat-value{font-size: 20px; font-weight: 600;}
    .tiny{font-size:12px; color:var(--sub)}
    .history{display:grid; gap:8px; max-height:300px; overflow:auto; padding-right:6px}
    .hist-item{display:grid; grid-template-columns: 1fr auto; gap:10px; align-items:start; background:rgba(255,255,255,0.04); border:1px solid var(--muted); border-radius:10px; padding:10px} /* Modified */

    .row{display:flex; gap:8px; align-items:center}
    .row > * {flex:1}
    input[type="text"], input[type="password"], input[type="number"], select, textarea{width:100%; background:rgba(255,255,255,0.04); color:var(--text); border:1px solid var(--muted); border-radius:10px; padding:10px; outline:none}
    textarea{min-height:80px; resize: vertical;}

    .toasts{position:fixed; right:16px; bottom:16px; display:flex; flex-direction:column; gap:8px; z-index:9999}
    .toast{
        background: var(--panel); /* Modified */
        border:1px solid var(--muted);
        color:var(--text);
        padding:10px 12px; border-radius:12px; box-shadow:var(--shadow);
        animation: toast-in .3s ease; transform-origin: bottom right;
    }
    @keyframes toast-in { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }

    .modal{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background: rgba(0,0,0,var(--panel-opacity)); z-index:10000; backdrop-filter: blur(5px);} /* Raise z-index to sit above header */
    .modal.show{display:flex}
    .modal-card{
        position: relative;
        z-index: 10001;
        width:min(720px, 94vw);
        border-radius:16px;
        padding:16px;
        box-shadow:var(--shadow);
        animation: modal-in .25s ease-out;
        max-height: 90vh;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
    }
    body.modal-open { overflow: hidden; }
    @keyframes modal-in { from { opacity: 0; transform: scale(0.92) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }
    .modal-card h3{margin-top:0}
    .dashboard-table { width: 100%; border-collapse: collapse; margin-top: 12px; }
    .dashboard-table th, .dashboard-table td { padding: 8px 12px; text-align: left; border-bottom: 1px solid var(--muted); }
    .dashboard-table th { color: var(--sub); }

    .footer-note{font-size:12px; color:var(--sub)}
    .hidden{display:none !important}

    .notes-list { display: flex; flex-direction: column; gap: 8px; max-height: 250px; overflow-y: auto; padding-right: 6px; }
    .note-item { background: rgba(255,255,255,0.04); border-radius: 10px; padding: 10px; display: flex; justify-content: space-between; align-items: flex-start; gap: 10px; cursor: pointer; } /* Modified */
    .note-content-wrapper { flex: 1; min-width: 0; }
    .note-content { white-space: pre-wrap; word-break: break-word; max-height: 60px; overflow: hidden; position: relative; transition: max-height 0.35s ease-in-out; }
    .note-content:not(.expanded)::after {
        content: ''; position: absolute; bottom: 0; right: 0; width: 100%; height: 20px; background: linear-gradient(to top, var(--panel) 20%, transparent);
    }
    .note-content.expanded { max-height: 500px; }
    .note-meta { font-size: 11px; color: var(--sub); margin-top: 4px; }
    
    .spinner { border: 2px solid var(--muted); border-top-color: var(--text); border-radius: 50%; width: 16px; height: 16px; animation: spin 1s linear infinite; } /* Modified */
    @keyframes spin { to { transform: rotate(360deg); } }

    .panel-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .panel-header h3 { margin: 0; }
    .panel-header .actions { display: flex; gap: 8px; }
    
    .aux-panel { margin-top: 24px; }
    .tab-nav { display: flex; gap: 4px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); margin-bottom: 16px; }
    .tab-btn { background: transparent; border: none; color: var(--sub); padding: 8px 16px; cursor: pointer; border-bottom: 2px solid transparent; transition: all .2s ease; font-weight: 600; }
    .tab-btn:hover { color: var(--text); }
    .tab-btn.active { color: var(--acc); border-bottom-color: var(--acc); }
    .tab-content {
      display: none;
      padding-top: 8px;
    }
    .tab-content.active {
      animation: fadeIn 0.25s ease-out;
    }
    #tasks.tab-content.active,
    #notes.tab-content.active,
    #ai.tab-content.active {
        display: block;
    }

    #settings-timer.tab-content.active,
    #settings-ui.tab-content.active,
    #settings-integrations.tab-content.active {
        display: flex;
    }

    .settings-row-toggle {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 16px;
    }
    .settings-row-toggle span {
      flex: 1;
      cursor: pointer;
    }
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 44px;
      height: 24px;
      flex-shrink: 0;
    }
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    .toggle-switch .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--muted);
      transition: .3s;
      border-radius: 24px;
    }
    .toggle-switch .slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .3s;
      border-radius: 50%;
    }
    .toggle-switch input:checked + .slider {
      background-color: var(--acc-2);
    }
    .toggle-switch input:checked + .slider:before {
      transform: translateX(20px);
    }
    
    .chat-messages { max-height: 250px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; margin-bottom: 12px; padding: 4px; }
    .chat-msg { padding: 8px 12px; border-radius: 12px; max-width: 85%; word-break: break-word; }
    .chat-msg.user { background: var(--acc); color: white; align-self: flex-end; border-bottom-right-radius: 4px; }
    .chat-msg.model { background: var(--muted); align-self: flex-start; border-bottom-left-radius: 4px; }
    .chat-input-area { display: flex; gap: 8px; }

    .methods-list { list-style: none; padding: 0; }
    .method-item { align-items: flex-start; padding: 12px; display: flex; gap: 10px; border-radius: 8px; }
    .method-item:hover { background: rgba(0,0,0,0.03); } /* Modified */
    .method-item input[type="checkbox"] { width: 18px; height: 18px; margin-top: 2px; flex-shrink: 0;}
    .method-item label { flex: 1; }
    .method-item label.completed { text-decoration: line-through; color: var(--sub); }
    .method-item .content-wrapper { flex: 1; cursor: pointer; }
    .method-item .concept { font-size: 14px; color: var(--sub); margin-top: 8px; border-left: 2px solid var(--muted); padding-left: 12px; white-space: pre-wrap; word-break: break-word; }
    /* Highlight section titles and bold text inside method content */
    .method-content h4 {
        color: var(--acc-2);
        font-size: 1.1em;
        margin-top: 1.5em;
        margin-bottom: 0.5em;
    }
    .method-content strong {
        color: var(--acc);
        font-weight: 600;
    }
    /* Apply the same highlight to the Guide view */
    #view-guide h4 { color: var(--acc-2); }
    #view-guide strong { color: var(--acc-2); }
    /* Show hand cursor to indicate clickability */
    .method-item, .method-item summary { cursor: pointer; }
    .subtopic-todo-list { list-style: none; padding: 0; margin: 0; max-height: 100px; overflow-y: auto; text-align: left; }
    .subtopic-todo-list li { display: flex; align-items: center; gap: 8px; padding: 4px; transition: all 0.2s ease-out; }
    .subtopic-todo-list li.removing { transform: translateX(100%); opacity: 0; }
    .subtopic-todo-list label { flex: 1; }

    #youtube-player-container { position: absolute; top: -9999px; left: -9999px; width: 1px; height: 1px; overflow: hidden; }

    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.1); border-radius: 10px; } /* Modified */
    ::-webkit-scrollbar-thumb { background: var(--muted); border-radius: 10px; border: 2px solid transparent; background-clip: content-box; }
    ::-webkit-scrollbar-thumb:hover { background: var(--sub); background-clip: content-box; }
    
    .timer-circle-container {
        position: relative; width: clamp(250px, 40vw, 320px); height: clamp(250px, 40vw, 320px); margin: 24px auto; display: flex; align-items: center; justify-content: center;
    }
    .timer-svg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; transform: rotate(-90deg); }
    .timer-circle-bg, .timer-circle-progress { fill: none; stroke-width: 8; }
    .timer-circle-bg { stroke: var(--muted); } /* Modified */
    .timer-circle-progress { stroke: var(--acc); stroke-linecap: round; transition: stroke-dashoffset 0.3s linear, stroke 0.5s ease; }
    @keyframes flash { 0%, 100% { box-shadow: 0 0 10px 2px transparent; } 50% { box-shadow: 0 0 20px 8px currentColor; } }
    .timer-circle-container.finished { color: var(--acc-2); animation: flash 1s ease-out; }
    @keyframes breathing-effect { 0% { transform: scale(1); } 50% { transform: scale(1.03); } 100% { transform: scale(1); } }
    .timer-circle-container.breathing { animation: breathing-effect 3s ease-in-out infinite; }
    
    
    
    @media (max-width: 1024px) {
      .app-content { padding: 20px; }
      .panel { padding: 20px; }
      .timer-circle-container { width: clamp(220px, 50vw, 300px); height: clamp(220px, 50vw, 300px); }
    }

    @media (max-width: 768px) {
      .app { flex-direction: column; }
      .app-nav { width: 100%; height: 60px; flex-direction: row; justify-content: center; border-right: none; border-top: 1px solid rgba(255,255,255,.08); order: 2; padding: 0 16px; }
      .app-content { padding: 16px; order: 1; }
      .panel { padding: 16px; }
      .modal-card .tab-nav { overflow-x: auto; }
    }

    @media (max-width: 480px) {
      .app-nav { height: 50px; }
      .nav-btn { flex: 1; }
      header.app-header { flex-direction: column; align-items: stretch; gap: 8px; }
      .btn { padding: 8px 12px; }
      .timer-circle-container { width: clamp(180px, 80vw, 220px); height: clamp(180px, 80vw, 220px); margin: 16px auto; }
      .panel { padding: 12px; }
      .app-content { padding: 12px; }
    }

    #view-timer.no-subtopic-selected > .panel-bg:not(:first-child) { display: none; }
    #view-timer.no-subtopic-selected .timer-header > .presets { display: none; }
    #view-timer.no-subtopic-selected .timer { display: none; }

    header.app-header .actions #btnFullscreen { background: transparent; border: none; box-shadow: none; }
    header.app-header .actions #btnFullscreen:hover { background: var(--muted); filter: none; }
    header.app-header .actions #btnFullscreen:hover::before { opacity: 0; }

    input[type="text"], input[type="password"], input[type="number"], select, textarea {
        background: rgba(255,255,255,0.04) !important; /* Modified: switched to translucent white background */
        color: var(--text);
        border: 1px solid rgba(255, 255, 255, 0.1); /* Faint white border */
        transition: background .2s ease, border-color .2s ease;
    }
    input[type="text"]:focus, input[type="password"]:focus, input[type="number"]:focus, select:focus, textarea:focus {
        background: rgba(255,255,255,0.06) !important; /* Fine-tune: closer to spec */
        border-color: var(--acc);
    }
    /* === START: FIX INPUT/SELECT BACKGROUND ON LIGHT THEMES === */
    [data-theme='light'] input, [data-theme='light'] select, [data-theme='light'] textarea,
    [data-theme='pastel'] input, [data-theme='pastel'] select, [data-theme='pastel'] textarea {
        background: rgba(0, 0, 0, 0.05) !important; /* Use translucent black instead of white on light theme */
        border-color: rgba(0, 0, 0, 0.1); /* Faint black border on light themes */
    }

    [data-theme='light'] input:focus, [data-theme='light'] select:focus, [data-theme='light'] textarea:focus,
    [data-theme='pastel'] input:focus, [data-theme='pastel'] select:focus, [data-theme='pastel'] textarea:focus {
        background: rgba(0, 0, 0, 0.07) !important; /* Increase density on focus */
    }
    /* === END: FIX INPUT/SELECT BACKGROUND ON LIGHT THEMES === */

    /* Improve option background and text color per current theme */
    select option {
        background: var(--panel);
        color: var(--text);
    }
    
    ::placeholder { color: var(--sub); opacity: 0.7; } /* Tweak */
    ::-ms-input-placeholder { color: var(--sub); }
    :-ms-input-placeholder { color: var(--sub); }

    
    
    .draggable-timer {
        position: fixed;
        bottom: 20px;
        right: 20px;
        color: var(--text);
        padding: 8px 16px;
        border-radius: 12px;
        box-shadow: var(--shadow);
        font-size: 2em;
        font-weight: 600;
        cursor: move;
        user-select: none;
        z-index: 9998;
        opacity: 0;
        transform: scale(0.9);
        pointer-events: none;
        transition: opacity 0.35s ease, transform 0.35s ease;
    }
    body.bg-view-mode .draggable-timer {
        opacity: 1;
        transform: scale(1);
        pointer-events: auto;
    }
    .app-nav, .panel-bg, .app-header .actions > *, .app-header > .row {
        transition: opacity 0.35s ease, transform 0.35s ease, background 0.35s ease, border-color 0.35s ease, box-shadow 0.35s ease;
    }
    body.bg-view-mode .app-nav,
    body.bg-view-mode .view.active > .panel-bg {
        opacity: 0;
        pointer-events: none;
        transform: scale(0.98);
    }
    body.bg-view-mode .app-header {
        background: transparent !important;
        border-color: transparent !important;
        box-shadow: none !important;
    }
    body.bg-view-mode .app-header .actions > *:not(#btnToggleBg),
    body.bg-view-mode .app-header > .row {
        opacity: 0;
        pointer-events: none;
    }
    body.bg-view-mode #btnToggleBg {
        opacity: 1;
        pointer-events: auto;
    }
    .sound-permission-bar {
      position: fixed; left: 50%; transform: translateX(-50%);
      bottom: 48px; z-index: 9999;
      border-radius: 12px; padding: 10px 14px;
      display: none; align-items: center; gap: 10px;
      box-shadow: var(--shadow);
    }
    .sound-permission-bar.show { display: flex; }
    .sound-permission-bar .msg { font-size: 14px; color: var(--text); }
    .draggable-timer { text-shadow: 0px 0px 8px rgba(0, 0, 0, 0.9); }

    /* Reduce/remove text shadow on light themes to avoid blur/glare */
    body[data-theme='light'],
    body[data-theme='pastel'] { text-shadow: none; }
    body[data-theme='light'] .draggable-timer,
    body[data-theme='pastel'] .draggable-timer { text-shadow: none; }

    /* ============================================= */
/* ========================================================= */
/* START: THI?T L?P PANEL KI?U M?  ?C (FROSTED GLASS)        */
/* ========================================================= */

/* --- 1.  p d?ng hi?u ?ng n?n m? chung cho t?t c? c c panel --- */
.app-nav,
.panel-bg,
.modal-card,
.actions-menu,
.nav-btn .tooltip,
.draggable-timer, 
.sound-permission-bar,
.toast,
.topic-item,
.stat-card,
.hist-item,
.method-item {
    background: rgba(var(--panel-rgb), var(--panel-opacity));
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
}

/* --- 2.  ?nh nghia vi?n cho t?ng lo?i panel --- */
.app-nav {
    border-right: 1px solid rgba(255, 255, 255, 0.1);
}
.panel-bg,
.modal-card,
.actions-menu,
.nav-btn .tooltip,
.draggable-timer, 
.sound-permission-bar,
.toast,
.topic-item,
.stat-card,
.hist-item,
.method-item {
    border: 1px solid rgba(255, 255, 255, 0.1);
}

/* --- 3. Tinh ch?nh vi?n cho c c theme S NG (Light/Pastel) --- */
[data-theme='light'] .app-nav,
[data-theme='light'] .panel-bg,
[data-theme='light'] .modal-card,
[data-theme='light'] .actions-menu,
[data-theme='light'] .nav-btn .tooltip,
[data-theme='light'] .draggable-timer,
[data-theme='light'] .sound-permission-bar,
[data-theme='light'] .toast,
[data-theme='light'] .topic-item,
[data-theme='light'] .stat-card,
[data-theme='light'] .hist-item,
[data-theme='light'] .method-item,
[data-theme='pastel'] .app-nav,
[data-theme='pastel'] .panel-bg,
[data-theme='pastel'] .modal-card,
[data-theme='pastel'] .actions-menu,
[data-theme='pastel'] .nav-btn .tooltip,
[data-theme='pastel'] .draggable-timer,
[data-theme='pastel'] .sound-permission-bar,
[data-theme='pastel'] .toast,
[data-theme='pastel'] .topic-item,
[data-theme='pastel'] .stat-card,
[data-theme='pastel'] .hist-item,
[data-theme='pastel'] .method-item {
    border-color: rgba(0, 0, 0, 0.1);
}

/* --- 4. S?a l?i hi?u ?ng fade-out c?a ghi ch  cho ph  h?p --- */
.note-content:not(.expanded)::after {
    background: linear-gradient(to top, rgba(var(--panel-rgb), 1) 20%, transparent);
}

/* --- C c quy t?c c n l?i gi? nguy n t? file g?c --- */
[data-theme='light'] .tab-nav,
[data-theme='pastel'] .tab-nav {
    border-bottom-color: rgba(0, 0, 0, 0.1);
}
.subtopic-btn {
    background-color: transparent;
}
.subtopic-btn:hover {
    background-color: transparent; /* Hover transparent to avoid blue background */
}
/* When content is expanded, draw a divider above the content */
.method-item > .method-content:not([hidden]) {
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    margin-top: 8px;
    padding-top: 8px;
}
    [data-theme='light'] .method-item > .method-content:not([hidden]),
    [data-theme='pastel'] .method-item > .method-content:not([hidden]) {
        border-top-color: rgba(0, 0, 0, 0.1);
    }

    /* Editor container (single pane, Rich Text) */
    .editor-container { height: 350px; }
    .editable-content { height: 100%; border: 1px solid var(--muted); border-radius: 10px; padding: 10px; overflow-y: auto; background: var(--bg); }
    .editable-content:focus-within { border-color: var(--acc); outline: none; }
    .editable-content h4 { color: var(--acc-2); font-size: 1.1em; margin-top: 1.5em; margin-bottom: 0.5em; }
    .editable-content strong, .editable-content b { color: var(--acc); font-weight: 600; }
    .editable-content ol, .editable-content ul { padding-left: 20px; }

    /* Editor toolbar for Methods modal */
    .editor-toolbar { display: flex; gap: 6px; margin-bottom: 6px; padding: 4px; background: var(--muted); border-radius: 8px; }
    .editor-toolbar button { font-weight: bold; width: 32px; height: 32px; padding: 0; }
    .editor-toolbar .btn.ghost:hover { background-color: rgba(var(--acc-rgb, 108, 140, 255), 0.15); }
    .editor-toolbar .btn.ghost.active { background-color: rgba(var(--acc-rgb, 108, 140, 255), 0.25); }
    .color-picker-wrapper { position: relative; }
    .color-palette { position: absolute; bottom: 110%; left: 50%; transform: translateX(-50%); display: flex; gap: 6px; padding: 6px; border-radius: 8px; border: 1px solid var(--muted); background: var(--panel); box-shadow: var(--shadow); z-index: 10; }
    .color-swatch { width: 24px; height: 24px; border-radius: 50%; border: 2px solid rgba(255, 255, 255, 0.5); cursor: pointer; transition: transform 0.15s ease; }
    .color-swatch:hover { transform: scale(1.15); }

    /* Apply Flexbox to Knowledge Base header */
    .method-item > div:first-child { display: flex; align-items: center; justify-content: space-between; }
    .method-item > div:first-child > .method-title { flex: 1; }
    .method-item > div:first-child .topic-actions { margin-left: 8px; }
    .method-title { cursor: pointer; }
    .method-item:hover .topic-actions, .method-item:focus-within .topic-actions { opacity: 1; visibility: visible; }

    /* ========================================================= */
    /* START: FIX FLEXBOX OVERFLOW WITH LONG TEXT (FLEXBOX FIX) */
    /* ========================================================= */
    .topic-title,
    .subtopic-btn,
    .note-content-wrapper,
    .subtopic-todo-list label,
    .method-title,
    .method-item > div:first-child {
        min-width: 0; /* Allow element to shrink below its content width */
    }

    .topic-title,
    .subtopic-btn,
    .note-content,
    .subtopic-todo-list label,
    .hist-item > div,
    .method-title {
        word-break: break-word;      /* Break long words automatically */
        overflow-wrap: break-word;   /* Ensure wrapping for long strings */
    }
    /* ========================================================= */
    /* END: FIX FLEXBOX OVERFLOW WITH LONG TEXT (FLEXBOX FIX) */
    </style>
</head>
<body data-theme="default"> <div class="app" id="app">
    <nav class="app-nav">
        <button class="nav-btn active" id="navBtnTimer" data-view="timer" aria-label="Timer">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
            <span class="tooltip">Timer</span>
        </button>
        <button class="nav-btn" id="navBtnTopics" data-view="topics" aria-label="Topics">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"></path></svg>
            <span class="tooltip">Topics</span>
        </button>
        <button class="nav-btn" id="navBtnStats" data-view="stats" aria-label="Stats">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"></path><path d="m19 9-5 5-4-4-3 3"></path></svg>
            <span class="tooltip">Stats</span>
        </button>
        <button class="nav-btn" id="navBtnMethods" data-view="methods" aria-label="Knowledge Base">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15.042 21.672L13.684 16.6s.408-1.947 1.25-3.25c.842-1.303 2.002-2.5 3.5-3.5s3.25-1.25 3.25-1.25l5.072 1.358c.27.072.358.42.128.628l-3.35 3.35a.499.499 0 0 1-.594.052l-2.07-1.486c-.44-.314-.82-.53-1.11-.665-.29-.135-.55-.22-.78-.245s-.45.045-.63.155c-.18.11-.3.29-.36.5-.06.21.02.48.18.78.16.3.385.68.665 1.11l1.486 2.07a.499.499 0 0 1-.052.594l-3.35 3.35c-.208.23-.556.142-.628-.128z"/><path d="M12 15l-3-3 3-3 3 3-3 3z"/><path d="M9.01 11.99l-3.005 3.004a.997.997 0 0 1-1.41-1.41l3.004-3.005-3.004-3.005a.997.997 0 0 1 1.41-1.41l3.005 3.004z"/><path d="M5.01 11.99l-3.005 3.004a.997.997 0 0 1-1.41-1.41l3.004-3.005-3.004-3.005a.997.997 0 0 1 1.41-1.41l3.005 3.004z"/></svg>
            <span class="tooltip">Knowledge Base</span>
        </button>
        <button class="nav-btn" id="btnSettings" style="margin-top: auto;" aria-label="Settings">
             <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2l.15.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>
            <span class="tooltip">Settings</span>
        </button>
        <button class="nav-btn" id="navBtnGuide" data-view="guide" aria-label="Guide">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 1 1 5.82 1c0 2-3 2-3 4"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
            <span class="tooltip">Guide</span>
        </button>
    </nav>

    <main class="app-content">
      <header class="app-header panel-bg">
        <div class="row" style="gap:12px; align-items:center; flex:0 1 auto">
          <strong>📚 Pomodoro Study App</strong>
          <span class="badge" id="selectedContext">No Subtopic Selected</span>
        </div>
        <div class="actions">
          <button class="btn ghost small" id="btnDashboard" title="Dashboard">📊 Dashboard </button>
          <a href="https://forms.gle/61hYjvwAkR328EaC9" target="_blank" rel="noopener noreferrer" class="btn ghost small" title="Send your feedback">💬 Feedback</a>
          <button class="btn ghost small" id="btnExport" title="Export JSON">⬇️ Export File</button>
          <label class="btn ghost small" for="importFile" title="Import JSON">⬆️ Import File</label>
          <input type="file" id="importFile" accept="application/json" style="display:none" />
          <button class="btn small" id="btnToggleBg" title="Show/Hide Interface">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>
          </button>
          <button class="btn small" id="btnFullscreen" title="Fullscreen">↗️</button>
        </div>
      </header>
      

      <div id="view-timer" class="view active">
        <section class="panel panel-bg">
          <div class="timer-header">
            <div id="welcomePanel" class="hidden panel-bg" style="text-align:center; padding: 20px; border-radius: var(--radius); width: 100%;">
                <h3>Welcome to the Pomodoro Study App!</h3>
                <p>Get started by selecting a <strong>Subtopic</strong> or creating a new Topic/Subtopic.</p>
                <button class="btn acc" id="btnHelpCreateTopic">＋ Create New Topic</button>
            </div>
            <div class="presets" role="group" aria-label="Choose preset mode">
                <button id="btnPresetA" class="btn small ghost" data-preset="A"></button>
                <button id="btnPresetB" class="btn small ghost" data-preset="B"></button>
                <button id="btnPresetC" class="btn small ghost" data-preset="C">🌊 Flow</button>
            </div>
          </div>
          <hr />
          <div class="timer" aria-live="polite">
            <div class="badge" id="stateBadge">STATUS</div>
            
            <div class="timer-circle-container">
              <svg class="timer-svg" viewBox="0 0 100 100">
                  <circle class="timer-circle-bg" cx="50" cy="50" r="45"></circle>
                  <circle class="timer-circle-progress" cx="50" cy="50" r="45"></circle>
              </svg>
              <div id="timeDisplay" class="big-time">00:00</div>
            </div>

            <div class="tiny" id="cycleInfo"></div>

            <div class="tiny" id="breakSuggestionDisplay" style="min-height: 1.5em; font-style: italic; opacity: 0.8; transition: opacity 0.3s ease;"></div>

            <div id="windDownChecklist" class="hidden" style="text-align: left; max-width: 300px; margin: 0 auto; padding: 0 10px;">
              <h4 style="margin: 8px 0 4px; color: var(--acc); text-align: center;">Wind-down Checklist</h4>
              <ul style="list-style: '✓ '; margin: 0; padding-left: 20px; color: var(--sub);">
                <li>Save your current work (Save/Commit).</li>
                <li>Jot down the "Next step".</li>
                <li>Tidy up your workspace.</li>
              </ul>
            </div>
            
            <div class="controls">
              <button class="btn acc" id="btnStart" aria-label="Start (Space)">▶️ Start</button>
              <button class="btn warn hidden" id="btnFinishFlow" aria-label="End focus session">🧘 Start Break</button>
              <button class="btn" id="btnPause" aria-label="Pause (Space)">⏸️ Pause</button>
              <button class="btn" id="btnResume" aria-label="Resume (Space)">⏵ Resume</button>
              <button class="btn warn" id="btnSkip" aria-label="Skip (N)">⏭️ Skip</button>
              <button class="btn danger" id="btnReset">↺ Reset</button>
              <button class="btn acc small hidden" id="btnBreakEarly">🧘 Break Early</button>
            </div>
            <div class="tiny">Shortcuts: <strong>Space</strong> = Start/Pause/Resume, <strong>N</strong> = Next/Skip</div>
          </div>
        </section>

        <section class="panel panel-bg aux-panel">
            <nav class="tab-nav">
                <button class="tab-btn active" data-tab="tasks">Tasks</button>
                <button class="tab-btn" data-tab="notes">Notes</button>
                <button class="tab-btn" data-tab="ai">Gemini AI</button>
            </nav>
            <div id="tasks" class="tab-content active">
                <h4 style="margin: 0 0 8px; color: var(--sub);">To-dos for this subtopic:</h4>
                <ul id="subtopicTasksList" class="subtopic-todo-list"></ul>
                <div class="row" style="gap:8px; margin-top: 8px;">
                    <input type="text" id="newSubtopicTaskInput" placeholder="Add a new task..." />
                    <button id="btnAddSubtopicTask" class="btn small" style="flex: 0 1 auto;">Add</button>
                </div>
            </div>
            <div id="notes" class="tab-content">
                <div id="generalNotesList" class="notes-list"></div>
                <div class="add-note-area" style="margin-top: 12px;">
                    <textarea id="newGeneralNoteText" placeholder="Add a new note..."></textarea>
                    <div style="text-align: right; margin-top: 8px;">
                        <button class="btn acc small" id="btnAddGeneralNote">＋ Add Note</button>
                    </div>
                </div>
            </div>
            <div id="ai" class="tab-content">
                <div class="panel-header" style="margin-bottom: 8px; padding: 0;">
                    <h4 style="margin:0;">Gemini for: <span id="currentSubtopicNameChat">(none selected)</span></h4>
                    <div class="actions">
                        <button id="btnClearChat" class="btn small danger" title="Clear History">🗑️</button>
                    </div>
                </div>
                <div id="chatMessages" class="chat-messages"></div>
                <div id="aiPromptSuggestions" style="display: flex; gap: 6px; margin: 8px 0; flex-wrap: wrap;">
                  <button class="btn small ghost" data-prompt="Explain the key concepts of this topic">Explain Concept</button>
                  <button class="btn small ghost" data-prompt="Create a detailed outline for this topic">Create Outline</button>
                  <button class="btn small ghost" data-prompt="List 5 important review questions for this topic">Create Review Questions</button>
                </div>
                <div class="chat-input-area">
                  <input type="text" id="chatInput" placeholder="Ask Gemini something..." />
                  <button id="btnSendMessage" class="btn acc">Send</button>
                </div>
            </div>
        </section>
      </div>

      <div id="view-topics" class="view">
        <div class="panel panel-bg">
            <div class="row" style="gap:8px; align-items: center; margin-bottom: 12px;">
                <h3 style="margin: 0;">Topic Management</h3>
                <button class="btn small acc" id="btnAddTopic" style="margin-left: auto;">＋ Add Topic</button>
            </div>
            <div id="topicsList"></div>
            <div class="footer-note">Click the arrow to expand/collapse the subtopic list.</div>
        </div>
      </div>
      
      <div id="view-stats" class="view">
        <section class="panel panel-bg">
            <h3 style="margin:0 0 12px 0;">Statistics & History — <span id="currentSubtopicName">(none selected)</span></h3>
            <div class="stats-grid">
              <div class="stat-card"><h4>Total Time</h4><div class="stat-value" id="statTotal">0 min</div></div>
              <div class="stat-card"><h4>Sessions</h4><div class="stat-value" id="statSessions">0</div></div>
              <div class="stat-card"><h4>Tasks Completed</h4><div class="stat-value" id="statTasks">0</div></div>
            </div>
            <div style="margin-top:12px">
              <h4 style="margin:4px 0 8px; color:var(--sub)">History (FOCUS)</h4>
              <div class="history" id="historyList"></div>
            </div>
        </section>
      </div>
      
      <div id="view-methods" class="view">
        <div class="panel panel-bg">
            <div class="row" style="gap:8px; align-items: center; margin-bottom: 12px;">
                <h3 style="margin:0;">💡 Knowledge Base per Subtopic</h3>
                <button class="btn small acc" id="btnAddMethod" style="margin-left: auto;">＋ Add Knowledge</button>
            </div>
            <p class="tiny" style="margin-top: -8px; margin-bottom: 20px;">Click on an item to see details.</p>
            <div class="methods-container"></div>
        </div>
      </div>

      <div id="view-guide" class="view">
          <div class="panel panel-bg">
              <h3 style="margin-top: 0;">📖 Discover the Pomodoro Study App</h3>
              <p>
                  Welcome to a study space designed for focus and efficiency. Explore the features that support your learning journey.
              </p>

              <h4>🚀 Quick Start in 4 Steps</h4>
              <p>To keep your journey organized, the app uses a <strong>Main Topic → Subtopic</strong> structure.</p>
              <ol>
                  <li>Open <strong>📚 Topics</strong> from the side navigation.</li>
                  <li>Click <strong>＋ Add Topic</strong> to create a main area (e.g., "Conversational English").</li>
                  <li>Next to the topic, click <strong>＋ Add</strong> to create a more specific subtopic (e.g., "Lesson 1: Practice IPA").</li>
                  <li>Select that subtopic. You’re now ready to start your first focus session!</li>
              </ol>

              <hr />
              <h4>✨ Notable Features</h4>

              <h4>Flexible Timer Modes ⏱️</h4>
              <p>The app offers more than Pomodoro. Pick what fits your work:</p>
              <ul>
                  <li><strong>Classic Pomodoro (Style A/B):</strong> Focus in fixed sessions (e.g., 25 min work, 5 min break) to build discipline and cadence.</li>
                  <li><strong>Flowtime Mode (Style 🌊 Flow):</strong> Ideal for deep work. The timer counts up; end when it feels right. Break time is suggested based on your focus time.</li>
                  <li><strong>Wind-down Buffer:</strong> A customizable buffer between focus and break to wrap up, jot the next step, and switch smoothly—without abrupt cutoffs.</li>
              </ul>

              <h4>Knowledge Base Per Subtopic 💡</h4>
              <p>
                  Each <strong>Subtopic</strong> now has its own dedicated Knowledge Base. This lets you build a focused library of methods and notes that only relate to what you’re studying in that subtopic.
              </p>
              <p>
                  For example, notes and methods for “Conversational English” will only appear when that subtopic is selected and won’t mix with formulas from a subtopic like “Calculus”.
              </p>
              <p>
                  The rich editor still lets you format headings, bold key points, create lists, and highlight important information for each subject.
              </p>

              <h4>Visual Topic Management</h4>
              <p>Easily organize your study goals. Use <strong>drag and drop</strong> to reorder Topics or move Subtopics across topics intuitively.</p>

              <h4>Integrated Tasks & Notes 📝</h4>
              <p>Right within the timer view, create to-dos for each subtopic and jot quick notes without breaking your flow.</p>

              <h4>Zen Mode 🧘</h4>
              <p>When you need absolute focus, click the eye icon (👁️). The interface hides, leaving only the background and timer. You can <strong>drag the timer</strong> anywhere for a clean workspace.</p>

              <h4>Statistics & Milestones 🏆</h4>
              <p>Track your journey through meaningful numbers. The app records and celebrates important focus-time milestones—turning effort into achievements.</p>

              <hr />
              <h4>⌨️ Smart Shortcuts</h4>
              <ul>
                  <li><kbd>Space</kbd>: Start / Pause / Resume the session.</li>
                  <li><kbd>N</kbd>: Skip the current focus or break session.</li>
                  <li><kbd>Esc</kbd>: Close open dialogs (e.g., Settings).</li>
              </ul>

              <hr />
              <h4>🛠️ Advanced Settings & Integrations</h4>

              <h4>Gemini AI Assistant 🧠</h4>
              <p>Turn the app into a smart study companion. Beyond Q&A, you can:</p>
              <ul>
                  <li><strong>Smart Auto-formatting:</strong> While writing under "Methods", let AI analyze and format your raw text—detect headings, bold key ideas, and lists.</li>
                  <li><strong>Setup:</strong> Visit Google AI Studio to create a free API Key and paste it into "Gemini API Key" in Settings.</li>
              </ul>

              <h4>Customize Interface & Sound 🎨</h4>
              <p>Make the workspace yours:</p>
              <ul>
                  <li><strong>Multiple Themes & Backgrounds:</strong> Choose from built-in themes (Light, Dark, Pastel...) or <strong>upload your own background</strong> for inspiration.</li>
                  <li><strong>Custom Alerts:</strong> <strong>Upload your own audio files (.mp3, .wav...)</strong> as alert sounds for focus and breaks.</li>
              </ul>

              <h4>YouTube Background Music 🎶</h4>
              <p>Create the perfect study ambiance by playing a YouTube video or playlist as background music. Paste the URL into the "YouTube Background Music" field in Settings.</p>

              <h4>Data Safety: Backup & Restore 🛡️</h4>
              <p>The app automatically backs up your progress daily. Customize how many days to keep and restore data from a previous day if needed. ⚠️ <strong>Warning:</strong> Restore will overwrite your current data.</p>
          </div>
      </div>
    </main>
  </div>

  <div class="modal" id="modalMilestone" role="dialog" aria-modal="true" aria-labelledby="milestoneTitle">
    <div class="modal-card" style="width: min(600px, 94vw);">
        <h3 id="milestoneTitle">🎉 Congratulations!</h3>
        <p id="milestoneMessage" style="white-space: pre-wrap; line-height: 1.6;"></p>
        <div class="row" style="justify-content:flex-end; margin-top:12px">
            <button class="btn acc" id="btnMilestoneClose">Continue the journey!</button>
        </div>
    </div>
  </div>
  <div class="modal" id="modalSettings" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
      <div class="modal-card">
          <h3 id="settingsTitle">⚙️ Settings</h3>
          <nav class="tab-nav">
              <button class="tab-btn active" data-tab="settings-timer">Timer</button>
              <button class="tab-btn" data-tab="settings-ui">Interface & Sound</button>
              <button class="tab-btn" data-tab="settings-integrations">Integrations</button>
          </nav>
          <div class="settings-content">
              <div id="settings-timer" class="tab-content active" style="flex-direction:column; gap:20px;">
                  <div class="row" id="timerPresetSelector" style="margin-bottom:16px;">
                      <button class="btn acc" data-preset-target="A"> Style A </button>
                      <button class="btn ghost" data-preset-target="B"> Style B </button>
                      <button class="btn ghost" data-preset-target="C"> Style C (Flow) </button>
                  </div>
                  <div id="settings-pomodoro">
                      <h4>Pomodoro Durations</h4>
                      <div class="row">
                          <label>FOCUS (minutes)<input type="number" id="set_work" min="1" /></label>
                          <label>WIND-DOWN (minutes)<input type="number" id="set_winddown" min="0" /></label>
                          <label>SHORT BREAK (minutes)<input type="number" id="set_short" min="1" /></label>
                          <label>LONG BREAK (minutes)<input type="number" id="set_long" min="1" /></label>
                      </div>
                      <div class="row">
                          <label>Pomodoro Cycles<input type="number" id="set_cycles" min="1" /></label>
                          <label>Long Break Interval<input type="number" id="set_interval" min="2" /></label>
                      </div>
                  </div>
                  <div id="settings-flowtime" class="hidden">
                      <h4>Flowtime</h4>
                      <div class="row">
                          <label>Break Ratio (Work / X)
                              <input type="number" id="set_flowRatio" min="1" max="20" />
                          </label>
                      </div>
                      <p class="tiny" style="margin-top: 4px;">Tip: Break time = total focus time / X. Default is 5.</p>
                  </div>
                  <div class="settings-row-toggle">
                          <label for="set_autoStartNext">Automatically start next session</label>
                          <label class="toggle-switch">
                              <input type="checkbox" id="set_autoStartNext">
                              <span class="slider"></span>
                          </label>
                      </div>
                  <div class="settings-row-toggle">
                          <label for="set_enableWinddown">Enable Wind-down after focus session</label>
                          <label class="toggle-switch">
                              <input type="checkbox" id="set_enableWinddown">
                              <span class="slider"></span>
                          </label>
                      </div>
                  <div class="settings-row-toggle">
                          <label for="set_enableSessionNotes">Prompt for note after each session</label>
                          <label class="toggle-switch">
                              <input type="checkbox" id="set_enableSessionNotes">
                              <span class="slider"></span>
                          </label>
                      </div>
              </div>
              <div id="settings-ui" class="tab-content" style="flex-direction: column; gap: 20px;">
                  <div>
                      <h4>Interface</h4>
                      <div class="row">
                          <label>UI Theme
                                <select id="set_theme_color">
                                    <option value="default">Default (Dark Blue)</option>
                                    <option value="light">Light - Milk Tea</option>
                                    <option value="pastel">Pastel - Soft</option>
                                    <option value="lofi">Lofi Study Room</option>
                                    <option value="space">Space Station</option>
                                </select>
                          </label>
                      </div>
                      <div class="row" style="margin-top: 12px;">
                          <label>Background Display Mode
                              <select id="set_backgroundMode">
                                  <option value="cover">Cover (Default)</option>
                                  <option value="contain">Contain (Sharp)</option>
                                  <option value="auto">Original Size (Repeat)</option>
                              </select>
                          </label>
                      </div>
                      <div class="row">
                          <label>Background Image
                              <label class="btn small ghost" for="uploadBg">Upload New Image</label>
                              <input type="file" id="uploadBg" accept="image/*" class="hidden" />
                          </label>
                          <button class="btn small danger" id="btnClearBg">Clear Background</button>
                      </div>
                      <div class="row">
                          <label style="flex: 1;">Panel Opacity</label>
                          <input type="range" id="set_panelOpacity" min="0.1" max="1" step="0.05" style="flex: 2;">
                      </div>
                      
                      
                   </div>
                  
                   <div>
                      <h4>Sound</h4>
                      <div class="row">
                          <label>Volume (0–1)<input type="number" id="set_volume" step="0.05" min="0" max="1"/></label>
                          <label>Alert Style
                              <select id="set_theme">
                                  <option value="beep">Beep</option>
                                  <option value="chime">Chime</option>
                              </select>
                          </label>
                           <button class="btn" id="btnTestSound" style="flex: 0 1 auto; align-self: center;">Test</button>
                      </div>
                      <div style="text-align: right; margin-top: 12px;">
                          <button class="btn ghost small" id="btnToggleCustomSounds">Customize Alerts</button>
                      </div>

                      <div id="customSoundsContainer" class="hidden" style="margin-top: 8px;">
                      <div class="row" style="display: flex; gap: 8px; justify-content: flex-end;">
                          <div>
                              <small>Alert at end of FOCUS</small>
                              <label title="Alert at end of FOCUS" class="btn small ghost" for="uploadSoundWork">FOCUS</label>
                              <input type="file" id="uploadSoundWork" accept="audio/*" class="hidden" />
                          </div>
                          <div>
                              <small>Alert at end of SHORT BREAK</small>
                              <label title="Alert at end of SHORT BREAK" class="btn small ghost" for="uploadSoundBreak">SHORT BREAK</label>
                              <input type="file" id="uploadSoundBreak" accept="audio/*" class="hidden" />
                          </div>
                          <div>
                              <small>Alert at end of LONG BREAK</small>
                              <label title="Alert at end of LONG BREAK" class="btn small ghost" for="uploadSoundLong">LONG BREAK</label>
                              <input type="file" id="uploadSoundLong" accept="audio/*" class="hidden" />
                          </div>
                      </div>
                      </div>
                      
                  </div>
              </div>
              <div id="settings-integrations" class="tab-content" style="flex-direction: column; gap: 20px;">
                  <div>
                      <h4>AI Integration</h4>
                      <label>Gemini API Key
                          <input type="password" id="set_apiKey" placeholder="Paste your API Key here..." />
                      </label>
                      <div class="tiny">Required to use AI features. Get a free key at <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener noreferrer">Google AI Studio</a>.</div>
                  </div>
                  <div>
                      <h4>🎵 YouTube Background Music</h4>
                      <div class="row" style="gap:8px; align-items:center;">
                          <input type="text" id="set_youtubeUrl" placeholder="Paste YouTube link here..." style="flex:1;">
                          </div>
                      <div id="ytUrlFeedback" class="tiny" style="min-height: 1.2em; padding: 4px 0;"></div>
                      <div class="row" style="margin-top: 4px;">
                          <label style="flex: 0 1 auto; display: flex; align-items: center; gap: 8px; font-size: 14px;">
                              <input type="checkbox" id="set_ytThumbAsBg">
                              <span>Use video thumbnail as background</span>
                          </label>
                      </div>
                      <div class="row" style="margin-top: 8px;">
                          <button id="btnToggleYtSound" class="btn small" style="flex:0 1 auto;" title="Stopping will not auto-play again until you press ▶️">▶️</button>
                          <input type="range" id="ytSoundVolume" min="0" max="100" step="1" value="80" style="flex:1;">
                      </div>
                      <div class="tiny" style="text-align:center; margin-top:4px;">Volume</div>
                  </div>
                  <div>
                      <h4>🛡️ Backup Settings</h4>
                      <div class="row">
                          <label>Number of backup days to keep
                               <input type="number" id="set_backupDays" min="1" max="30" />
                          </label>
                      </div>
                  </div>
                  <div>
                      <h4>🛡️ Restore Data</h4>
                      <p class="tiny">Restore from an automatic daily backup. This action will overwrite your current data.</p>
                      <div class="row">
                          <select id="backupList" style="flex: 3;"></select>
                          <button id="btnRestoreBackup" class="btn warn small" style="flex: 1;">Restore</button>
                      </div>
                  </div>
              </div>
          </div>
          <div class="row" style="margin-top:16px; justify-content:flex-end">
              <button class="btn ghost" id="btnDefaults">Defaults</button>
              <button class="btn acc" id="btnSaveSettings">Save</button>
              <button class="btn" id="btnCloseSettings">Close</button>
          </div>
      </div>
  </div>

  <div class="modal" id="modalNote" role="dialog" aria-modal="true" aria-labelledby="noteTitle">
    <div class="modal-card">
      <h3 id="noteTitle">📝 Note for the completed session</h3>
      <div class="row"><textarea id="noteText" placeholder="What did you learn? Any difficulties? Next steps?"></textarea></div>
      <div class="row" style="justify-content:flex-end; margin-top:8px; gap: 12px;">
        <button class="btn" id="btnSummarizeNote">✨ Summarize & Suggest</button>
        <button class="btn" id="btnSkipNote">Skip</button>
        <button class="btn acc" id="btnSaveNote">Save Note</button>
      </div>
    </div>
  </div>

  <div class="modal" id="modalGeneric" role="dialog" aria-modal="true" aria-labelledby="genericTitle">
      <div class="modal-card" style="width: min(450px, 94vw);">
          <h3 id="genericTitle">Title</h3>
          <p id="genericMessage" class="hidden"></p>
          <input type="text" id="genericInput" class="hidden" />
          <div class="row" style="justify-content:flex-end; margin-top:12px">
              <button class="btn" id="btnGenericCancel">Cancel</button>
              <button class="btn acc" id="btnGenericOk">OK</button>
          </div>
      </div>
  </div>
  
  <div class="modal" id="modalDashboard" role="dialog" aria-modal="true" aria-labelledby="dashboardTitle">
    <div class="modal-card" style="width: min(800px, 95vw);">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h3 id="dashboardTitle">📊 Dashboard</h3>
            <button class="btn ghost small" id="btnCloseDashboard">Close</button>
        </div>
        <p class="tiny">Summary of time and sessions completed across all topics.</p>
        <div id="dashboardContent" style="max-height: 60vh; overflow-y: auto;"></div>
    </div>
  </div>

  <div class="modal" id="modalMethodEditor" role="dialog" aria-modal="true">
    <div class="modal-card" style="width: min(800px, 95vw);">
      <h3 id="methodEditorTitle">Edit Method</h3>
      
      <div style="display: flex; flex-direction: column; gap: 12px; margin-top: 12px;">
        <input type="hidden" id="methodEditorId">
        <label>Title<input type="text" id="methodEditorTitleInput"></label>
        
        <label>Content</label>
        <div class="editor-toolbar">
          <button id="toolH4" class="btn small ghost" title="Small heading">H</button>
          <button id="toolBold" class="btn small ghost" title="Bold">B</button>
          <button id="toolItalic" class="btn small ghost" title="Italic">I</button>
          <button id="toolList" class="btn small ghost" title="Numbered list">1.</button>
          <button id="toolBullet" class="btn small ghost" title="Bulleted list">•</button>

          <div class="color-picker-wrapper">
            <button id="toolColor" class="btn small ghost" title="Text color">A</button>
            <div class="color-palette hidden">
              <button class="color-swatch" style="background-color: var(--text);" data-color="var(--text)" title="Default text color"></button>
              <button class="color-swatch" style="background-color: var(--acc);" data-color="var(--acc)" title="Accent color"></button>
              <button class="color-swatch" style="background-color: var(--acc-2);" data-color="var(--acc-2)" title="Positive color"></button>
              <button class="color-swatch" style="background-color: var(--warn);" data-color="var(--warn)" title="Warning color"></button>
              <button class="color-swatch" style="background-color: var(--danger);" data-color="var(--danger)" title="Danger color"></button>
              <button class="color-swatch" style="background-color: var(--purple);" data-color="var(--purple)" title="Purple"></button>
            </div>
          </div>
        </div>

        <div class="editor-container">
            <div id="methodEditorContentInput" class="editable-content" contenteditable="true"></div>
        </div>

      </div>

      <div class="row" style="justify-content:space-between; margin-top:16px">
        <button id="btnAutoFormat" class="btn small" disabled title="This feature requires a Gemini API Key">✨ Auto-format</button>
        <div>
          <button class="btn" id="btnCancelMethodEditor">Cancel</button>
          <button class="btn acc" id="btnSaveMethod">Save</button>
        </div>
      </div>
    </div>
  </div>

  <div class="toasts" id="toasts"></div>
  <audio id="audioWorkEnd"></audio>
  <audio id="audioBreakEnd"></audio>
  <audio id="audioLongEnd"></audio>
  <div id="youtube-player-container"></div>

  <div id="draggableTimer" class="draggable-timer">00:00</div>

  <div id="soundPermissionBar" class="sound-permission-bar" role="alert" aria-live="polite">
    <span class="msg">Press "Enable Sound" to allow background audio.</span>
    <button id="btnEnableSound" class="btn small acc">Enable Sound</button>
  </div>
<!-- YouTube Iframe API is loaded dynamically when needed -->
<!-- === START: Inline Minimal Sortable (Offline-Safe) === -->
<script>
// Minimal Sortable shim for offline single-file usage.
// Supports: draggable selector, cross-list via same group, onEnd callback.
(function(){
  if (window.Sortable) return; // Respect existing if loaded
  const DND = { src: null, from: null, selector: null, group: null };
  function makeDraggable(container, selector){
    Array.from(container.querySelectorAll(selector)).forEach(el => {
      try { el.setAttribute('draggable','true'); } catch(_) {}
    });
  }
  function closestItem(e, selector){
    const t = e.target && e.target.closest ? e.target.closest(selector) : null;
    return t || null;
  }
  function Sortable(container, opts){
    this.el = container;
    this.options = opts || {};
    const selector = this.options.draggable || '*';
    const group = this.options.group || null;
    makeDraggable(container, selector);
    const handleDragStart = (e) => {
      const item = closestItem(e, selector);
      if (!item) return;
      DND.src = item; DND.from = container; DND.selector = selector; DND.group = group;
      e.dataTransfer.effectAllowed = 'move';
      try { e.dataTransfer.setData('text/plain', ''); } catch(_) {}
    };
    const handleDragOver = (e) => {
      if (!DND.src) return;
      // Only allow drop if same selector and group matches (or no group)
      const sameGroup = (!group && !DND.group) || (group && DND.group && group === DND.group);
      if (!sameGroup) return;
      const target = closestItem(e, selector);
      if (!target) return;
      e.preventDefault();
    };
    const handleDrop = (e) => {
      if (!DND.src) return;
      const sameGroup = (!group && !DND.group) || (group && DND.group && group === DND.group);
      if (!sameGroup) return;
      const target = closestItem(e, selector);
      if (!target) return;
      e.preventDefault();
      const from = DND.from;
      const to = container;
      const children = Array.from(from.querySelectorAll(DND.selector));
      const oldIndex = children.indexOf(DND.src);
      if (target && DND.src && target !== DND.src) {
        to.insertBefore(DND.src, target);
      }
      const newChildren = Array.from(to.querySelectorAll(DND.selector));
      const newIndex = newChildren.indexOf(DND.src);
      if (typeof this.options.onEnd === 'function') {
        try { this.options.onEnd({ oldIndex, newIndex, from, to, item: DND.src }); } catch(_) {}
      }
      DND.src = null; DND.from = null; DND.selector = null; DND.group = null;
    };
    this._listeners = { handleDragStart, handleDragOver, handleDrop };
    container.addEventListener('dragstart', handleDragStart);
    container.addEventListener('dragover', handleDragOver);
    container.addEventListener('drop', handleDrop);
    this.destroy = () => {
      container.removeEventListener('dragstart', handleDragStart);
      container.removeEventListener('dragover', handleDragOver);
      container.removeEventListener('drop', handleDrop);
    };
  }
  window.Sortable = Sortable;
})();
</script>
<!-- === END: Inline Minimal Sortable === -->
  <script>
    const _0x1b5e35=_0x2c31;function _0x5ccb(){const _0x52a394=['achievedMilestones','remove','readwrite','input','createObjectURL','backupDaysToKeep','topics','#btnDefaults','allow','key','menu-item','Gửi\x20bạn,\x2020\x20giờ\x20(Nền\x20tảng)','stroke','#set_long','transaction','onclick','Nguyên\x20Tắc\x2080/20\x20Để\x20Chinh\x20Phục\x20Lĩnh\x20Vực\x20Mới','classList','lofi','Đã\x20xóa\x20hình\x20nền\x20tùy\x20chỉnh.','soundPermissionBar','<p>','#view-','data','#set_backupDays','#methodEditorContentInput','.modal','<tr><td>','DB_NAME','Thực\x20hiện\x20vài\x20động\x20tác\x20hít\x20thở\x20sâu.','prompt','\x22\x0a\x0aHãy\x20tạo\x20một\x20bản\x20tóm\x20tắt\x20ngắn\x20gọn\x20về\x20những\x20gì\x20đã\x20làm\x20và\x20đề\x20xuất\x20một\x20bước\x20hợp\x20lý\x20tiếp\x20theo.\x20Định\x20dạng\x20câu\x20trả\x20lời\x20như\x20sau:\x0a\x0a---\x0a**✨\x20Tóm\x20tắt\x20AI:**\x0a[Tóm\x20tắt\x20ở\x20đây]\x0a\x0a**🚀\x20Gợi\x20ý\x20tiếp\x20theo:**\x0a[Gợi\x20ý\x20ở\x20đây]','#uploadBg','mode','formatBlock','fullscreenElement','####\x20','#set_interval','.subtopic-btn','.timer-circle-progress','(Không\x20tạo\x20được\x20tóm\x20tắt)','frequency','pomodoro_files','destination','createElement','#topicsList','#stateBadge','method-item','❌\x20Link\x20không\x20hợp\x20lệ\x20hoặc\x20không\x20được\x20hỗ\x20trợ.','#set_youtubeUrl','script','isContentEditable','Đang\x20phát','B_winddown','Bạn\x20có\x20chắc\x20muốn\x20xóa\x20Chủ\x20đề\x20con\x20\x22','#btnClearBg','button','pastel','.color-palette','Chọn\x20một\x20chủ\x20đề\x20con\x20trước.','model','block','setItem','#btnPresetC','selectionStart','5.000\x20giờ\x20tập\x20trung\x20có\x20chủ\x20đích.\x20Đây\x20là\x20một\x20thành\x20tựu\x20mà\x20rất\x20ít\x20người\x20đạt\x20được.\x0a\x0aTại\x20cột\x20mốc\x20này,\x20câu\x20hỏi\x20không\x20còn\x20là\x20\x27Làm\x20thế\x20nào\x20để\x20tập\x20trung?\x27,\x20mà\x20là\x20\x27Sự\x20tập\x20trung\x20này\x20sẽ\x20được\x20dùng\x20để\x20tạo\x20ra\x20giá\x20trị\x20gì?\x27.\x20Bạn\x20không\x20chỉ\x20làm\x20việc,\x20bạn\x20đang\x20tạo\x20ra\x20di\x20sản.','toLocaleString','Xác\x20nhận\x20phục\x20hồi','Bản\x20sao\x20lưu\x20ngày:\x20','delete','\x20|\x20<strong>Tổng\x20nhiệm\x20vụ:</strong>\x20','volume','1cbIFSF','exitFullscreen','role','updateUI','Failed\x20to\x20save\x20data:','subtopics','Xóa\x20Chủ\x20đề\x20con','radial-gradient(1200px\x20800px\x20at\x2010%\x20-10%,\x20#20285b\x200%,\x20#0f1222\x2050%,\x20#0b0e1a\x20100%)','random','btn\x20small\x20danger','#uploadSoundWork','enableSessionNotes','#toolColor','#btnResume','#audioBreakEnd','getAll','#view-methods\x20.method-item','actions-menu','strokeDasharray','blob:','Failed\x20to\x20delete\x20summary:','Chọn\x20chủ\x20đề\x20con\x20trước.','<div\x20class=\x22spinner\x22></div>','workMinutes','#btnToggleYtSound','#milestoneMessage','all','#statTotal','Gửi\x20bạn,\x20250\x20giờ\x20(Bền\x20bỉ)','panelOpacity','collapsedTopics','active','onload','AudioContext','#set_theme','Bạn\x20có\x20chắc\x20muốn\x20phục\x20hồi\x20dữ\x20liệu\x20từ\x20ngày\x20','errorCode','cyclesB','var(--acc)','addEventListener','offsetHeight','view','#windDownChecklist','Phân\x20tích\x20và\x20định\x20dạng\x20lại\x20đoạn\x20văn\x20bản\x20sau\x20đây\x20thành\x20mã\x20HTML\x20sạch.\x20Sử\x20dụng\x20các\x20thẻ\x20sau:\x0a-\x20Dùng\x20<h4>\x20cho\x20các\x20tiêu\x20đề\x20chính.\x0a-\x20Dùng\x20<strong>\x20để\x20nhấn\x20mạnh\x20các\x20thuật\x20ngữ\x20hoặc\x20ý\x20tưởng\x20quan\x20trọng.\x0a-\x20Dùng\x20<i>\x20cho\x20các\x20câu\x20ghi\x20chú\x20hoặc\x20trích\x20dẫn.\x0a-\x20Dùng\x20<ol>\x20và\x20<li>\x20cho\x20các\x20danh\x20sách\x20có\x20thứ\x20tự.\x0a-\x20Dùng\x20<ul>\x20và\x20<li>\x20cho\x20các\x20danh\x20sách\x20không\x20có\x20thứ\x20tự.\x0a-\x20Bọc\x20các\x20đoạn\x20văn\x20thông\x20thường\x20trong\x20thẻ\x20<p>.\x0aVăn\x20bản\x20cần\x20định\x20dạng:\x0a\x0a\x22','break','\x22\x20title=\x22Hoàn\x20thành\x20task\x22>\x20<label\x20for=\x22','flowtimeBreakRatio','createObjectStore','style','OK.\x20Link\x20hợp\x20lệ.\x20Đang\x20chuẩn\x20bị\x20phát...','click','Sửa\x20tên\x20Chủ\x20đề','tasksCompleted','#btnPause','Đổi\x20tên\x20Chủ\x20đề\x20con','min','closest','preventDefault','vi-VN','methodId','Tự\x20nhắc:\x20Nghỉ\x20ngơi\x20đúng\x20cách\x20là\x20để\x20làm\x20việc\x20tốt\x20hơn!','objectStore','paused','data:','useYtThumbnailAsBg','getIframe','strokeDashoffset','<li\x20class=\x22tiny\x22\x20style=\x22opacity:\x200.7;\x22>Chọn\x20chủ\x20đề\x20con\x20để\x20xem\x20to-do\x20list.</li>','insertUnorderedList','Chưa\x20có\x20tiêu\x20đề','readonly','#set_backgroundMode','tid','presetTarget','hidden','offsetWidth','setAttribute','#btnMilestoneClose','<span\x20class=\x22ico\x22>▾</span>','method-content','command','sessionsCompleted','#methodEditorTitleInput','persistTimerState','shiftKey','src','Rửa\x20mặt\x20hoặc\x20vỗ\x20nhẹ\x20lên\x20mặt\x20để\x20tỉnh\x20táo\x20hơn.','getSettings','Tên\x20Chủ\x20đề\x20mới?','https://img.youtube.com/vi/','lastPersist','Hiện\x20giao\x20diện','title','bottom','scrollHeight','#toolH4','pause','&amp;','slice','Đang\x20phát\x20nhạc\x20nền...','Đã\x20dừng\x20nhạc\x20nền.','sess','display','<p>Nguyên\x20tắc\x20cốt\x20lõi\x20của\x20kỹ\x20thuật\x20này\x20dựa\x20trên\x20một\x20ý\x20tưởng\x20duy\x20nhất:\x20\x22Nếu\x20bạn\x20không\x20thể\x20giải\x20thích\x20một\x20chủ\x20đề\x20một\x20cách\x20đơn\x20giản,\x20bạn\x20chưa\x20thực\x20sự\x20hiểu\x20nó.\x22\x20Mục\x20tiêu\x20là\x20biến\x20kiến\x20thức\x20phức\x20tạp\x20thành\x20lời\x20giải\x20thích\x20đơn\x20giản\x20đến\x20mức\x20một\x20đứa\x20trẻ\x20cũng\x20có\x20thể\x20hiểu.</p><h4>Quy\x20Trình\x204\x20Bước\x20Tinh\x20Gọn</h4><ol><li><strong>Học:</strong>\x20Chọn\x20một\x20chủ\x20đề\x20và\x20viết\x20ra\x20tất\x20cả\x20những\x20gì\x20bạn\x20biết\x20về\x20nó.</li><li><strong>Dạy:</strong>\x20Giả\x20vờ\x20dạy\x20lại\x20chủ\x20đề\x20này\x20bằng\x20ngôn\x20ngữ\x20đơn\x20giản\x20nhất\x20có\x20thể.\x20Viết\x20hoặc\x20nói\x20to\x20ra.</li><li><strong>Tìm\x20&\x20Sửa\x20Lỗi:</strong>\x20Bất\x20cứ\x20khi\x20nào\x20bạn\x20bị\x20\x22kẹt\x22,\x20phải\x20dùng\x20thuật\x20ngữ\x20phức\x20tạp,\x20hoặc\x20không\x20thể\x20giải\x20thích\x20trôi\x20chảy,\x20bạn\x20đã\x20tìm\x20thấy\x20lỗ\x20hổng\x20kiến\x20thức\x20của\x20mình.\x20Hãy\x20quay\x20lại\x20tài\x20liệu\x20gốc\x20để\x20học\x20lại\x20cho\x20đến\x20khi\x20lấp\x20được\x20lỗ\x20hổng\x20đó.</li><li><strong>Đơn\x20Giản\x20Hóa:</strong>\x20Sắp\x20xếp\x20lại\x20lời\x20giải\x20thích\x20cuối\x20cùng,\x20sử\x20dụng\x20các\x20ví\x20dụ\x20hoặc\x20phép\x20ví\x20von\x20đơn\x20giản\x20để\x20nó\x20trở\x20nên\x20mạch\x20lạc\x20và\x20dễ\x20hiểu\x20nhất.</li></ol><h4>Cốt\x20Lõi</h4><p>Kỹ\x20thuật\x20Feynman\x20buộc\x20bạn\x20phải\x20chuyển\x20từ\x20việc\x20tiếp\x20thu\x20thụ\x20động\x20(đọc,\x20nghe)\x20sang\x20chủ\x20động\x20xử\x20lý\x20thông\x20tin.\x20Quá\x20trình\x20\x22bị\x20kẹt\x22\x20khi\x20giải\x20thích\x20chính\x20là\x20công\x20cụ\x20chẩn\x20đoán\x20mạnh\x20mẽ\x20nhất,\x20nó\x20chỉ\x20ra\x20chính\x20xác\x20điểm\x20bạn\x20còn\x20yếu.</p><p><i>Cách\x20nhanh\x20nhất\x20để\x20kiểm\x20tra\x20và\x20củng\x20cố\x20sự\x20hiểu\x20biết\x20của\x20bạn\x20là\x20thử\x20dạy\x20lại\x20nó\x20cho\x20người\x20khác\x20một\x20cách\x20đơn\x20giản.</i></p>','documentElement','Không\x20tìm\x20thấy\x20bản\x20sao\x20lưu.','save','innerHTML','Đã\x20lưu\x20ghi\x20chú','💡\x20Gợi\x20ý:\x20','topic-actions','object','div','\x20·\x20','color','#currentSubtopicNameChat','#set_cycles','join','selectedSubtopicId','timer.cycleInfo','<div><span\x20class=\x22tiny\x22>(chưa\x20có\x20ghi\x20chú)</span></div>','Nhớ\x20uống\x20một\x20ngụm\x20nước\x20nhé!','_sortable','ArrowUp','#settings-pomodoro','file:','#settings-flowtime','#genericInput','Hãy\x20chọn\x20một\x20Chủ\x20đề\x20con\x20trước\x20khi\x20bắt\x20đầu','#set_enableSessionNotes','download','Initialization\x20error:','unMute','application/json','3999996BwvhVM','Lắng\x20nghe\x20hơi\x20thở\x20ra\x20vào\x20qua\x20mũi.','Bạn\x20có\x20chắc\x20muốn\x20chuyển\x20sang\x20Kiểu\x20','name','100\x20giờ!\x20Đây\x20không\x20còn\x20là\x20một\x20thử\x20nghiệm\x20nữa,\x20mà\x20là\x20một\x20sự\x20đầu\x20tư\x20nghiêm\x20túc\x20cho\x20mục\x20tiêu\x20của\x20bạn.\x0a\x0aHãy\x20dành\x20một\x20chút\x20thời\x20gian\x20để\x20nhìn\x20lại:\x20100\x20giờ\x20tập\x20trung\x20này\x20đã\x20giúp\x20bạn\x20tiến\x20xa\x20đến\x20đâu?\x20Năng\x20lượng\x20bạn\x20bỏ\x20ra\x20đang\x20định\x20hình\x20nên\x20kết\x20quả.','LÀM\x20VIỆC','chime','mousemove','subtopic','＋\x20Thêm','timerState','dateISO','totalMinutes','querySelectorAll','currentConfig','menu-active','#currentSubtopicName','Chủ\x20đề\x20con:\x20','restoreBackup','#timeDisplay','\x27\x20·\x20Mode\x20','<div\x20class=\x22tiny\x22>Chưa\x20có\x20phiên\x20nào</div>','loadLanguage','Đã\x20lưu\x20cài\x20đặt','#draggableTimer','8793BWJUUL','warn','code','Ẩn\x20giao\x20diện','#modalGeneric','note','.nav-btn[data-view=\x22','appendChild','ArrowRight','forEach','428271qIKsst','Uống\x20một\x20ly\x20nước\x20để\x20giữ\x20đủ\x20nước.','Nắn\x20nhẹ\x20các\x20khớp\x20ngón\x20tay\x20sau\x20khi\x20gõ\x20phím.','Tóm\x20tắt\x20các\x20ghi\x20chú\x20sau\x20theo\x20gạch\x20đầu\x20dòng,\x20ngắn\x20gọn,\x20rõ\x20ràng:\x0a\x0a','Phục\x20hồi\x20dữ\x20liệu\x20thành\x20công!\x20Tải\x20lại\x20trang...','isCompleted','defer','/maxresdefault.jpg','text/plain','menu-item\x20danger','1455qoYkjc','Massage\x20nhẹ\x20hai\x20bên\x20thái\x20dương.','<div\x20class=\x22tiny\x22>Chưa\x20có\x20tóm\x20tắt\x20nào.</div>','B_long','#toasts','querySelector','topicsList','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<table\x20class=\x22dashboard-table\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<thead><tr><th>Chủ\x20đề</th><th>Chủ\x20đề\x20con</th><th>Thời\x20gian</th><th>Phiên</th><th>Nhiệm\x20vụ</th></tr></thead>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tbody>','user','#btnDashboard','badge','</tbody></table>','</td><td>','A_short','pauseVideo','head','#set_ytThumbAsBg','#view-methods','start','Nhắm\x20mắt\x20và\x20thư\x20giãn\x20trong\x20một\x20phút.','.\x20Vui\x20lòng\x20thử\x20lại\x20với\x20nội\x20dung\x20khác.','B_work','Vui\x20lòng\x20chọn\x20một\x20bản\x20sao\x20lưu.','A_work','resume','isArray','async','sid','Vui\x20lòng\x20thêm\x20Gemini\x20API\x20Key\x20trong\x20Cài\x20đặt\x20để\x20sử\x20dụng\x20tính\x20năng\x20này.','wind_down','theme','Thoát\x20toàn\x20màn\x20hình','Chưa\x20chọn\x20Chủ\x20đề\x20con','#statSessions','Lặp\x20Lại\x20Ngắt\x20Quãng\x20(Spaced\x20Repetition):\x20Học\x20Đúng\x20Thời\x20Điểm','change','#btnAutoFormat','contentWindow','getPlayerState','POST','onYouTubeIframeAPIReady','\x20tiếng\x20','indexOf','long_break','#btnEnableSound','pointerdown','acc','match','filter','finished','#genericMessage','<p\x20class=\x22tiny\x22\x20style=\x22opacity:0.7;\x22>Chưa\x20có\x20tri\x20thức\x20nào\x20trong\x20Chủ\x20đề\x20con\x20này.</p>','find','tasks','Phiên\x20đã\x20hoàn\x20thành!\x20Nhấn\x20Bắt\x20đầu\x20để\x20bắt\x20đầu\x20phiên\x20tiếp\x20theo.','beep','Xóa\x20Chủ\x20đề','<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20width=\x2216\x22\x20height=\x2216\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22><path\x20d=\x22M2\x2012s3-7\x2010-7\x2010\x207\x2010\x207-3\x207-10\x207-10-7-10-7Z\x22/><circle\x20cx=\x2212\x22\x20cy=\x2212\x22\x20r=\x223\x22/></svg>','#ytSoundVolume','</label>','note-item','no-subtopic-selected','LÀM\x20VIỆC\x20(FLOW)','Đã\x20xóa\x20lịch\x20sử\x20chat.','currentView','#historyList','note-meta','Mở\x20cửa\x20sổ\x20cho\x20không\x20khí\x20mới\x20vào\x20phòng.','onkeydown','PlayerState','pomodoro_backup_','#set_work','topic-title','onupgradeneeded','revokeObjectURL','#btnPresetB','createGain','activeElement','aria-expanded','1677092hmBaDR','backgroundMode','Kỹ\x20Thuật\x20Feynman:\x20Hiểu\x20Sâu\x20Bằng\x20Cách\x20Giải\x20Thích\x20Đơn\x20Giản','<input\x20type=\x22checkbox\x22\x20id=\x22','Dùng\x20AI\x20để\x20tự\x20động\x20định\x20dạng\x20văn\x20bản','#set_short','innerWidth','clientX','select','ArrowDown','backgroundImage','\x0a-\x20','subtopics-group','Đã\x20khôi\x20phục\x20mặc\x20định','removeProperty','9597020URmUTb','cyclesTarget','(chưa\x20chọn)','apiKey','Nhập\x20thất\x20bại:\x20','enableWinddown','http:','#chatInput','preset','0\x20phút','#subtopicTasksList','A_winddown','250\x20giờ\x20là\x20minh\x20chứng\x20cho\x20sự\x20bền\x20bỉ\x20đáng\x20kinh\x20ngạc.\x20Bạn\x20đã\x20đối\x20mặt\x20với\x20những\x20ngày\x20khó\x20khăn,\x20những\x20lúc\x20mất\x20tập\x20trung,\x20nhưng\x20bạn\x20vẫn\x20quay\x20trở\x20lại.\x20Sức\x20mạnh\x20thực\x20sự\x20nằm\x20ở\x20chính\x20sự\x20kiên\x20trì\x20này.','<p>Nếu\x20Gợi\x20nhớ\x20chủ\x20động\x20là\x20về\x20cách\x20học,\x20thì\x20Lặp\x20lại\x20ngắt\x20quãng\x20là\x20về\x20thời\x20điểm\x20học.\x20Đây\x20là\x20một\x20hệ\x20thống\x20lên\x20lịch\x20ôn\x20tập\x20để\x20đưa\x20thông\x20tin\x20vào\x20trí\x20nhớ\x20dài\x20hạn\x20một\x20cách\x20hiệu\x20quả\x20nhất.</p><h4>Nguyên\x20Tắc\x20Cốt\x20Lõi:\x20Chống\x20Lại\x20Sự\x20Lãng\x20Quên\x20🧠</h4><p>Phương\x20pháp\x20này\x20dựa\x20trên\x20\x22Đường\x20cong\x20Lãng\x20quên\x22,\x20cho\x20thấy\x20chúng\x20ta\x20quên\x20thông\x20tin\x20nhanh\x20nhất\x20ngay\x20sau\x20khi\x20học.\x20Lặp\x20lại\x20ngắt\x20quãng\x20hoạt\x20động\x20bằng\x20cách\x20yêu\x20cầu\x20bạn\x20ôn\x20tập\x20lại\x20một\x20thông\x20tin\x20ngay\x20trước\x20khi\x20bạn\x20sắp\x20quên\x20nó.</p><p>Mỗi\x20lần\x20ôn\x20tập\x20thành\x20công\x20sẽ\x20làm\x20cho\x20khoảng\x20thời\x20gian\x20bạn\x20nhớ\x20thông\x20tin\x20đó\x20dài\x20ra.\x20Lần\x20đầu\x20bạn\x20có\x20thể\x20quên\x20sau\x201\x20ngày,\x20nhưng\x20sau\x20khi\x20ôn\x20tập,\x20bạn\x20sẽ\x20nhớ\x20được\x20trong\x203\x20ngày,\x20rồi\x201\x20tuần,\x201\x20tháng,\x20và\x20cứ\x20thế\x20xa\x20dần.</p><h4>Công\x20Cụ\x20Hiệu\x20Quả\x20Nhất:\x20Phần\x20Mềm\x20SRS\x20📱</h4><p>Thay\x20vì\x20tự\x20lên\x20lịch\x20thủ\x20công,\x20cách\x20hiệu\x20quả\x20nhất\x20là\x20sử\x20dụng\x20các\x20phần\x20mềm\x20Lặp\x20lại\x20ngắt\x20quãng\x20(Spaced\x20Repetition\x20Software\x20-\x20SRS).\x20Anki\x20được\x20xem\x20là\x20tiêu\x20chuẩn\x20vàng.\x20Nó\x20tự\x20động\x20hóa\x20hoàn\x20toàn\x20việc\x20lên\x20lịch\x20ôn\x20tập\x20cho\x20hàng\x20ngàn\x20thẻ\x20ghi\x20nhớ\x20dựa\x20trên\x20độ\x20khó\x20mà\x20bạn\x20tự\x20đánh\x20giá,\x20đảm\x20bảo\x20bạn\x20luôn\x20ôn\x20tập\x20vào\x20thời\x20điểm\x20tối\x20ưu\x20nhất.</p><h4>Sai\x20Lầm\x20Lớn\x20Nhất\x20Cần\x20Tránh\x20❌</h4><p>Lý\x20do\x20số\x20một\x20khiến\x20mọi\x20người\x20thất\x20bại\x20với\x20phương\x20pháp\x20này\x20là\x20\x22Quá\x20tải\x20Lịch\x20ôn\x20tập\x22\x20(Review\x20Overload).\x20Điều\x20này\x20xảy\x20ra\x20khi\x20bạn\x20tạo\x20quá\x20nhiều\x20thẻ\x20mới\x20mỗi\x20ngày\x20hoặc\x20bỏ\x20lỡ\x20vài\x20ngày\x20ôn\x20tập,\x20dẫn\x20đến\x20một\x20lượng\x20thẻ\x20tồn\x20đọng\x20khổng\x20lồ\x20gây\x20nản\x20chí.</p><p><strong>Giải\x20pháp\x20(20%\x20hành\x20động,\x2080%\x20kết\x20quả):</strong>\x20Hãy\x20nhất\x20quán.\x20Đặt\x20ra\x20giới\x20hạn\x20thực\x20tế\x20về\x20số\x20lượng\x20thẻ\x20mới\x20mỗi\x20ngày\x20(ví\x20dụ:\x2010-20\x20thẻ)\x20và\x20duy\x20trì\x20việc\x20ôn\x20tập\x20hàng\x20ngày.\x20Thà\x20học\x20ít\x20mà\x20đều\x20còn\x20hơn\x20học\x20dồn.</p><h4>Sự\x20Kết\x20Hợp\x20Sống\x20Còn:\x20AR\x20+\x20SR</h4><p>Lặp\x20lại\x20ngắt\x20quãng\x20(SR)\x20và\x20Gợi\x20nhớ\x20chủ\x20động\x20(AR)\x20là\x20hai\x20mặt\x20của\x20cùng\x20một\x20đồng\x20xu\x20và\x20không\x20thể\x20tách\x20rời.\x20SR\x20cung\x20cấp\x20lịch\x20trình\x20KHI\x20NÀO\x20nên\x20ôn\x20tập.\x20AR\x20là\x20hành\x20động\x20bạn\x20thực\x20hiện\x20KHI\x20ôn\x20tập.\x20Sự\x20kết\x20hợp\x20này\x20đảm\x20bảo\x20nỗ\x20lực\x20gợi\x20nhớ\x20của\x20bạn\x20xảy\x20ra\x20vào\x20\x22điểm\x20ngọt\x22\x20của\x20trí\x20nhớ.\x20Sử\x20dụng\x20Anki\x20chính\x20là\x20cách\x20triển\x20khai\x20kỹ\x20thuật\x20kết\x20hợp\x20này\x20một\x20cách\x20hiệu\x20quả\x20nhất.</p>','youtubeVolume','reload','#modalMilestone','finishFlowSession','triangle','removeEventListener','beforeunload','6858BaueHs','customBg','Thêm\x20Tri\x20thức\x20mới','.topic-item.menu-active','#set_volume','Xác\x20nhận\x20xóa','541928RfFDdu','toISOString','protocol','#btnSaveSettings','pomodoroData_v11','cancel','timer.selectSubtopicPrompt','stopVideo','#btnHelpCreateTopic','createOscillator','beginWindDown','Đổi\x20tên\x20Chủ\x20đề','Chỉnh-sửa\x20Tri\x20thức','PLAYING','Chú\x20ý\x20đến\x20cảm\x20giác\x20nhiệt\x20độ,\x20ánh\x20sáng\x20trong\x20phòng.','_startTick','#btnTestSound','\x20|\x20<strong>Tổng\x20phiên:</strong>\x20','status','yt-fallback','<div\x20class=\x22tiny\x22>Chưa\x20có\x20dữ\x20liệu</div>','currentDurations','Lỗi\x20phát\x20âm\x20thanh:','localeCompare','log','#btnFullscreen','<h4>','badge\x20state\x20break','Không\x20thể\x20lưu\x20thay\x20đổi.','getBackupList','function','customSounds','soundTheme','focus','ArrowLeft','connect','by_topic','body','#btnRestoreBackup','<li\x20class=\x22tiny\x22\x20style=\x22opacity:\x200.7;\x22>Tuyệt\x20vời!\x20Không\x20còn\x20task\x20nào.</li>','dataset','open','toLocaleDateString','selectionEnd','right','/hqdefault.jpg','.method-item\x20.method-content','https://www.youtube.com','createdAt','aria-pressed','segmentTotal','chatHistory','sort','#btnBreakEarly','objectStoreNames','Lỗi\x20khởi\x20tạo:\x20','Thả\x20lỏng\x20hai\x20chân,\x20lắc\x20nhẹ\x20cổ\x20chân\x20dưới\x20bàn.','Đếm\x20ngược\x20từ\x2020\x20đến\x200\x20thật\x20chậm\x20rãi.','cueVideoById','<div\x20class=\x22tiny\x22>Vui\x20lòng\x20chọn\x20một\x20chủ\x20đề\x20con\x20để\x20xem\x20tóm\x20tắt.</div>','Tóm\x20tắt\x20thất\x20bại.','#view-methods\x20.methods-container','parse','Hãy\x20đứng\x20dậy\x20vươn\x20vai\x20và\x20duỗi\x20người.','now','Gửi\x20bạn,\x201.000\x20giờ\x20(Chuyển\x20hóa)','value','left','#modalDashboard','var(--warn)','origin','#modalNote','tagName','add','durations','Tên\x20Chủ\x20đề\x20con\x20mới?','work','#btnAddTopic','remaining','getMonth','.actions-menu','reduce','#modalMethodEditor','#importFile','setValueAtTime','NGHỈ\x20DÀI','Lỗi\x20khi\x20gọi\x20Gemini\x20API:','json','?\x20Thao\x20tác\x20này\x20sẽ\x20dừng\x20và\x20đặt\x20lại\x20phiên\x20làm\x20việc\x20hiện\x20tại.','error','long','#btnCancelMethodEditor','keydown','</ul>','clear','push','Bạn\x20có\x20chắc\x20muốn\x20xóa\x20tóm\x20tắt\x20này?','AI\x20đã\x20định\x20dạng\x20xong!','map','.topic-item','<option\x20value=\x22\x22>Không\x20có\x20bản\x20sao\x20lưu\x20nào</option>','\x20hidden','none','var(--muted)','TẠM\x20DỪNG','Chào\x20mừng\x20đến\x20Câu\x20lạc\x20bộ\x201000\x20giờ.\x0a\x0aCon\x20số\x20này\x20không\x20chỉ\x20đo\x20lường\x20thời\x20gian,\x20nó\x20đại\x20diện\x20cho\x20sự\x20chuyển\x20hóa.\x20Sự\x20tập\x20trung\x20đã\x20trở\x20thành\x20một\x20phần\x20con\x20người\x20bạn,\x20một\x20\x27siêu\x20năng\x20lực\x27\x20bạn\x20có\x20thể\x20triệu\x20hồi.\x20Hành\x20trình\x20của\x20bạn\x20thực\x20sự\x20truyền\x20cảm\x20hứng.','Gửi\x20bạn,\x2050\x20giờ\x20(Động\x20lực)','replace','light','width','fullscreenchange','execCommand','date','foreColor','topic-header','updateSettings','var(--danger)','#set_panelOpacity','break_end','</ol>','Gửi\x20bạn,\x20100\x20giờ\x20cống\x20hiến\x20(Cam\x20kết)','long_end','Chưa\x20có\x20ghi\x20chú\x20để\x20tóm\x20tắt.','from','Lỗi\x20từ\x20Gemini:\x20','removing','#uploadSoundLong','Vui\x20lòng\x20chọn\x20một\x20Chủ\x20đề\x20con\x20trước.','floor','#noteText','getDate','undefined','autoplay;\x20encrypted-media;\x20picture-in-picture','gain','Năm\x20giờ\x20tập\x20trung!\x20Bạn\x20đã\x20vượt\x20qua\x20rào\x20cản\x20lớn\x20nhất:\x20sự\x20trì\x20hoãn.\x20Mỗi\x20phút\x20bạn\x20dành\x20ra\x20đều\x20là\x20một\x20lời\x20khẳng\x20định\x20cho\x20mục\x20tiêu\x20của\x20mình.\x20Hãy\x20giữ\x20vững\x20ngọn\x20lửa\x20này!','<li>','#btnToggleCustomSounds','lang','location','promptFeedback','Xem\x20một\x20tấm\x20ảnh\x20dễ\x20thương\x20hoặc\x20làm\x20bạn\x20vui.','Sắp\x20xếp\x20lại\x20không\x20gian\x20làm\x20việc\x20của\x20bạn.','beginBreak','</div>','AutoBackup\x20error:','Xác\x20nhận\x20chuyển\x20đổi','winddown','mute','get','scrollTop','Chưa\x20có\x20link\x20hợp\x20lệ.\x20Dán\x20link\x20rồi\x20bấm\x20▶.','Xóa','--panel-opacity','disabled','cyclesA','A_long','summary_','isNaN','#toolItalic','Thêm\x20tùy\x20chọn','&lt;','textContent','Sortable','getItem','#btnSettings','iframe','getBoundingClientRect','#btnSkipNote','update','string','<p\x20class=\x22tiny\x22\x20style=\x22opacity:0.7;\x22>Vui\x20lòng\x20chọn\x20một\x20Chủ\x20đề\x20con\x20để\x20xem\x20Kho\x20Tri\x20Thức.</p>','.method-item','#modalSettings','Vui\x20lòng\x20chọn\x20một\x20Chủ\x20đề\x20con\x20trước\x20khi\x20thực\x20hiện\x20thao\x20tác.','test','API\x20response\x20structure\x20is\x20unexpected:','\x20(B)','requestFullscreen','stopPropagation','.sub-row','sound_unlocked','work_end','setProperty','repeat','toast','Sửa','</li>','.method-edit','Gửi','cover','skip','Lỗi:\x20Gemini\x20API\x20Key\x20không\x20hợp\x20lệ\x20hoặc\x20đã\x20bị\x20thay\x20đổi.\x20Vui\x20lòng\x20kiểm\x20tra\x20lại\x20trong\x20Cài\x20đặt.','<p>Benjamin\x20Franklin\x20đã\x20tự\x20rèn\x20luyện\x20kỹ\x20năng\x20viết\x20từ\x20kém\x20cỏi\x20trở\x20nên\x20bậc\x20thầy\x20bằng\x20một\x20phương\x20pháp\x20chủ\x20động,\x20thay\x20vì\x20chỉ\x20đọc\x20một\x20cách\x20thụ\x20động.\x20Cốt\x20lõi\x20của\x20phương\x20pháp\x20này\x20là\x20phân\x20tích,\x20tái\x20tạo,\x20và\x20so\x20sánh\x20với\x20một\x20bài\x20viết\x20chất\x20lượng\x20cao.</p><p>Đây\x20là\x20một\x20ví\x20dụ\x20kinh\x20điển\x20của\x20\x22Luyện\x20tập\x20có\x20Chủ\x20đích\x22:\x20tập\x20trung\x20vào\x20điểm\x20yếu,\x20có\x20mục\x20tiêu\x20rõ\x20ràng\x20và\x20nhận\x20phản\x20hồi\x20ngay\x20lập\x20tức.</p><h4>Quy\x20Trình\x203\x20Bước\x20Cốt\x20Lõi</h4><ol><li><strong>Phân\x20Tích\x20(Deconstruct):</strong>\x20Đọc\x20một\x20bài\x20viết\x20mẫu\x20xuất\x20sắc.\x20Sau\x20đó,\x20chỉ\x20ghi\x20lại\x20những\x20ý\x20chính\x20của\x20từng\x20đoạn\x20hoặc\x20từng\x20câu\x20ra\x20một\x20tờ\x20giấy\x20riêng.</li><li><strong>Tái\x20Tạo\x20(Reconstruct):</strong>\x20Vài\x20ngày\x20sau,\x20khi\x20đã\x20quên\x20đi\x20văn\x20phong\x20của\x20bản\x20gốc,\x20hãy\x20dùng\x20những\x20ghi\x20chú\x20ý\x20chính\x20đó\x20để\x20viết\x20lại\x20toàn\x20bộ\x20bài\x20viết\x20bằng\x20ngôn\x20ngữ\x20và\x20cách\x20diễn\x20đạt\x20của\x20chính\x20bạn.</li><li><strong>So\x20Sánh\x20&\x20Sửa\x20Lỗi\x20(Compare\x20&\x20Correct):</strong>\x20Đối\x20chiếu\x20trực\x20tiếp\x20bài\x20viết\x20của\x20bạn\x20với\x20bản\x20gốc.\x20Đây\x20là\x20bước\x20quan\x20trọng\x20nhất.\x20Nó\x20giúp\x20bạn\x20phát\x20hiện\x20ngay\x20lập\x20tức\x20những\x20lỗi\x20sai\x20về\x20từ\x20vựng,\x20cấu\x20trúc\x20câu,\x20và\x20cách\x20sắp\x20xếp\x20ý\x20tưởng\x20để\x20sửa\x20chữa.</li></ol><p>Franklin\x20còn\x20thực\x20hành\x20các\x20biến\x20thể\x20nâng\x20cao\x20như\x20xáo\x20trộn\x20thứ\x20tự\x20các\x20ý\x20chính\x20để\x20rèn\x20luyện\x20tư\x20duy\x20logic,\x20hoặc\x20chuyển\x20văn\x20xuôi\x20thành\x20thơ\x20để\x20làm\x20giàu\x20vốn\x20từ.</p><h4>Nguyên\x20Tắc\x20Vàng</h4><p>Thành\x20công\x20của\x20phương\x20pháp\x20này\x20không\x20đến\x20từ\x20việc\x20lặp\x20lại\x20vô\x20thức,\x20mà\x20đến\x20từ\x20vòng\x20lặp\x20phản\x20hồi\x20trực\x20tiếp.\x20Việc\x20so\x20sánh\x20với\x20bản\x20gốc\x20buộc\x20bạn\x20phải\x20đối\x20mặt\x20và\x20sửa\x20chữa\x20những\x20điểm\x20yếu\x20cụ\x20thể\x20của\x20mình,\x20biến\x20việc\x20học\x20từ\x20một\x20quá\x20trình\x20mơ\x20hồ\x20thành\x20một\x20bài\x20tập\x20có\x20thể\x20đo\x20lường\x20được.</p><p><i>Để\x20viết\x20giỏi\x20hơn,\x20đừng\x20chỉ\x20đọc.\x20Hãy\x20chọn\x20một\x20bài\x20viết\x20hay,\x20phân\x20tích\x20nó,\x20cố\x20gắng\x20viết\x20lại,\x20và\x20so\x20sánh\x20để\x20tìm\x20ra\x20lỗi\x20sai.</i></p>','summaries','topicId','toString','importData','transition','#genericTitle','checked','Lỗi\x20HTTP:\x20','#toolList','Tóm\x20tắt','setVolume','length','message','.app-content','selectedTopicId','Kiểm\x20tra\x20và\x20chỉnh\x20lại\x20tư\x20thế\x20ngồi\x20cho\x20đúng.','Thêm\x20ghi\x20chú','-9999px','#methodEditorTitle','timer','#newSubtopicTaskInput','generalNotes','stringify','#btnAddSubtopicTask','#btnSaveNote','longBreakIntervalA','backgroundSize','soundOn','toggle','__ytApiPromise','getFullYear','stats','then','isConnected','<ol>','contains','show','\x22?\x20Mọi\x20dữ\x20liệu\x20liên\x20quan\x20sẽ\x20bị\x20mất.','setRangeText','append','Enter','badge\x20state\x20long','cycleIndex','Tệp\x20không\x20đúng\x20định\x20dạng','ytUrlFeedback','state','50\x20giờ\x20tập\x20trung!\x20Thói\x20quen\x20của\x20bạn\x20đang\x20tạo\x20ra\x20động\x20lực.\x20Sự\x20nhất\x20quán\x20nhỏ\x20bé\x20mỗi\x20ngày\x20đang\x20cộng\x20hưởng\x20thành\x20những\x20bước\x20tiến\x20lớn.\x20Bạn\x20đang\x20đi\x20đúng\x20hướng,\x20hãy\x20tiếp\x20tục\x20phát\x20huy.','#dashboardContent','Đứng\x20lên\x20và\x20đi\x20lại\x20vài\x20bước\x20để\x20máu\x20lưu\x20thông.','hours','#toolBold','newIndex','var(--acc-2)','#set_theme_color','oldIndex','Dựa\x20vào\x20thông\x20tin\x20sau:\x0a-\x20Chủ\x20đề:\x20\x22','Sửa\x20tên\x20Chủ\x20đề\x20con','auto','img.youtube.com/vi/','#audioLongEnd','#btnAddGeneralNote','Backup\x20failed:','#welcomePanel','Nhẹ\x20nhàng\x20nhắm\x20mắt\x20và\x20mỉm\x20cười\x20với\x20chính\x20mình.','note-content-wrapper','youtube-player-container','.method-delete','Âm\x20thanh\x20đã\x20được\x20bật!','Thả\x20lỏng\x20toàn\x20thân,\x20cảm\x20nhận\x20hơi\x20thở.','.timer-circle-container','baseVal','Vui\x20lòng\x20nhập\x20Gemini\x20API\x20Key\x20trong\x20phần\x20Cài\x20đặt.','methods','Deleted\x20old\x20backup:\x20','flex','includes','.tab-content','Bạn\x20có\x20chắc\x20muốn\x20xóa\x20toàn\x20bộ\x20lịch\x20sử\x20chat\x20của\x20chủ\x20đề\x20con\x20này?','<div\x20class=\x22tiny\x22>Chưa\x20có\x20tin\x20nhắn\x20nào.</div>','Chúc\x20mừng\x20bạn\x20đã\x20làm\x20được\x20điều\x20khó\x20nhất:\x20Bắt\x20đầu\x20và\x20duy\x20trì.\x0a\x0a20\x20giờ\x20không\x20chỉ\x20là\x20thời\x20gian,\x20đó\x20là\x2020\x20giờ\x20bạn\x20đã\x20chiến\x20thắng\x20sự\x20xao\x20nhãng.\x20Bạn\x20đang\x20xây\x20dựng\x20một\x20nền\x20tảng\x20vững\x20chắc\x20cho\x20sự\x20kỷ\x20luật.\x20Hãy\x20tự\x20hào\x20về\x20khởi\x20đầu\x20này.','#welcomePanel\x20p','target','reset','beginWork','#set_winddown','#btnToggleBg','--bg-image','#btnStart','main_settings','var(--sub)','btnToggleYtSound','_onFinishSegment','top','Tuyệt\x20vời!\x20Đã\x20đến\x20lúc\x20nghỉ\x20dài.','padStart','🌊\x20Flow','url(','http','#btnGenericCancel','.presets\x20button','relative','durationMinutes','splice','Nhìn\x20ra\x20xa\x20qua\x20cửa\x20sổ\x20trong\x2020\x20giây.','about:blank','#set_apiKey','<div\x20class=\x22tiny\x22>Chưa\x20có\x20ghi\x20chú.</div>','href','scroll','ghost','__ytApiWatchdog','B_short','_getStore','.view','Player','#ytUrlFeedback','#btnSendMessage','Bạn\x20có\x20chắc\x20muốn\x20xóa\x20Chủ\x20đề\x20\x22','autoStartNext','load','#set_enableWinddown','#set_autoStartNext','prevState','Đặt\x20tay\x20lên\x20ngực,\x20cảm\x20nhận\x20nhịp\x20tim\x20của\x20mình.','bold','getAllKeys','2384JTpbEO','put','initDB','Missing\x20element','Lỗi\x20lưu\x20dữ\x20liệu:\x20','Gửi\x20bạn,\x20500\x20giờ\x20(Chuyên\x20tâm)','<div\x20class=\x22hist-meta\x22>','Đếm\x20chậm\x20từng\x20nhịp\x20thở\x20đến\x20số\x2010.','Đi\x20dạo\x20một\x20vòng\x20ngắn\x20quanh\x20phòng.','.tab-btn','idle','sine','#methodEditorId','absolute','.json','className','lastBackupDate','setPreset','bg-view-mode','&quot;','max','.actions-menu-btn','https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=','blockReason','currentTime','SẴN\x20SÀNG','resolve','topic','sessions','statusText','...','candidates','#backupList','#btnExport','result','#milestoneTitle','#aiPromptSuggestions\x20button','tab','Gợi\x20Nhớ\x20Chủ\x20Động\x20(Active\x20Recall):\x20Nguyên\x20Tắc\x20Cốt\x20Lõi\x20Để\x20Học\x20Sâu','#btnSummarize','destroy','Toàn\x20màn\x20hình','reloading','italic','Phương\x20Pháp\x20Viết\x20của\x20Benjamin\x20Franklin:\x20Học\x20Viết\x20Bằng\x20Cách\x20Tái\x20Tạo','settings','.aux-panel,\x20.modal-card','backups','playVideo','Gemini\x20API\x20Error:','unshift','onerror','Đã\x20xóa\x20tóm\x20tắt.','chev\x20btn\x20small\x20ghost','space','breathing','onsuccess','#btnSkip','startsWith','.nav-btn[data-view]','Đã\x20lưu\x20âm\x20báo\x20hết\x20NGHỈ\x20NGẮN.','<div\x20class=\x22tiny\x22>Chọn\x20chủ\x20đề\x20con\x20để\x20bắt\x20đầu\x20chat.</div>','#breakSuggestionDisplay','innerHeight','Space','height','Gửi\x20bạn,\x205.000+\x20giờ\x20(Di\x20sản)','round','position','task','.subtopics','?\x20Dữ\x20liệu\x20hiện\x20tại\x20sẽ\x20bị\x20ghi\x20đè.','https://www.youtube.com/iframe_api','#audioWorkEnd','files','AI\x20không\x20thể\x20định\x20dạng\x20lúc\x20này.','parts','tickHandle','getElementById','content','substring','#summariesList','Nghe\x20một\x20bản\x20nhạc\x20yêu\x20thích.','https://www.youtube.com/embed/','Đã\x20cập\x20nhật\x20hình\x20nền.','input,select,textarea','Thêm\x20Chủ\x20đề\x20con','#btnFinishFlow','#timerPresetSelector\x20button','.color-picker-wrapper','.actions-menu.show','version','longBreakIntervalB','autoBackup','Đến\x20giờ\x20hạ\x20nhiệt.\x20Hãy\x20kết\x20thúc\x20công\x20việc\x20và\x20chuẩn\x20bị\x20nghỉ\x20ngơi.','Lỗi:\x20Không\x20thể\x20bật\x20chế\x20độ\x20toàn\x20màn\x20hình:\x20','option','Tự\x20hỏi\x20bản\x20thân:\x20“Mình\x20cảm\x20thấy\x20thế\x20nào\x20lúc\x20này?”','text','cycles','clientY','#set_flowRatio','#btnCloseDashboard','btn\x20small\x20ghost\x20actions-menu-btn','default','Không\x20tải\x20được\x20API\x20YouTube.\x20Kiểm\x20tra\x20mạng\x20hoặc\x20tải\x20lại\x20trang.','Đã\x20tắt\x20nền\x20YouTube\x20để\x20hợp\x20với\x20theme\x20sáng.','Bước\x20ra\x20ban\x20công,\x20tận\x20hưởng\x20ánh\x20sáng\x20tự\x20nhiên.','<ul>','Đã\x20nhập\x20dữ\x20liệu\x20thành\x20công!','#btnGenericOk','exportData','<p\x20class=\x22tiny\x22><strong>Tổng\x20thời\x20gian:</strong>\x20','catch','IndexedDB\x20initialized\x20successfully.','trim'];_0x5ccb=function(){return _0x52a394;};return _0x5ccb();}(function(_0x4203b1,_0x330a24){const _0x4203ed=_0x2c31,_0x5bc5a7=_0x4203b1();while(!![]){try{const _0x38d5e1=-parseInt(_0x4203ed(0x2d0))/0x1*(-parseInt(_0x4203ed(0x3fc))/0x2)+-parseInt(_0x4203ed(0x379))/0x3+parseInt(_0x4203ed(0x3d2))/0x4+parseInt(_0x4203ed(0x383))/0x5*(-parseInt(_0x4203ed(0x3f6))/0x6)+-parseInt(_0x4203ed(0x356))/0x7+-parseInt(_0x4203ed(0x214))/0x8*(parseInt(_0x4203ed(0x36f))/0x9)+parseInt(_0x4203ed(0x3e1))/0xa;if(_0x38d5e1===_0x330a24)break;else _0x5bc5a7['push'](_0x5bc5a7['shift']());}catch(_0x3f7b32){_0x5bc5a7['push'](_0x5bc5a7['shift']());}}}(_0x5ccb,0x4c2bb),window[_0x1b5e35(0x2f7)](_0x1b5e35(0x20d),()=>{try{updateFullscreenButton();}catch(_0x4640e8){}}));const IS_FILE_PROTOCOL=window[_0x1b5e35(0x15f)][_0x1b5e35(0x3fe)]===_0x1b5e35(0x34d);function startYtApiWatchdog(){const _0x3bedf2=_0x1b5e35,_0x4a4d43=document['getElementById']('ytUrlFeedback');if(!_0x4a4d43)return;const _0x267461=setTimeout(()=>{const _0x1abcbd=_0x2c31;try{(!window['YT']||!window['YT']['Player'])&&(_0x4a4d43[_0x1abcbd(0x176)]='Đang\x20tải\x20API\x20YouTube...',_0x4a4d43[_0x1abcbd(0x300)][_0x1abcbd(0x342)]=_0x1abcbd(0x1ef));}catch(_0x334b12){}},0x5dc),_0x2dcf54=setTimeout(()=>{const _0xfb295e=_0x2c31;try{(!window['YT']||!window['YT']['Player'])&&(_0x4a4d43[_0xfb295e(0x176)]=_0xfb295e(0x27d),_0x4a4d43['style'][_0xfb295e(0x342)]=_0xfb295e(0x149));}catch(_0x5f4cdb){}},0x1b58);window[_0x3bedf2(0x204)]={'cancel'(){clearTimeout(_0x267461),clearTimeout(_0x2dcf54);}};}(function(){const _0x34aa31=_0x1b5e35,_0x9b323d={'timer.cycleInfo':({current:current=0x0,target:target=0x0}={})=>'Chu\x20kỳ\x20'+current+'/'+target,'timer.selectSubtopicPrompt':_0x34aa31(0x182)};window['t']=function _0x4925cb(_0x13af8c,_0x2b3e52){const _0x57530c=_0x34aa31;try{const _0xe8c41f=_0x9b323d[_0x13af8c];if(typeof _0xe8c41f===_0x57530c(0xf3))return _0xe8c41f(_0x2b3e52||{});if(typeof _0xe8c41f===_0x57530c(0x17e))return _0xe8c41f;}catch(_0x850b9c){}return _0x13af8c;},window[_0x34aa31(0x36c)]=function _0x4827b1(_0x1cf16b){const _0xd52856=_0x34aa31;try{localStorage[_0xd52856(0x2c6)](_0xd52856(0x15e),_0x1cf16b||'vi');}catch(_0x52b7b1){}return Promise['resolve']();};}());function ensureYouTubeAPI(){const _0x36520c=_0x1b5e35;if(IS_FILE_PROTOCOL)return Promise[_0x36520c(0x22e)](![]);try{if(window['YT']&&window['YT'][_0x36520c(0x208)])return Promise[_0x36520c(0x22e)](!![]);}catch(_0x2da50f){}if(window[_0x36520c(0x1b3)])return window[_0x36520c(0x1b3)];return startYtApiWatchdog(),window[_0x36520c(0x1b3)]=new Promise((_0x50aa88,_0x2300d8)=>{const _0x508281=_0x36520c;try{const _0x26a96f=document[_0x508281(0x2b4)](_0x508281(0x2ba));_0x26a96f[_0x508281(0x325)]=_0x508281(0x25c),_0x26a96f[_0x508281(0x39d)]=!![],_0x26a96f[_0x508281(0x37f)]=!![],_0x26a96f['onload']=()=>_0x50aa88(!![]),_0x26a96f[_0x508281(0x247)]=()=>_0x2300d8(new Error('Failed\x20to\x20load\x20YouTube\x20API')),document[_0x508281(0x392)]['appendChild'](_0x26a96f);}catch(_0xdafa2b){_0x2300d8(_0xdafa2b);}}),window['__ytApiPromise'];}const storageManager={'DB_NAME':'PomodoroAppDB','DB_VERSION':0x1,'db':null,async 'initDB'(){return new Promise((_0x578953,_0x1b6656)=>{const _0x31b664=_0x2c31;if(this['db'])return _0x578953(this['db']);const _0x685fbc=indexedDB[_0x31b664(0xfe)](this[_0x31b664(0x2a4)],this['DB_VERSION']);_0x685fbc[_0x31b664(0x3cc)]=_0x2e3d01=>{const _0xadf80c=_0x31b664,_0x42dde2=_0x2e3d01[_0xadf80c(0x1e7)][_0xadf80c(0x236)];!_0x42dde2[_0xadf80c(0x10b)][_0xadf80c(0x1b9)](_0xadf80c(0x241))&&_0x42dde2[_0xadf80c(0x2ff)](_0xadf80c(0x241));!_0x42dde2[_0xadf80c(0x10b)][_0xadf80c(0x1b9)](_0xadf80c(0x28e))&&_0x42dde2['createObjectStore'](_0xadf80c(0x28e),{'keyPath':'id'});if(!_0x42dde2[_0xadf80c(0x10b)][_0xadf80c(0x1b9)](_0xadf80c(0x2d5))){const _0x5259de=_0x42dde2['createObjectStore'](_0xadf80c(0x2d5),{'keyPath':'id'});_0x5259de['createIndex'](_0xadf80c(0xf9),_0xadf80c(0x197));}!_0x42dde2[_0xadf80c(0x10b)]['contains']('backups')&&_0x42dde2[_0xadf80c(0x2ff)](_0xadf80c(0x243),{'keyPath':'date'});},_0x685fbc[_0x31b664(0x24c)]=_0x301731=>{const _0x508c5e=_0x31b664;this['db']=_0x301731[_0x508c5e(0x1e7)][_0x508c5e(0x236)],console['log'](_0x508c5e(0x286)),_0x578953(this['db']);},_0x685fbc[_0x31b664(0x247)]=_0x7ba6cb=>{const _0x83a23c=_0x31b664;console[_0x83a23c(0x12e)]('IndexedDB\x20error:',_0x7ba6cb[_0x83a23c(0x1e7)][_0x83a23c(0x2f4)]),_0x1b6656(_0x7ba6cb[_0x83a23c(0x1e7)][_0x83a23c(0x12e)]);};});},async '_getStore'(_0x581cb5,_0xfe47c7='readonly'){const _0x8dbc8f=_0x1b5e35;await this[_0x8dbc8f(0x216)]();const _0x117602=this['db'][_0x8dbc8f(0x296)]([_0x581cb5],_0xfe47c7);return _0x117602[_0x8dbc8f(0x30d)](_0x581cb5);},async 'getSettings'(){const _0x587e83=_0x1b5e35,_0x1d4292=await this[_0x587e83(0x206)](_0x587e83(0x241));return new Promise((_0x4f4c5c,_0x564dd2)=>{const _0x13e531=_0x587e83,_0x498888=_0x1d4292[_0x13e531(0x169)](_0x13e531(0x1ee));_0x498888['onsuccess']=()=>_0x4f4c5c(_0x498888[_0x13e531(0x236)]),_0x498888[_0x13e531(0x247)]=()=>_0x564dd2(_0x498888[_0x13e531(0x12e)]);});},async 'updateSettings'(_0x453faf){const _0x3fc35f=_0x1b5e35,_0x4a039b=await this[_0x3fc35f(0x206)](_0x3fc35f(0x241),'readwrite');return new Promise((_0x4c5ece,_0x10607e)=>{const _0x4ef32f=_0x3fc35f,_0x38789a=_0x4a039b[_0x4ef32f(0x215)](_0x453faf,_0x4ef32f(0x1ee));_0x38789a[_0x4ef32f(0x24c)]=()=>_0x4c5ece(_0x38789a[_0x4ef32f(0x236)]),_0x38789a[_0x4ef32f(0x247)]=()=>_0x10607e(_0x38789a[_0x4ef32f(0x12e)]);});},async 'getAll'(_0x5198d0){const _0x28945a=await this['_getStore'](_0x5198d0);return new Promise((_0x4ccd55,_0x3a02af)=>{const _0x3fb571=_0x2c31,_0x58e194=_0x28945a[_0x3fb571(0x2df)]();_0x58e194[_0x3fb571(0x24c)]=()=>_0x4ccd55(_0x58e194['result']),_0x58e194[_0x3fb571(0x247)]=()=>_0x3a02af(_0x58e194['error']);});},async 'update'(_0x59d9bd,_0x3227ba){const _0x1bf536=_0x1b5e35,_0x315cf1=await this[_0x1bf536(0x206)](_0x59d9bd,_0x1bf536(0x28a));return new Promise((_0x55aac1,_0x5889f7)=>{const _0x4ba202=_0x1bf536,_0x362f48=_0x315cf1[_0x4ba202(0x215)](_0x3227ba);_0x362f48[_0x4ba202(0x24c)]=()=>_0x55aac1(_0x362f48[_0x4ba202(0x236)]),_0x362f48['onerror']=()=>_0x5889f7(_0x362f48[_0x4ba202(0x12e)]);});},async 'add'(_0x2d4217,_0x5a10e0){const _0x21b86d=_0x1b5e35,_0x4a8595=await this[_0x21b86d(0x206)](_0x2d4217,_0x21b86d(0x28a));return new Promise((_0x5ec004,_0x2874cb)=>{const _0x33d51b=_0x21b86d,_0x44781=_0x4a8595[_0x33d51b(0x11e)](_0x5a10e0);_0x44781[_0x33d51b(0x24c)]=()=>_0x5ec004(_0x44781[_0x33d51b(0x236)]),_0x44781[_0x33d51b(0x247)]=()=>_0x2874cb(_0x44781[_0x33d51b(0x12e)]);});},async 'delete'(_0xb8a9a0,_0x279428){const _0x4ccbe8=_0x1b5e35,_0x9675ad=await this['_getStore'](_0xb8a9a0,_0x4ccbe8(0x28a));return new Promise((_0x1023a1,_0x5b35e4)=>{const _0x292dc0=_0x4ccbe8,_0x2e4b1d=_0x9675ad['delete'](_0x279428);_0x2e4b1d[_0x292dc0(0x24c)]=()=>_0x1023a1(_0x2e4b1d[_0x292dc0(0x236)]),_0x2e4b1d[_0x292dc0(0x247)]=()=>_0x5b35e4(_0x2e4b1d['error']);});},async 'save'(_0x3eba6e){return await this['initDB'](),new Promise((_0x237551,_0x7a6891)=>{const _0x3181b6=_0x2c31,_0x29c57a=this['db'][_0x3181b6(0x296)]([_0x3181b6(0x241),_0x3181b6(0x28e),'subtopics'],'readwrite'),_0x19b99c=_0x29c57a[_0x3181b6(0x30d)]('settings'),_0x2cf705=_0x29c57a['objectStore']('topics'),_0x489b7c=_0x29c57a[_0x3181b6(0x30d)](_0x3181b6(0x2d5));_0x19b99c[_0x3181b6(0x215)](_0x3eba6e[_0x3181b6(0x241)],_0x3181b6(0x1ee)),_0x2cf705['clear'](),_0x489b7c[_0x3181b6(0x133)](),_0x3eba6e[_0x3181b6(0x28e)][_0x3181b6(0x378)](_0x4ef6d6=>{const _0x526dc4=_0x3181b6,{subtopics:_0x55820d,..._0x2877a8}=_0x4ef6d6;_0x2cf705[_0x526dc4(0x215)](_0x2877a8),(_0x55820d||[])[_0x526dc4(0x378)](_0x228225=>_0x489b7c[_0x526dc4(0x215)](_0x228225));}),_0x29c57a['oncomplete']=()=>_0x237551(),_0x29c57a[_0x3181b6(0x247)]=_0x23162f=>_0x7a6891(_0x23162f['target'][_0x3181b6(0x12e)]);});},async 'autoBackup'(_0x3b45bf){const _0x52381f=_0x1b5e35;await this[_0x52381f(0x216)]();const _0x39c7cf=new Date()['toISOString']()['slice'](0x0,0xa),_0x23f595=localStorage[_0x52381f(0x178)](_0x52381f(0x224));if(_0x39c7cf!==_0x23f595){console[_0x52381f(0x414)]('Creating\x20backup\x20for\x20'+_0x39c7cf+_0x52381f(0x232));const _0x378d3b={'date':_0x39c7cf,'data':JSON[_0x52381f(0x113)](JSON[_0x52381f(0x1ac)](_0x3b45bf))},_0x39e5be=this['db']['transaction'](['backups'],_0x52381f(0x28a)),_0x3e25d7=_0x39e5be[_0x52381f(0x30d)](_0x52381f(0x243)),_0x5bfd98=_0x3e25d7[_0x52381f(0x215)](_0x378d3b);_0x5bfd98['onsuccess']=()=>{const _0x54e820=_0x52381f;localStorage[_0x54e820(0x2c6)](_0x54e820(0x224),_0x39c7cf),console[_0x54e820(0x414)]('Daily\x20backup\x20successful.'),this['cleanupOldBackups'](_0x3b45bf?.['settings']?.['backupDaysToKeep']||0x7);},_0x5bfd98[_0x52381f(0x247)]=_0x3b4d91=>{const _0xf4434a=_0x52381f;console['error'](_0xf4434a(0x1d3),_0x3b4d91[_0xf4434a(0x1e7)][_0xf4434a(0x12e)]);};}},async 'cleanupOldBackups'(_0x50dff7){const _0xbdfce3=_0x1b5e35;await this[_0xbdfce3(0x216)]();const _0x529daa=this['db']['transaction']([_0xbdfce3(0x243)],_0xbdfce3(0x28a)),_0x4c88c3=_0x529daa['objectStore'](_0xbdfce3(0x243)),_0x4e1619=_0x4c88c3[_0xbdfce3(0x213)]();_0x4e1619[_0xbdfce3(0x24c)]=()=>{const _0xaafad5=_0xbdfce3,_0x130b3b=_0x4e1619[_0xaafad5(0x236)][_0xaafad5(0x109)]()['reverse']();if(_0x130b3b[_0xaafad5(0x1a1)]>_0x50dff7){const _0x5865c3=_0x130b3b[_0xaafad5(0x332)](_0x50dff7);_0x5865c3[_0xaafad5(0x378)](_0x2d8489=>{const _0x38c05f=_0xaafad5;_0x4c88c3[_0x38c05f(0x2cd)](_0x2d8489),console[_0x38c05f(0x414)](_0x38c05f(0x1df)+_0x2d8489);});}};},async 'getBackupList'(){const _0x3542ac=_0x1b5e35;return await this[_0x3542ac(0x216)](),new Promise((_0x5dffba,_0x28f3f2)=>{const _0x352068=_0x3542ac,_0x482e23=this['db'][_0x352068(0x296)](['backups'],_0x352068(0x316)),_0x296f4b=_0x482e23[_0x352068(0x30d)](_0x352068(0x243)),_0x1086a2=_0x296f4b['getAll']();_0x1086a2[_0x352068(0x24c)]=()=>_0x5dffba(_0x1086a2[_0x352068(0x236)][_0x352068(0x109)]((_0x4bfb0a,_0x1cc172)=>_0x1cc172[_0x352068(0x145)][_0x352068(0x413)](_0x4bfb0a[_0x352068(0x145)]))),_0x1086a2['onerror']=_0xd88db8=>_0x28f3f2(_0xd88db8[_0x352068(0x1e7)][_0x352068(0x12e)]);});},async 'restoreBackup'(_0x1ef011){const _0x32dd05=_0x1b5e35;return await this[_0x32dd05(0x216)](),new Promise((_0x26acce,_0x4d88a0)=>{const _0x3cc99f=_0x32dd05,_0x5ec0c5=this['db'][_0x3cc99f(0x296)]([_0x3cc99f(0x243)],_0x3cc99f(0x316)),_0x2fde22=_0x5ec0c5[_0x3cc99f(0x30d)](_0x3cc99f(0x243)),_0x50816b=_0x2fde22['get'](_0x1ef011);_0x50816b['onsuccess']=()=>{const _0x53aa12=_0x3cc99f;_0x50816b[_0x53aa12(0x236)]&&_0x50816b['result'][_0x53aa12(0x29f)]?(localStorage[_0x53aa12(0x2c6)](_0x53aa12(0x400),JSON[_0x53aa12(0x1ac)](_0x50816b['result']['data'])),_0x26acce(_0x50816b[_0x53aa12(0x236)]['data'])):_0x4d88a0(new Error(_0x53aa12(0x339)));},_0x50816b[_0x3cc99f(0x247)]=_0x4c6365=>_0x4d88a0(_0x4c6365[_0x3cc99f(0x1e7)]['error']);});},'exportData'(_0x2cadd1){const _0x2390ac=_0x1b5e35;let _0x21a8e5={};try{_0x21a8e5=JSON[_0x2390ac(0x113)](JSON[_0x2390ac(0x1ac)](_0x2cadd1||{}));}catch(_0x321734){_0x21a8e5=_0x2cadd1;}try{if(_0x21a8e5&&_0x21a8e5[_0x2390ac(0x241)])_0x21a8e5[_0x2390ac(0x241)][_0x2390ac(0x3e4)]='';}catch(_0x1cfded){}const _0x59c068=new Blob([JSON[_0x2390ac(0x1ac)](_0x21a8e5,null,0x2)],{'type':'application/json'}),_0x585f0f=document['createElement']('a'),_0x712139=new Date(),_0x7d3ff5=_0x2773d8=>(''+_0x2773d8)[_0x2390ac(0x1f4)](0x2,'0');_0x585f0f[_0x2390ac(0x201)]=URL['createObjectURL'](_0x59c068),_0x585f0f[_0x2390ac(0x352)]=_0x2390ac(0x3c9)+_0x712139[_0x2390ac(0x1b4)]()+_0x7d3ff5(_0x712139[_0x2390ac(0x124)]()+0x1)+_0x7d3ff5(_0x712139[_0x2390ac(0x157)]())+_0x2390ac(0x222),_0x585f0f[_0x2390ac(0x302)](),URL[_0x2390ac(0x3cd)](_0x585f0f[_0x2390ac(0x201)]);},async 'importData'(_0x184a43){const _0x5564dc=_0x1b5e35,_0x58c0de=await _0x184a43['text'](),_0x10607d=JSON['parse'](_0x58c0de);if(!_0x10607d[_0x5564dc(0x26f)]||!_0x10607d[_0x5564dc(0x241)]||!Array[_0x5564dc(0x39c)](_0x10607d[_0x5564dc(0x28e)]))throw new Error(_0x5564dc(0x1c1));try{const _0x4ded6e=window[_0x5564dc(0x29f)]&&window[_0x5564dc(0x29f)][_0x5564dc(0x241)]&&window[_0x5564dc(0x29f)][_0x5564dc(0x241)][_0x5564dc(0x3e4)]||'';(!('apiKey'in _0x10607d['settings'])||_0x10607d[_0x5564dc(0x241)][_0x5564dc(0x3e4)]==='')&&(_0x10607d['settings']['apiKey']=_0x4ded6e);}catch(_0x2b1615){}return localStorage[_0x5564dc(0x2c6)](_0x5564dc(0x400),JSON[_0x5564dc(0x1ac)](_0x10607d)),_0x10607d;}},$=(_0x40a2aa,_0x3073cf=document)=>_0x3073cf[_0x1b5e35(0x388)](_0x40a2aa),breakSuggestions=[_0x1b5e35(0x114),_0x1b5e35(0x37a),_0x1b5e35(0x1fd),_0x1b5e35(0x21c),_0x1b5e35(0x2a5),_0x1b5e35(0x162),_0x1b5e35(0x266),_0x1b5e35(0x396),'Lắc\x20nhẹ\x20cổ\x20tay\x20và\x20vai\x20trong\x2030\x20giây.',_0x1b5e35(0x1da),_0x1b5e35(0x211),_0x1b5e35(0x3c6),_0x1b5e35(0x384),_0x1b5e35(0x161),_0x1b5e35(0x10e),_0x1b5e35(0x275),_0x1b5e35(0x1a5),_0x1b5e35(0x1d5),_0x1b5e35(0x10d),_0x1b5e35(0x40a),_0x1b5e35(0x21b),'Làm\x20động\x20tác\x20“thở\x20dài”\x20sâu\x20một\x20lần,\x20thả\x20lỏng\x20vai.',_0x1b5e35(0x357),_0x1b5e35(0x349),_0x1b5e35(0x1c6),'Chớp\x20mắt\x20liên\x20tục\x2010\x20lần\x20để\x20tránh\x20khô\x20mắt.',_0x1b5e35(0x326),_0x1b5e35(0x37b),'Nạp\x20năng\x20lượng\x20bằng\x20một\x20món\x20ăn\x20nhẹ\x20lành\x20mạnh.',_0x1b5e35(0x27f),'Kiểm\x20tra\x20nhịp\x20thở\x20–\x20nếu\x20gấp\x20gáp,\x20hãy\x20làm\x20chậm\x20lại.',_0x1b5e35(0x30c)],$$=(_0x126d3a,_0x771025=document)=>Array['from'](_0x771025['querySelectorAll'](_0x126d3a));function on(_0x315a6e,_0x11f3ae,_0xa468f8){const _0x132bee=_0x1b5e35;if(!_0x315a6e){console[_0x132bee(0x370)](_0x132bee(0x217),_0x11f3ae);return;}_0x315a6e[_0x132bee(0x2f7)](_0x11f3ae,_0xa468f8);}const formatMMSS=_0x51989b=>{const _0x156d7f=_0x1b5e35,_0x26f0bf=Math[_0x156d7f(0x155)](_0x51989b/0x3c)[_0x156d7f(0x198)]()[_0x156d7f(0x1f4)](0x2,'0'),_0xe6cf7a=Math[_0x156d7f(0x155)](_0x51989b%0x3c)[_0x156d7f(0x198)]()[_0x156d7f(0x1f4)](0x2,'0');return _0x26f0bf+':'+_0xe6cf7a;},uid=(_0x480ac4='id')=>_0x480ac4+'_'+Date[_0x1b5e35(0x115)]()+'_'+Math[_0x1b5e35(0x2d8)]()['toString'](0x24)['slice'](0x2,0x9);let __releaseFocusTrap=null;function trapFocus(_0x1c3aeb){const _0x4518ab=_0x1b5e35;try{const _0x2cf044=_0x1c3aeb['querySelectorAll']('button,\x20[href],\x20input,\x20select,\x20textarea,\x20[tabindex]:not([tabindex=\x22-1\x22])');if(!_0x2cf044['length'])return;const _0x5d462e=_0x2cf044[0x0],_0x54d897=_0x2cf044[_0x2cf044[_0x4518ab(0x1a1)]-0x1],_0x34337a=_0x4c518d=>{const _0x51a485=_0x4518ab;if(_0x4c518d[_0x51a485(0x291)]==='Tab'){if(_0x4c518d[_0x51a485(0x324)]&&document[_0x51a485(0x3d0)]===_0x5d462e)_0x4c518d[_0x51a485(0x309)](),_0x54d897['focus']();else!_0x4c518d[_0x51a485(0x324)]&&document[_0x51a485(0x3d0)]===_0x54d897&&(_0x4c518d[_0x51a485(0x309)](),_0x5d462e[_0x51a485(0xf6)]());}};_0x1c3aeb[_0x4518ab(0x2f7)](_0x4518ab(0x131),_0x34337a),_0x5d462e[_0x4518ab(0xf6)](),__releaseFocusTrap=()=>{const _0x1efbf5=_0x4518ab;try{_0x1c3aeb[_0x1efbf5(0x3f4)](_0x1efbf5(0x131),_0x34337a);}catch(_0x2c6080){}};}catch(_0x37b876){}}function releaseFocus(){if(__releaseFocusTrap){try{__releaseFocusTrap();}catch(_0x1980a1){}__releaseFocusTrap=null;}}const todayISO=()=>new Date()[_0x1b5e35(0x3fd)]();function toast(_0x3e03ec,_0x4cd2c5=0xa28){const _0x112e76=_0x1b5e35,_0x4df267=$(_0x112e76(0x387)),_0x4ba734=document[_0x112e76(0x2b4)]('div');_0x4ba734[_0x112e76(0x223)]=_0x112e76(0x18d),_0x4ba734[_0x112e76(0x176)]=_0x3e03ec,_0x4df267[_0x112e76(0x376)](_0x4ba734),setTimeout(()=>{_0x4ba734['style']['opacity']='0';},_0x4cd2c5-0x12c),setTimeout(()=>_0x4df267['removeChild'](_0x4ba734),_0x4cd2c5);}function escapeHTML(_0x29c67b){const _0x4c2add=_0x1b5e35;return _0x29c67b[_0x4c2add(0x140)](/[&<>"']/g,_0x435d66=>({'&':_0x4c2add(0x331),'<':_0x4c2add(0x175),'>':'&gt;','\x22':_0x4c2add(0x227),'\x27':'&#39;'}[_0x435d66]));}function formatDaysHoursMinutes(_0x24a387){const _0x469f21=_0x1b5e35;if(!_0x24a387||_0x24a387<0x1)return _0x469f21(0x3ea);const _0x215d31=Math[_0x469f21(0x155)](_0x24a387/0x3c),_0x2dad8d=_0x24a387%0x3c,_0x207679=_0x2dad8d[_0x469f21(0x198)]()['padStart'](0x2,'0');return _0x215d31+_0x469f21(0x3ac)+_0x207679+'\x20phút';}function formatGeminiResponse(_0x33a5d8){return _0x33a5d8['replace'](/(\*\*|__|\*|_|#+\s*)/g,'');}function parseSimpleMarkdown(_0xaf14d2){const _0x297bd0=_0x1b5e35,_0x409a4f=(_0xaf14d2||'')['split']('\x0a');let _0x4502c0='',_0x334ad9=null;const _0x469fdb=()=>{const _0x4ea21d=_0x2c31;_0x334ad9&&(_0x4502c0+=_0x334ad9==='ol'?_0x4ea21d(0x14c):_0x4ea21d(0x132),_0x334ad9=null);};for(let _0x5f027b of _0x409a4f){let _0x2972de=(_0x5f027b||'')[_0x297bd0(0x287)]();if(!_0x2972de){_0x469fdb();continue;}if(_0x2972de[_0x297bd0(0x24e)](_0x297bd0(0x2ac)))_0x469fdb(),_0x4502c0+=_0x297bd0(0xef)+escapeHTML(_0x2972de[_0x297bd0(0x264)](0x5))+'</h4>';else{if(/^\d+\.\s/[_0x297bd0(0x183)](_0x2972de)){_0x334ad9!=='ol'&&(_0x469fdb(),_0x4502c0+=_0x297bd0(0x1b8),_0x334ad9='ol');const _0x291411=_0x2972de['substring'](_0x2972de[_0x297bd0(0x3ad)]('\x20')+0x1);_0x4502c0+=_0x297bd0(0x15c)+escapeHTML(_0x291411)+_0x297bd0(0x18f);}else _0x2972de[_0x297bd0(0x24e)]('-\x20')?(_0x334ad9!=='ul'&&(_0x469fdb(),_0x4502c0+=_0x297bd0(0x280),_0x334ad9='ul'),_0x4502c0+=_0x297bd0(0x15c)+escapeHTML(_0x2972de[_0x297bd0(0x264)](0x2))+_0x297bd0(0x18f)):(_0x469fdb(),_0x2972de=escapeHTML(_0x2972de)['replace'](/\*\*(.*?)\*\*/g,'<strong>$1</strong>')['replace'](/_(.*?)_/g,'<i>$1</i>'),_0x4502c0+=_0x297bd0(0x29d)+_0x2972de+'</p>');}}return _0x469fdb(),_0x4502c0;}function wrapTextInMarkdown(_0x14f39e,_0x14bb5c,_0x22fc76=''){const _0x57cb6d=_0x1b5e35;if(!_0x14f39e)return;const _0x477740=_0x14f39e[_0x57cb6d(0x2c8)]||0x0,_0x1fa069=_0x14f39e[_0x57cb6d(0x100)]||0x0,_0x589dfc=_0x14f39e['value'][_0x57cb6d(0x264)](_0x477740,_0x1fa069),_0x204afb=_0x14bb5c+_0x589dfc+(_0x22fc76||_0x14bb5c);_0x14f39e[_0x57cb6d(0x1bc)](_0x204afb,_0x477740,_0x1fa069,'end'),_0x14f39e[_0x57cb6d(0xf6)]();}function updateEditorPreview(){const _0x1039bc=_0x1b5e35,_0x5f51ca=$('#methodEditorContentInput'),_0x1d7a10=$('#editorPreview');if(!_0x5f51ca||!_0x1d7a10)return;const _0x1255dc=_0x5f51ca[_0x1039bc(0x117)]||'';_0x1d7a10[_0x1039bc(0x33b)]=parseSimpleMarkdown(_0x1255dc);}function normalizeDataStructure(_0x26a2d8){const _0x2a7f41=_0x1b5e35;if(!_0x26a2d8||typeof _0x26a2d8!==_0x2a7f41(0x33f))return;const _0x5c46f3=_0x26a2d8[_0x2a7f41(0x241)]||{},_0x147cec={...defaults[_0x2a7f41(0x241)],..._0x5c46f3,'durations':{...defaults[_0x2a7f41(0x241)][_0x2a7f41(0x11f)],..._0x5c46f3[_0x2a7f41(0x11f)]||{}}};if(!Array[_0x2a7f41(0x39c)](_0x147cec['achievedMilestones']))_0x147cec['achievedMilestones']=[];_0x26a2d8[_0x2a7f41(0x241)]=_0x147cec,_0x26a2d8[_0x2a7f41(0x28e)]=Array[_0x2a7f41(0x39c)](_0x26a2d8[_0x2a7f41(0x28e)])?_0x26a2d8['topics']:[],_0x26a2d8['topics'][_0x2a7f41(0x378)](_0x3bc187=>{const _0x1b2588=_0x2a7f41;_0x3bc187['subtopics']=Array[_0x1b2588(0x39c)](_0x3bc187['subtopics'])?_0x3bc187[_0x1b2588(0x2d5)]:[],_0x3bc187[_0x1b2588(0x2d5)][_0x1b2588(0x378)](_0x419b03=>{const _0x2e8188=_0x1b2588;_0x419b03['tasks']=_0x419b03[_0x2e8188(0x3b8)]||[],_0x419b03[_0x2e8188(0x1ab)]=_0x419b03[_0x2e8188(0x1ab)]||[],_0x419b03['summaries']=_0x419b03['summaries']||[],_0x419b03[_0x2e8188(0x108)]=_0x419b03[_0x2e8188(0x108)]||[],_0x419b03['methods']=Array[_0x2e8188(0x39c)](_0x419b03[_0x2e8188(0x1de)])?_0x419b03[_0x2e8188(0x1de)]:[],_0x419b03[_0x2e8188(0x1b5)]=_0x419b03[_0x2e8188(0x1b5)]||{'totalMinutes':0x0,'sessionsCompleted':0x0,'tasksCompleted':0x0},_0x419b03['sessions']=_0x419b03[_0x2e8188(0x230)]||[],_0x419b03[_0x2e8188(0x360)]=_0x419b03[_0x2e8188(0x360)]||{'state':_0x2e8188(0x21e),'prevState':null,'remaining':0x0,'segmentTotal':0x0,'cycleIndex':0x0};});});}function extractYouTubeID(_0x2c87d6){const _0x34db88=_0x1b5e35;if(!_0x2c87d6)return null;const _0x4df932=/^.*(?:youtu.be\/|shorts\/|live\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([A-Za-z0-9_-]{11}).*/,_0x2f46fa=_0x2c87d6[_0x34db88(0x3b2)](_0x4df932);return _0x2f46fa?_0x2f46fa[0x1]:null;}let sessionYoutubeUrl='';function getActiveYoutubeUrl(){const _0x5e1a08=_0x1b5e35;try{if(sessionYoutubeUrl)return sessionYoutubeUrl;const _0x94fbd7=document[_0x5e1a08(0x262)]('set_youtubeUrl'),_0x43e2e6=(_0x94fbd7&&_0x94fbd7[_0x5e1a08(0x117)]?_0x94fbd7[_0x5e1a08(0x117)]:'')[_0x5e1a08(0x287)]();return _0x43e2e6;}catch(_0x2695a5){return'';}}function getActiveVideoId(){return extractYouTubeID(getActiveYoutubeUrl());}function handleYoutubeUrlInput(){const _0x4960eb=_0x1b5e35,_0x343148=$(_0x4960eb(0x2b9)),_0xa87145=$(_0x4960eb(0x209)),_0x4c5a7b=$(_0x4960eb(0x2e8)),_0x184166=_0x343148[_0x4960eb(0x117)]['trim'](),_0x1ca872=extractYouTubeID(_0x184166);if(_0x1ca872){_0xa87145['textContent']=_0x4960eb(0x301),_0xa87145[_0x4960eb(0x300)][_0x4960eb(0x342)]=_0x4960eb(0x1ca),_0x4c5a7b[_0x4960eb(0x16e)]=![],sessionYoutubeUrl=_0x184166;try{ytUserPaused=![];}catch(_0x1eb348){}try{const _0x1d90ce=_0x4960eb(0x329)+_0x1ca872+_0x4960eb(0x380),_0x5359c8=new Image();_0x5359c8[_0x4960eb(0x2f0)]=async()=>{const _0x2903e6=_0x4960eb;data[_0x2903e6(0x241)][_0x2903e6(0x3f7)]=_0x1d90ce;try{await saveData();}catch(_0x76b85c){}applyCustomBg();},_0x5359c8[_0x4960eb(0x247)]=async()=>{const _0x4a335e=_0x4960eb,_0x1161a=_0x4a335e(0x329)+_0x1ca872+_0x4a335e(0x102);data[_0x4a335e(0x241)][_0x4a335e(0x3f7)]=_0x1161a;try{await saveData();}catch(_0x11fb71){}applyCustomBg();},_0x5359c8[_0x4960eb(0x325)]=_0x1d90ce;}catch(_0x5c9a48){}try{if(IS_FILE_PROTOCOL){const _0x5e882b=_ytUnlocked?0x0:0x1;fallbackLoadVideo(_0x1ca872,{'autoplay':0x1,'mute':_0x5e882b});try{setTimeout(()=>{const _0x18c5ce=_0x4960eb;try{fallbackPostMessage(_0x18c5ce(0x244));}catch(_0x1c500c){}},0xfa);}catch(_0x1901d9){}!_ytUnlocked&&showSoundPermission();try{setTimeout(()=>{const _0x9a7716=_0x4960eb,_0x3b6297=document[_0x9a7716(0x262)](_0x9a7716(0x1c2));if(_0x3b6297)_0x3b6297[_0x9a7716(0x176)]=_0x9a7716(0x2bc);},0x1f4);}catch(_0x505c25){}}else ensureYouTubeAPI()[_0x4960eb(0x1b6)](()=>{const _0x47aa3c=_0x4960eb;updateYouTubePlayer();try{if(_ytUnlocked)ytFadeInPlay();else ytPlayer&&ytPlayer[_0x47aa3c(0x168)]&&ytPlayer[_0x47aa3c(0x244)]&&(ytPlayer[_0x47aa3c(0x168)](),ytPlayer[_0x47aa3c(0x244)](),_ytPrimed=!![],showSoundPermission());}catch(_0x50ad8b){}})['catch'](()=>{});}catch(_0xb364c2){}}else{if(_0x184166===''){_0xa87145[_0x4960eb(0x176)]='',_0x4c5a7b['disabled']=!![];if(IS_FILE_PROTOCOL)try{fallbackStop();}catch(_0x2b4d9a){}else ytPlayer&&ytPlayer[_0x4960eb(0x403)]&&ytPlayer[_0x4960eb(0x403)]();}else _0xa87145[_0x4960eb(0x176)]=_0x4960eb(0x2b8),_0xa87145[_0x4960eb(0x300)][_0x4960eb(0x342)]=_0x4960eb(0x149),_0x4c5a7b[_0x4960eb(0x16e)]=!![];}}function _0x2c31(_0x4dbedc,_0x280417){const _0x5ccb9b=_0x5ccb();return _0x2c31=function(_0x2c31b9,_0x505e6c){_0x2c31b9=_0x2c31b9-0xee;let _0x40d140=_0x5ccb9b[_0x2c31b9];return _0x40d140;},_0x2c31(_0x4dbedc,_0x280417);}function applyTheme(_0x4a060a){const _0x48aaa6=_0x1b5e35,_0x4dcede=_0x4a060a||data['settings'][_0x48aaa6(0x3a1)]||_0x48aaa6(0x27c);document[_0x48aaa6(0xfa)][_0x48aaa6(0xfd)][_0x48aaa6(0x3a1)]=_0x4dcede;const _0x4c0eda=[_0x48aaa6(0x29a),_0x48aaa6(0x24a)][_0x48aaa6(0x1e1)](_0x4dcede),_0x278d71=_0x4dcede===_0x48aaa6(0x141)||_0x4dcede===_0x48aaa6(0x2c1),_0x1eeb19=data[_0x48aaa6(0x241)]['customBg'],_0x56c8f0=()=>{const _0x33b4ec=_0x48aaa6;try{document['body'][_0x33b4ec(0x300)][_0x33b4ec(0x3dc)]='';}catch(_0x118c5c){}};if(_0x1eeb19&&!data[_0x48aaa6(0x241)]['useYtThumbnailAsBg'])document[_0x48aaa6(0xfa)][_0x48aaa6(0x300)][_0x48aaa6(0x18b)](_0x48aaa6(0x1ec),_0x48aaa6(0x1f6)+_0x1eeb19+')'),_0x56c8f0();else{if(_0x1eeb19&&data[_0x48aaa6(0x241)][_0x48aaa6(0x310)])document[_0x48aaa6(0xfa)][_0x48aaa6(0x300)][_0x48aaa6(0x18b)](_0x48aaa6(0x1ec),_0x48aaa6(0x1f6)+_0x1eeb19+')'),_0x56c8f0();else{if(_0x4c0eda)document['body'][_0x48aaa6(0x300)][_0x48aaa6(0x3e0)](_0x48aaa6(0x1ec)),_0x56c8f0();else _0x278d71?(document[_0x48aaa6(0xfa)][_0x48aaa6(0x300)][_0x48aaa6(0x18b)](_0x48aaa6(0x1ec),_0x48aaa6(0x13b)),_0x56c8f0()):(document['body'][_0x48aaa6(0x300)][_0x48aaa6(0x18b)](_0x48aaa6(0x1ec),''),document[_0x48aaa6(0xfa)][_0x48aaa6(0x300)][_0x48aaa6(0x3dc)]='radial-gradient(1200px\x20800px\x20at\x2010%\x20-10%,\x20#20285b\x200%,\x20#0f1222\x2050%,\x20#0b0e1a\x20100%)');}}}const defaults={'version':0x1,'settings':{'apiKey':'','currentView':_0x1b5e35(0x1a9),'preset':'A','autoStartNext':!![],'soundOn':!![],'volume':0.8,'soundTheme':_0x1b5e35(0x3ba),'theme':_0x1b5e35(0x27c),'cyclesA':0x4,'longBreakIntervalA':0x4,'cyclesB':0x4,'longBreakIntervalB':0x4,'flowtimeBreakRatio':0x5,'enableWinddown':!![],'enableSessionNotes':!![],'durations':{'A_work':0x19,'A_short':0x5,'A_long':0xf,'A_winddown':0x2,'B_work':0x32,'B_short':0xa,'B_long':0x1e,'B_winddown':0x5},'selectedTopicId':'','selectedSubtopicId':'','collapsedTopics':{},'customBg':'','customSounds':{'work_end':'','break_end':'','long_end':''},'youtubeUrl':'','youtubeVolume':0x50,'useYtThumbnailAsBg':!![],'panelOpacity':0.85,'panelBlur':0xa,'backgroundMode':_0x1b5e35(0x192),'backupDaysToKeep':0x7,'achievedMilestones':[],'methods':[{'id':uid('m'),'title':_0x1b5e35(0x3d4),'content':_0x1b5e35(0x337)},{'id':uid('m'),'title':_0x1b5e35(0x240),'content':_0x1b5e35(0x195)},{'id':uid('m'),'title':_0x1b5e35(0x298),'content':'<p>Để\x20không\x20bị\x20choáng\x20ngợp\x20khi\x20học\x20một\x20lĩnh\x20vực\x20mới,\x20hãy\x20tập\x20trung\x20vào\x2020%\x20kiến\x20thức\x20cốt\x20lõi\x20mang\x20lại\x2080%\x20kết\x20quả\x20(Liều\x20lượng\x20Hiệu\x20quả\x20Tối\x20thiểu).</p><h4>20%\x20cốt\x20lõi:\x20Áp\x20dụng\x20Khung\x20Phân\x20tích\x205\x20Bước\x20để\x20xác\x20định\x2020%\x20quan\x20trọng\x20nhất:</h4><ol><li><strong>Xác\x20định\x20Kết\x20quả:</strong>\x20Mục\x20tiêu\x20cuối\x20cùng\x20của\x20bạn\x20là\x20gì?\x20(ví\x20dụ:\x20xây\x20dựng\x20được\x20một\x20trang\x20web).</li><li><strong>Phân\x20tích\x20Nền\x20tảng:</strong>\x20Tìm\x203-5\x20nguyên\x20lý\x20bất\x20biến\x20của\x20ngành.</li><li><strong>Nhận\x20diện\x20Lỗi\x20sai\x20Phổ\x20biến:</strong>\x20Học\x20cách\x20tránh\x20những\x20lỗi\x20mà\x20người\x20mới\x20hay\x20mắc\x20phải.</li><li><strong>Tìm\x20\x22Yếu\x20tố\x20Nhân\x22:</strong>\x20Kỹ\x20năng\x20nào\x20sẽ\x20giúp\x20học\x20mọi\x20thứ\x20khác\x20dễ\x20dàng\x20hơn?\x20(ví\x20dụ:\x20nhạc\x20lý\x20trong\x20âm\x20nhạc).</li><li><strong>Lập\x20bản\x20đồ\x20Ứng\x20dụng\x20Thực\x20tiễn:</strong>\x20Tập\x20trung\x20vào\x2020%\x20công\x20việc\x20chiếm\x2080%\x20thời\x20gian\x20thực\x20tế\x20của\x20ngành.</li></ol>'},{'id':uid('m'),'title':_0x1b5e35(0x23a),'content':'<p>Gợi\x20nhớ\x20chủ\x20động\x20là\x20hành\x20động\x20nỗ\x20lực\x20truy\x20xuất\x20thông\x20tin\x20từ\x20não\x20bộ\x20mà\x20không\x20nhìn\x20vào\x20tài\x20liệu.\x20Đây\x20là\x20phương\x20pháp\x20học\x20hiệu\x20quả\x20vượt\x20trội\x20so\x20với\x20việc\x20đọc\x20lại,\x20highlight\x20hay\x20tóm\x20tắt\x20một\x20cách\x20thụ\x20động.</p><h4>Nguyên\x20Tắc\x2020/80</h4><p><strong>20%\x20Cốt\x20lõi:</strong>\x20Hành\x20động\x20\x22vắt\x20óc\x22\x20để\x20nhớ\x20lại\x20thông\x20tin\x20sẽ\x20củng\x20cố\x20các\x20liên\x20kết\x20thần\x20kinh,\x20giúp\x20chuyển\x20kiến\x20thức\x20vào\x20bộ\x20nhớ\x20dài\x20hạn.\x20Cảm\x20giác\x20khó\x20khăn\x20khi\x20cố\x20gắng\x20nhớ\x20chính\x20là\x20dấu\x20hiệu\x20của\x20việc\x20học\x20tập\x20hiệu\x20quả\x20đang\x20diễn\x20ra.</p><p><strong>80%\x20Kết\x20quả:</strong>\x20Bạn\x20sẽ\x20ghi\x20nhớ\x20kiến\x20thức\x20sâu\x20và\x20lâu\x20hơn,\x20đồng\x20thời\x20biết\x20chính\x20xác\x20mình\x20đang\x20yếu\x20ở\x20đâu.</p><h4>Các\x20Phương\x20Pháp\x20Quan\x20Trọng\x20Nhất</h4><ul><li><strong>Tự\x20Kiểm\x20Tra\x20(Self-testing):</strong>\x20Thay\x20vì\x20đọc\x20lại\x20ghi\x20chú,\x20hãy\x20che\x20chúng\x20đi\x20và\x20tự\x20đặt\x20câu\x20hỏi\x20cho\x20mình.\x20Ví\x20dụ:\x20Dùng\x20flashcards\x20(thẻ\x20ghi\x20nhớ)\x20và\x20luôn\x20trả\x20lời\x20trước\x20khi\x20lật\x20xem\x20đáp\x20án.</li><li><strong>Kỹ\x20thuật\x20\x22Blurting\x22:</strong>\x20Sau\x20khi\x20học\x20một\x20chủ\x20đề,\x20hãy\x20đóng\x20sách\x20lại\x20và\x20viết\x20ra\x20giấy\x20mọi\x20thứ\x20bạn\x20có\x20thể\x20nhớ.\x20Sau\x20đó,\x20so\x20sánh\x20với\x20tài\x20liệu\x20gốc\x20để\x20lấp\x20đầy\x20những\x20lỗ\x20hổng\x20kiến\x20thức.</li><li><strong>Dạy\x20lại\x20cho\x20người\x20khác:</strong>\x20Giải\x20thích\x20một\x20khái\x20niệm\x20cho\x20người\x20khác\x20buộc\x20bạn\x20phải\x20truy\x20xuất,\x20đơn\x20giản\x20hóa\x20và\x20sắp\x20xếp\x20lại\x20thông\x20tin\x20một\x20cách\x20mạch\x20lạc.</li></ul><p><i>Tóm\x20lại:\x20Đừng\x20chỉ\x20đọc\x20lại.\x20Hãy\x20dừng\x20lại,\x20che\x20tài\x20liệu\x20đi,\x20và\x20tự\x20hỏi:\x20\x22Mình\x20thực\x20sự\x20nhớ\x20được\x20gì?\x22</i></p>'},{'id':uid('m'),'title':_0x1b5e35(0x3a5),'content':_0x1b5e35(0x3ee)}]},'topics':[]};let data,editingPreset='A',AUDIO_CTX=null;function ensureAudio(){const _0x1b31fb=_0x1b5e35;if(!AUDIO_CTX)AUDIO_CTX=new(window[(_0x1b31fb(0x2f1))]||window['webkitAudioContext'])();}function tone(_0x420fc7=0x370,_0x4f226f=0xc8,_0x188c54=0.2,_0x513260='sine',_0x72660e=0x0){const _0x280afc=_0x1b5e35;ensureAudio();const _0x1b1189=AUDIO_CTX,_0x516905=_0x1b1189[_0x280afc(0x405)](),_0x3803b4=_0x1b1189[_0x280afc(0x3cf)]();_0x516905['type']=_0x513260,_0x516905[_0x280afc(0x2b1)][_0x280afc(0x117)]=_0x420fc7,_0x516905['connect'](_0x3803b4),_0x3803b4[_0x280afc(0xf8)](_0x1b1189[_0x280afc(0x2b3)]);const _0x4713d9=_0x1b1189[_0x280afc(0x22c)]+_0x72660e;_0x3803b4[_0x280afc(0x15a)][_0x280afc(0x129)](0x0,_0x4713d9),_0x3803b4['gain']['linearRampToValueAtTime'](_0x188c54,_0x4713d9+0.01),_0x3803b4[_0x280afc(0x15a)]['exponentialRampToValueAtTime'](0.0001,_0x4713d9+_0x4f226f/0x3e8),_0x516905[_0x280afc(0x395)](_0x4713d9),_0x516905['stop'](_0x4713d9+_0x4f226f/0x3e8+0.05);}function playSound(_0x4bdfd4){const _0xecd299=_0x1b5e35;if(!data[_0xecd299(0x241)][_0xecd299(0x1b1)])return;const _0x3d204e=Math[_0xecd299(0x228)](0x0,Math[_0xecd299(0x307)](0x1,data['settings'][_0xecd299(0x2cf)]??0.8)),_0x38e383=data[_0xecd299(0x241)]['customSounds']?.[_0x4bdfd4];let _0x55203d;if(_0x4bdfd4==='work_end')_0x55203d=$(_0xecd299(0x25d));else{if(_0x4bdfd4===_0xecd299(0x14b))_0x55203d=$(_0xecd299(0x2de));else{if(_0x4bdfd4==='long_end')_0x55203d=$(_0xecd299(0x1d1));}}if(_0x38e383&&_0x55203d){_0x38e383[_0xecd299(0x24e)]('data:')||_0x38e383[_0xecd299(0x24e)](_0xecd299(0x1f7))||_0x38e383[_0xecd299(0x24e)]('blob:')?(_0x55203d[_0xecd299(0x325)]=_0x38e383,_0x55203d[_0xecd299(0x2cf)]=_0x3d204e,_0x55203d['play']()[_0xecd299(0x285)](_0x29fb22=>console[_0xecd299(0x12e)](_0xecd299(0x412),_0x29fb22))):getStoredFileUrl(_0x38e383)[_0xecd299(0x1b6)](_0x5b3ba9=>{const _0x57f0b2=_0xecd299;_0x5b3ba9&&(_0x55203d['src']=_0x5b3ba9,_0x55203d[_0x57f0b2(0x2cf)]=_0x3d204e,_0x55203d['play']()['catch'](_0x3b07eb=>console[_0x57f0b2(0x12e)](_0x57f0b2(0x412),_0x3b07eb)));});return;}const _0x3bee97=data['settings'][_0xecd299(0xf5)]||_0xecd299(0x3ba);if(_0x3bee97===_0xecd299(0x3ba)){if(_0x4bdfd4==='work_end')tone(0x370,0xfa,_0x3d204e),tone(0x294,0xb4,_0x3d204e*0.8,_0xecd299(0x21f),0.22);else{if(_0x4bdfd4===_0xecd299(0x14b))tone(0x294,0xdc,_0x3d204e*0.9);else _0x4bdfd4===_0xecd299(0x14e)&&(tone(0x208,0xc8,_0x3d204e),tone(0x30c,0xc8,_0x3d204e,'sine',0.22),tone(0x410,0xdc,_0x3d204e,_0xecd299(0x21f),0.44));}}else{if(_0x4bdfd4===_0xecd299(0x18a))tone(0x4b0,0xa0,_0x3d204e*0.9,_0xecd299(0x3f3)),tone(0x384,0xdc,_0x3d204e*0.8,_0xecd299(0x3f3),0.18);else{if(_0x4bdfd4===_0xecd299(0x14b))tone(0x370,0xf0,_0x3d204e*0.8,'triangle');else _0x4bdfd4===_0xecd299(0x14e)&&(tone(0x258,0xdc,_0x3d204e*0.9,_0xecd299(0x3f3)),tone(0x3b6,0xf0,_0x3d204e*0.9,_0xecd299(0x3f3),0.22),tone(0x4b0,0xf0,_0x3d204e,_0xecd299(0x3f3),0.44));}}}async function saveData(){const _0x4f0afe=_0x1b5e35;try{await storageManager[_0x4f0afe(0x33a)](data);}catch(_0x28ab34){console[_0x4f0afe(0x12e)](_0x4f0afe(0x2d4),_0x28ab34),toast(_0x4f0afe(0x218)+_0x28ab34[_0x4f0afe(0x1a2)]);}}async function ensureValidSelection(){const _0x48cbd3=_0x1b5e35,_0x1e9fdd=data['settings'];if(!data['topics']||data['topics'][_0x48cbd3(0x1a1)]===0x0){_0x1e9fdd[_0x48cbd3(0x1a4)]='',_0x1e9fdd[_0x48cbd3(0x346)]='',await saveData();return;}const _0x1086ab=data[_0x48cbd3(0x28e)][_0x48cbd3(0x3b7)](_0x3eec2d=>_0x3eec2d['id']===_0x1e9fdd[_0x48cbd3(0x1a4)]),_0x1adec5=_0x1086ab?.[_0x48cbd3(0x2d5)][_0x48cbd3(0x3b7)](_0x5bdcf9=>_0x5bdcf9['id']===_0x1e9fdd['selectedSubtopicId']);if(!_0x1086ab||!_0x1adec5){const _0x1c4e19=data['topics'][0x0],_0x343b58=_0x1c4e19?.[_0x48cbd3(0x2d5)]?.[0x0];_0x1e9fdd['selectedTopicId']=_0x1c4e19?.['id']||'',_0x1e9fdd[_0x48cbd3(0x346)]=_0x343b58?.['id']||'',await saveData();}}function showInputModal(_0x3a3145,_0x2015df,_0x4daf17=''){const _0x4449c0=_0x1b5e35;$('#genericTitle')[_0x4449c0(0x176)]=_0x3a3145,$(_0x4449c0(0x3b5))[_0x4449c0(0x299)][_0x4449c0(0x11e)](_0x4449c0(0x31a));const _0x4d6bab=$(_0x4449c0(0x34f));_0x4d6bab[_0x4449c0(0x117)]=_0x4daf17,_0x4d6bab[_0x4449c0(0x299)][_0x4449c0(0x289)](_0x4449c0(0x31a)),$(_0x4449c0(0x373))['classList'][_0x4449c0(0x11e)](_0x4449c0(0x1ba));try{trapFocus($(_0x4449c0(0x373)));}catch(_0x33b61e){}_0x4d6bab[_0x4449c0(0xf6)](),_0x4d6bab[_0x4449c0(0x3da)]();const _0x2a103e=()=>{const _0x2260d5=_0x4449c0;_0x2015df(_0x4d6bab[_0x2260d5(0x117)]),_0x19e481();},_0x2a92a2=()=>_0x19e481(),_0x3644e1=_0x279243=>{const _0x3d9efd=_0x4449c0;if(_0x279243[_0x3d9efd(0x291)]==='Enter')_0x2a103e();if(_0x279243[_0x3d9efd(0x291)]==='Escape')_0x2a92a2();};$(_0x4449c0(0x282))[_0x4449c0(0x297)]=_0x2a103e,$(_0x4449c0(0x1f8))[_0x4449c0(0x297)]=_0x2a92a2,_0x4d6bab[_0x4449c0(0x3c7)]=_0x3644e1;function _0x19e481(){const _0x564723=_0x4449c0;$(_0x564723(0x373))[_0x564723(0x299)][_0x564723(0x289)](_0x564723(0x1ba)),$('#btnGenericOk')[_0x564723(0x297)]=null,$(_0x564723(0x1f8))[_0x564723(0x297)]=null,_0x4d6bab[_0x564723(0x3c7)]=null;try{releaseFocus();}catch(_0x37f2e9){}}}function showConfirmModal(_0x2957b8,_0x4c7b8a,_0x1debba){const _0x2f28c1=_0x1b5e35;$(_0x2f28c1(0x19b))[_0x2f28c1(0x176)]=_0x2957b8;const _0x2d1d0c=$(_0x2f28c1(0x3b5));_0x2d1d0c['textContent']=_0x4c7b8a,_0x2d1d0c[_0x2f28c1(0x299)]['remove']('hidden'),$('#genericInput')[_0x2f28c1(0x299)]['add'](_0x2f28c1(0x31a)),$(_0x2f28c1(0x373))[_0x2f28c1(0x299)][_0x2f28c1(0x11e)](_0x2f28c1(0x1ba));try{trapFocus($(_0x2f28c1(0x373)));}catch(_0x3748ed){}const _0xceed20=()=>{_0x1debba(!![]),_0x1101d7();},_0x1ba96f=()=>{_0x1debba(![]),_0x1101d7();};$(_0x2f28c1(0x282))[_0x2f28c1(0x297)]=_0xceed20,$('#btnGenericCancel')['onclick']=_0x1ba96f;function _0x1101d7(){const _0x1dd27d=_0x2f28c1;$(_0x1dd27d(0x373))[_0x1dd27d(0x299)][_0x1dd27d(0x289)](_0x1dd27d(0x1ba)),$(_0x1dd27d(0x282))[_0x1dd27d(0x297)]=null,$(_0x1dd27d(0x1f8))['onclick']=null;try{releaseFocus();}catch(_0x324ab5){}}}let pendingNoteSessionId=null;function openNoteModal(_0x5b597f){const _0x49bbbe=_0x1b5e35;pendingNoteSessionId=_0x5b597f||null;const _0x2a1e6f=$(_0x49bbbe(0x11c));if(!_0x2a1e6f)return;const _0x4a8815=$(_0x49bbbe(0x156));if(_0x4a8815)try{_0x4a8815['value']='';}catch(_0x234532){}_0x2a1e6f['classList'][_0x49bbbe(0x11e)](_0x49bbbe(0x1ba));try{trapFocus(_0x2a1e6f);}catch(_0x57f3de){}}function closeNoteModal(){const _0xd5f12b=_0x1b5e35,_0x5d77c3=$(_0xd5f12b(0x11c));if(!_0x5d77c3)return;_0x5d77c3[_0xd5f12b(0x299)][_0xd5f12b(0x289)](_0xd5f12b(0x1ba)),pendingNoteSessionId=null;try{releaseFocus();}catch(_0x54cc21){}}async function switchView(_0x3ac211){const _0x303e5b=_0x1b5e35;$$(_0x303e5b(0x207))[_0x303e5b(0x378)](_0x516c15=>_0x516c15['classList']['remove'](_0x303e5b(0x2ef))),$(_0x303e5b(0x29e)+_0x3ac211)[_0x303e5b(0x299)][_0x303e5b(0x11e)](_0x303e5b(0x2ef)),$$('.nav-btn')[_0x303e5b(0x378)](_0x42dac7=>_0x42dac7[_0x303e5b(0x299)][_0x303e5b(0x289)](_0x303e5b(0x2ef)));const _0x40b244=$(_0x303e5b(0x375)+_0x3ac211+'\x22]');if(_0x40b244)_0x40b244[_0x303e5b(0x299)][_0x303e5b(0x11e)]('active');data[_0x303e5b(0x241)][_0x303e5b(0x3c3)]=_0x3ac211,await saveData(),_0x3ac211===_0x303e5b(0x1b5)&&renderDashboard();}function closeAllMenus(){const _0xed8a19=_0x1b5e35;$$(_0xed8a19(0x26e))[_0xed8a19(0x378)](_0x4ae256=>_0x4ae256['classList'][_0xed8a19(0x289)](_0xed8a19(0x1ba))),$$(_0xed8a19(0x3f9))[_0xed8a19(0x378)](_0x4f9aa8=>_0x4f9aa8[_0xed8a19(0x299)][_0xed8a19(0x289)]('menu-active'));}function renderTopics(){const _0x1222b5=_0x1b5e35,_0x580725=$(_0x1222b5(0x2b5));if(!_0x580725)return;_0x580725[_0x1222b5(0x33b)]='';const _0x1663e8=data['settings'][_0x1222b5(0x2ee)]||{};data[_0x1222b5(0x28e)][_0x1222b5(0x378)](_0x5d60d2=>{const _0x49a7e1=_0x1222b5,_0x573ae7=document[_0x49a7e1(0x2b4)](_0x49a7e1(0x340));_0x573ae7['className']='topic-item',_0x573ae7['dataset'][_0x49a7e1(0x318)]=_0x5d60d2['id'];const _0x350410=document[_0x49a7e1(0x2b4)]('div');_0x350410[_0x49a7e1(0x223)]=_0x49a7e1(0x147);const _0x2e9a3c=!!_0x1663e8[_0x5d60d2['id']],_0x2571ca=document[_0x49a7e1(0x2b4)]('button');_0x2571ca['className']=_0x49a7e1(0x249),_0x2571ca[_0x49a7e1(0x31c)](_0x49a7e1(0x3d1),String(!_0x2e9a3c)),_0x2571ca[_0x49a7e1(0x33b)]=_0x49a7e1(0x31e);const _0x13404d=document['createElement']('div');_0x13404d[_0x49a7e1(0x223)]=_0x49a7e1(0x3cb),_0x13404d[_0x49a7e1(0x176)]=_0x5d60d2[_0x49a7e1(0x359)];const _0x4afd6e=document[_0x49a7e1(0x2b4)](_0x49a7e1(0x340));_0x4afd6e[_0x49a7e1(0x223)]=_0x49a7e1(0x33e);const _0x4ecf8b=document[_0x49a7e1(0x2b4)](_0x49a7e1(0x2c0));_0x4ecf8b[_0x49a7e1(0x223)]='btn\x20small',_0x4ecf8b[_0x49a7e1(0x33b)]=_0x49a7e1(0x35f),_0x4ecf8b[_0x49a7e1(0x32c)]=_0x49a7e1(0x26a);const _0xc1f0f7=document[_0x49a7e1(0x2b4)](_0x49a7e1(0x340));_0xc1f0f7['style'][_0x49a7e1(0x258)]=_0x49a7e1(0x1fa);const _0x1df1ad=document[_0x49a7e1(0x2b4)](_0x49a7e1(0x2c0));_0x1df1ad[_0x49a7e1(0x223)]=_0x49a7e1(0x27b),_0x1df1ad[_0x49a7e1(0x33b)]='...',_0x1df1ad[_0x49a7e1(0x32c)]='Thêm\x20tùy\x20chọn';const _0x5001ec=document[_0x49a7e1(0x2b4)](_0x49a7e1(0x340));_0x5001ec[_0x49a7e1(0x223)]=_0x49a7e1(0x2e1);const _0x1a98bf=document[_0x49a7e1(0x2b4)](_0x49a7e1(0x2c0));_0x1a98bf[_0x49a7e1(0x223)]=_0x49a7e1(0x292),_0x1a98bf[_0x49a7e1(0x33b)]=_0x49a7e1(0x303);const _0x2bdcff=document[_0x49a7e1(0x2b4)](_0x49a7e1(0x2c0));_0x2bdcff['className']=_0x49a7e1(0x382),_0x2bdcff['innerHTML']=_0x49a7e1(0x3bb),_0x5001ec['append'](_0x1a98bf,_0x2bdcff),_0xc1f0f7[_0x49a7e1(0x1bd)](_0x1df1ad,_0x5001ec),_0x4afd6e['append'](_0x4ecf8b,_0xc1f0f7),_0x350410[_0x49a7e1(0x1bd)](_0x2571ca,_0x13404d,_0x4afd6e),_0x2571ca['addEventListener'](_0x49a7e1(0x302),async _0x7f7302=>{const _0x17de6d=_0x49a7e1;_0x7f7302[_0x17de6d(0x187)]();const _0x533113=!!_0x1663e8[_0x5d60d2['id']];_0x533113?delete _0x1663e8[_0x5d60d2['id']]:_0x1663e8[_0x5d60d2['id']]=!![],data['settings']['collapsedTopics']=_0x1663e8,await storageManager['updateSettings'](data[_0x17de6d(0x241)]),renderTopics();});const _0x5c1a86=async()=>{const _0x24647a=_0x49a7e1,_0x4ef3ca=!!_0x1663e8[_0x5d60d2['id']];_0x4ef3ca?delete _0x1663e8[_0x5d60d2['id']]:_0x1663e8[_0x5d60d2['id']]=!![],data[_0x24647a(0x241)][_0x24647a(0x2ee)]=_0x1663e8,await storageManager[_0x24647a(0x148)](data['settings']),renderTopics();};_0x350410[_0x49a7e1(0x2f7)](_0x49a7e1(0x302),async _0x381156=>{const _0x4c8d32=_0x49a7e1,_0x414aaf=_0x381156[_0x4c8d32(0x1e7)];if(_0x414aaf&&_0x414aaf[_0x4c8d32(0x308)]){if(_0x414aaf[_0x4c8d32(0x308)](_0x4c8d32(0x125))||_0x414aaf['closest'](_0x4c8d32(0x229))||_0x414aaf[_0x4c8d32(0x308)]('button')||_0x414aaf[_0x4c8d32(0x308)](_0x4c8d32(0x269)))return;}_0x381156[_0x4c8d32(0x187)](),await _0x5c1a86();}),_0x13404d['addEventListener']('click',async _0xec9cbf=>{_0xec9cbf['stopPropagation'](),await _0x5c1a86();}),_0x573ae7[_0x49a7e1(0x2f7)](_0x49a7e1(0x302),async _0x40be7f=>{const _0x2b7ea0=_0x49a7e1,_0x2ca353=_0x40be7f['target'];if(_0x2ca353&&_0x2ca353[_0x2b7ea0(0x308)]){if(_0x2ca353[_0x2b7ea0(0x308)](_0x2b7ea0(0x25a)))return;if(_0x2ca353[_0x2b7ea0(0x308)](_0x2b7ea0(0x125))||_0x2ca353['closest']('.actions-menu-btn')||_0x2ca353[_0x2b7ea0(0x308)](_0x2b7ea0(0x2c0))||_0x2ca353['closest'](_0x2b7ea0(0x269)))return;}await _0x5c1a86();});const _0x36a8b0=document[_0x49a7e1(0x2b4)](_0x49a7e1(0x340));_0x36a8b0[_0x49a7e1(0x223)]='subtopics'+(_0x2e9a3c?_0x49a7e1(0x13a):''),_0x36a8b0[_0x49a7e1(0xfd)]['tid']=_0x5d60d2['id'],_0x5d60d2[_0x49a7e1(0x2d5)][_0x49a7e1(0x378)](_0x54b739=>{const _0x571e4c=_0x49a7e1,_0xb9caf7=document[_0x571e4c(0x2b4)](_0x571e4c(0x340));_0xb9caf7[_0x571e4c(0x223)]='sub-row',_0xb9caf7[_0x571e4c(0xfd)][_0x571e4c(0x39e)]=_0x54b739['id'];const _0x534496=document['createElement'](_0x571e4c(0x2c0));_0x534496[_0x571e4c(0x223)]='btn\x20subtopic-btn',_0x534496[_0x571e4c(0x176)]='•\x20'+_0x54b739[_0x571e4c(0x359)],_0x534496[_0x571e4c(0xfd)][_0x571e4c(0x39e)]=_0x54b739['id'],_0x534496[_0x571e4c(0xfd)]['tid']=_0x5d60d2['id'];if(data[_0x571e4c(0x241)][_0x571e4c(0x346)]===_0x54b739['id'])_0x534496['classList'][_0x571e4c(0x11e)]('active');const _0x381bc4=document[_0x571e4c(0x2b4)](_0x571e4c(0x340));_0x381bc4[_0x571e4c(0x223)]='actions';const _0x1b414e=document[_0x571e4c(0x2b4)](_0x571e4c(0x340));_0x1b414e['style'][_0x571e4c(0x258)]=_0x571e4c(0x1fa);const _0x2bc95c=document[_0x571e4c(0x2b4)](_0x571e4c(0x2c0));_0x2bc95c['className']=_0x571e4c(0x27b),_0x2bc95c[_0x571e4c(0x33b)]=_0x571e4c(0x232),_0x2bc95c[_0x571e4c(0x32c)]=_0x571e4c(0x174);const _0x27d74f=document['createElement'](_0x571e4c(0x340));_0x27d74f[_0x571e4c(0x223)]=_0x571e4c(0x2e1);const _0x19c3bd=document[_0x571e4c(0x2b4)]('button');_0x19c3bd[_0x571e4c(0x223)]=_0x571e4c(0x292),_0x19c3bd['innerHTML']=_0x571e4c(0x1ce);const _0x40113b=document[_0x571e4c(0x2b4)](_0x571e4c(0x2c0));_0x40113b[_0x571e4c(0x223)]=_0x571e4c(0x382),_0x40113b[_0x571e4c(0x33b)]=_0x571e4c(0x2d6),_0x27d74f[_0x571e4c(0x1bd)](_0x19c3bd,_0x40113b),_0x1b414e[_0x571e4c(0x1bd)](_0x2bc95c,_0x27d74f),_0x381bc4[_0x571e4c(0x1bd)](_0x1b414e),_0xb9caf7['append'](_0x534496,_0x381bc4),_0x36a8b0['appendChild'](_0xb9caf7),_0x534496[_0x571e4c(0x2f7)](_0x571e4c(0x302),()=>selectSubtopic(_0x5d60d2['id'],_0x54b739['id'])),_0x2bc95c[_0x571e4c(0x2f7)](_0x571e4c(0x302),_0x2fac51=>{const _0x366be1=_0x571e4c;_0x2fac51['stopPropagation']();const _0x5da80d=_0x27d74f['classList']['contains'](_0x366be1(0x1ba));closeAllMenus(),_0x5da80d?_0x573ae7['classList'][_0x366be1(0x289)](_0x366be1(0x365)):(_0x27d74f[_0x366be1(0x299)][_0x366be1(0x11e)]('show'),_0x573ae7[_0x366be1(0x299)][_0x366be1(0x11e)](_0x366be1(0x365)));}),_0x19c3bd[_0x571e4c(0x2f7)](_0x571e4c(0x302),()=>showInputModal(_0x571e4c(0x306),async _0x23f6e3=>{const _0x2d89af=_0x571e4c;if(!_0x23f6e3)return;_0x54b739['name']=_0x23f6e3,await storageManager[_0x2d89af(0x17d)](_0x2d89af(0x2d5),_0x54b739),renderAll();},_0x54b739[_0x571e4c(0x359)])),_0x40113b[_0x571e4c(0x2f7)]('click',()=>showConfirmModal(_0x571e4c(0x3fb),_0x571e4c(0x2be)+_0x54b739[_0x571e4c(0x359)]+_0x571e4c(0x1bb),async _0x556b47=>{const _0x59f194=_0x571e4c;if(!_0x556b47)return;_0x5d60d2['subtopics']=_0x5d60d2[_0x59f194(0x2d5)][_0x59f194(0x3b3)](_0x196c00=>_0x196c00['id']!==_0x54b739['id']);const _0x37ab7f=data[_0x59f194(0x241)];_0x37ab7f['selectedSubtopicId']===_0x54b739['id']&&(_0x37ab7f['selectedSubtopicId']='',_0x37ab7f[_0x59f194(0x1a4)]='',ensureValidSelection()),await storageManager[_0x59f194(0x2cd)]('subtopics',_0x54b739['id']),renderAll();}));}),_0x1df1ad[_0x49a7e1(0x2f7)](_0x49a7e1(0x302),_0x3655d9=>{const _0x1c9c2d=_0x49a7e1;_0x3655d9['stopPropagation']();const _0x2dbda1=_0x5001ec['classList']['contains'](_0x1c9c2d(0x1ba));closeAllMenus(),_0x2dbda1?_0x573ae7[_0x1c9c2d(0x299)][_0x1c9c2d(0x289)](_0x1c9c2d(0x365)):(_0x5001ec[_0x1c9c2d(0x299)][_0x1c9c2d(0x11e)](_0x1c9c2d(0x1ba)),_0x573ae7[_0x1c9c2d(0x299)][_0x1c9c2d(0x11e)](_0x1c9c2d(0x365)));}),_0x4ecf8b[_0x49a7e1(0x2f7)](_0x49a7e1(0x302),()=>showInputModal(_0x49a7e1(0x120),async _0x24a12c=>{const _0x7e8707=_0x49a7e1;if(!_0x24a12c)return;const _0x1b4c6d={'id':uid('s'),'topicId':_0x5d60d2['id'],'name':_0x24a12c,'tasks':[],'generalNotes':[],'summaries':[],'chatHistory':[],'methods':[],'stats':{'totalMinutes':0x0,'sessionsCompleted':0x0,'tasksCompleted':0x0},'sessions':[],'timerState':{'state':'idle','prevState':null,'remaining':0x0,'segmentTotal':0x0,'cycleIndex':0x0}};_0x5d60d2[_0x7e8707(0x2d5)]['push'](_0x1b4c6d),await storageManager[_0x7e8707(0x11e)](_0x7e8707(0x2d5),_0x1b4c6d),renderTopics();})),_0x1a98bf[_0x49a7e1(0x2f7)](_0x49a7e1(0x302),()=>showInputModal(_0x49a7e1(0x407),async _0xef9359=>{const _0x4b60cc=_0x49a7e1;if(!_0xef9359)return;_0x5d60d2[_0x4b60cc(0x359)]=_0xef9359,await storageManager[_0x4b60cc(0x17d)](_0x4b60cc(0x28e),_0x5d60d2),renderTopics();},_0x5d60d2[_0x49a7e1(0x359)])),_0x2bdcff['addEventListener'](_0x49a7e1(0x302),()=>showConfirmModal(_0x49a7e1(0x3fb),_0x49a7e1(0x20b)+_0x5d60d2[_0x49a7e1(0x359)]+'\x22?\x20Mọi\x20chủ\x20đề\x20con\x20và\x20dữ\x20liệu\x20liên\x20quan\x20sẽ\x20bị\x20mất.',async _0x59cc69=>{const _0x20671d=_0x49a7e1;if(!_0x59cc69)return;data['topics']=data[_0x20671d(0x28e)]['filter'](_0x302790=>_0x302790['id']!==_0x5d60d2['id']),delete _0x1663e8[_0x5d60d2['id']];data['settings']['selectedTopicId']===_0x5d60d2['id']&&(data[_0x20671d(0x241)][_0x20671d(0x1a4)]='',data[_0x20671d(0x241)][_0x20671d(0x346)]='',ensureValidSelection());await storageManager['delete'](_0x20671d(0x28e),_0x5d60d2['id']);for(const _0x1cb9ee of _0x5d60d2[_0x20671d(0x2d5)]){await storageManager[_0x20671d(0x2cd)](_0x20671d(0x2d5),_0x1cb9ee['id']);}renderAll();})),_0x4ecf8b[_0x49a7e1(0x2f7)](_0x49a7e1(0x302),_0x5ef56a=>_0x5ef56a[_0x49a7e1(0x187)]()),_0x1a98bf[_0x49a7e1(0x2f7)]('click',_0x1d79be=>_0x1d79be[_0x49a7e1(0x187)]()),_0x2bdcff[_0x49a7e1(0x2f7)](_0x49a7e1(0x302),_0x43b7ae=>_0x43b7ae['stopPropagation']()),_0x573ae7[_0x49a7e1(0x1bd)](_0x350410,_0x36a8b0),_0x580725[_0x49a7e1(0x376)](_0x573ae7);});if(window['Sortable']){const _0x3c493e=document['getElementById'](_0x1222b5(0x389));if(_0x3c493e){if(_0x3c493e[_0x1222b5(0x34a)])try{_0x3c493e[_0x1222b5(0x34a)][_0x1222b5(0x23c)]();}catch(_0x3eecb1){}_0x3c493e[_0x1222b5(0x34a)]=new Sortable(_0x3c493e,{'animation':0x96,'draggable':_0x1222b5(0x138),'onEnd':async function(_0x2628bb){const _0x53e12d=_0x1222b5;if(_0x2628bb[_0x53e12d(0x1cc)]===_0x2628bb[_0x53e12d(0x1c9)])return;const _0x335b48=data[_0x53e12d(0x28e)][_0x53e12d(0x1fc)](_0x2628bb[_0x53e12d(0x1cc)],0x1)[0x0];data[_0x53e12d(0x28e)][_0x53e12d(0x1fc)](_0x2628bb[_0x53e12d(0x1c9)],0x0,_0x335b48),await saveData(),renderTopics();}}),_0x3c493e['querySelectorAll'](_0x1222b5(0x25a))[_0x1222b5(0x378)](_0x2fd4f1=>{const _0x636aa2=_0x1222b5;new Sortable(_0x2fd4f1,{'group':_0x636aa2(0x3de),'animation':0x96,'draggable':_0x636aa2(0x188),'onEnd':async function(_0xcabd77){const _0x15b649=_0x636aa2,_0x4c3997=_0xcabd77['from']?.[_0x15b649(0xfd)]?.['tid']||_0xcabd77[_0x15b649(0x150)]?.[_0x15b649(0x308)](_0x15b649(0x138))?.[_0x15b649(0xfd)]?.['tid'],_0x292299=_0xcabd77['to']?.[_0x15b649(0xfd)]?.[_0x15b649(0x318)]||_0xcabd77['to']?.[_0x15b649(0x308)](_0x15b649(0x138))?.[_0x15b649(0xfd)]?.[_0x15b649(0x318)],_0x3e384c=data['topics'][_0x15b649(0x3b7)](_0x1fc318=>_0x1fc318['id']===_0x4c3997),_0x34b816=data[_0x15b649(0x28e)][_0x15b649(0x3b7)](_0x132483=>_0x132483['id']===_0x292299);if(!_0x3e384c||!_0x34b816)return;let _0x191876=null;const _0x15378b=_0xcabd77['item']?.['dataset']?.[_0x15b649(0x39e)]||_0xcabd77['item']?.[_0x15b649(0x388)](_0x15b649(0x2ae))?.[_0x15b649(0xfd)]?.[_0x15b649(0x39e)];if(_0x15378b){const _0x4e502d=_0x3e384c[_0x15b649(0x2d5)]['findIndex'](_0x2cf486=>_0x2cf486['id']===_0x15378b);if(_0x4e502d>=0x0)_0x191876=_0x3e384c[_0x15b649(0x2d5)]['splice'](_0x4e502d,0x1)[0x0];}!_0x191876&&(_0x191876=_0x3e384c[_0x15b649(0x2d5)][_0x15b649(0x1fc)](_0xcabd77[_0x15b649(0x1cc)],0x1)[0x0]);if(!_0x191876)return;_0x191876[_0x15b649(0x197)]=_0x34b816['id'],_0x34b816[_0x15b649(0x2d5)][_0x15b649(0x1fc)](_0xcabd77[_0x15b649(0x1c9)],0x0,_0x191876),data[_0x15b649(0x241)][_0x15b649(0x346)]===_0x191876['id']&&(data[_0x15b649(0x241)][_0x15b649(0x1a4)]=_0x34b816['id']),await saveData(),renderTopics();}});});}}}function selectSubtopic(_0x346fda,_0x195687){const _0x5e4d41=_0x1b5e35,_0xcae79=$(_0x5e4d41(0x1a3)),_0x1308d6=getCurrentSubtopic();_0x1308d6&&timer[_0x5e4d41(0x1c3)]!==_0x5e4d41(0x21e)&&(_0x1308d6[_0x5e4d41(0x360)]={'state':timer[_0x5e4d41(0x1c3)],'prevState':timer['prevState'],'remaining':timer[_0x5e4d41(0x123)],'segmentTotal':timer[_0x5e4d41(0x107)],'cycleIndex':timer[_0x5e4d41(0x1c0)]}),_0xcae79[_0x5e4d41(0x299)]['add']('reloading'),setTimeout(async()=>{const _0x2a996b=_0x5e4d41;data['settings']['selectedTopicId']=_0x346fda,data[_0x2a996b(0x241)][_0x2a996b(0x346)]=_0x195687;const _0x2960d1=getCurrentSubtopic();_0x2960d1[_0x2a996b(0x360)]?(timer[_0x2a996b(0x1c3)]=_0x2960d1[_0x2a996b(0x360)][_0x2a996b(0x1c3)],timer[_0x2a996b(0x210)]=_0x2960d1[_0x2a996b(0x360)][_0x2a996b(0x210)]||null,timer['remaining']=_0x2960d1['timerState']['remaining'],timer[_0x2a996b(0x107)]=_0x2960d1[_0x2a996b(0x360)][_0x2a996b(0x107)],timer[_0x2a996b(0x1c0)]=_0x2960d1['timerState'][_0x2a996b(0x1c0)]):timer['reset'](),await saveData(),timer[_0x2a996b(0x2d3)](),renderAll(),switchView('timer'),_0xcae79[_0x2a996b(0x299)][_0x2a996b(0x289)](_0x2a996b(0x23e));},0xc8);}function getCurrentSubtopic(){const _0x2baf3f=_0x1b5e35,_0x17c33d=data['settings'][_0x2baf3f(0x1a4)],_0x5c1494=data[_0x2baf3f(0x241)]['selectedSubtopicId'];if(!_0x17c33d||!_0x5c1494)return null;const _0xc34a55=data[_0x2baf3f(0x28e)]['find'](_0x695773=>_0x695773['id']===_0x17c33d);if(!_0xc34a55)return null;return _0xc34a55[_0x2baf3f(0x2d5)][_0x2baf3f(0x3b7)](_0x266718=>_0x266718['id']===_0x5c1494)||null;}function renderContextBadge(){const _0xb38c64=_0x1b5e35,_0x211a98=getCurrentSubtopic(),_0x304cbd=_0x211a98?_0x211a98['name']:_0xb38c64(0x3e3),_0x5ae55b=$('#selectedContext'),_0x4e5cb4=$(_0xb38c64(0x366)),_0x15c187=$(_0xb38c64(0x343));if(_0x5ae55b)_0x5ae55b['textContent']=_0x211a98?_0xb38c64(0x367)+_0x211a98[_0xb38c64(0x359)]:_0xb38c64(0x3a3);if(_0x4e5cb4)_0x4e5cb4[_0xb38c64(0x176)]=_0x304cbd;if(_0x15c187)_0x15c187[_0xb38c64(0x176)]=_0x304cbd;}function renderSubtopicTasks(){const _0x1033c0=_0x1b5e35,_0x11d878=getCurrentSubtopic(),_0x247f30=$(_0x1033c0(0x3eb)),_0x5f3fff=$(_0x1033c0(0x1aa));if(!_0x247f30||!_0x5f3fff)return;const _0xf6f9bd=_0x5f3fff['parentElement'];if(!_0x11d878){_0x247f30[_0x1033c0(0x33b)]=_0x1033c0(0x313),_0xf6f9bd['classList'][_0x1033c0(0x11e)]('hidden');return;}_0xf6f9bd[_0x1033c0(0x299)][_0x1033c0(0x289)]('hidden'),_0x247f30[_0x1033c0(0x33b)]='';const _0x17e586=_0x11d878[_0x1033c0(0x3b8)]?_0x11d878[_0x1033c0(0x3b8)][_0x1033c0(0x3b3)](_0x4beb70=>!_0x4beb70[_0x1033c0(0x37e)]):[];_0x17e586[_0x1033c0(0x1a1)]===0x0&&(_0x247f30[_0x1033c0(0x33b)]=_0x1033c0(0xfc)),_0x17e586['forEach'](_0x66312d=>{const _0x22133b=_0x1033c0,_0x5e9008=document[_0x22133b(0x2b4)]('li');_0x5e9008[_0x22133b(0x33b)]=_0x22133b(0x3d5)+_0x66312d['id']+_0x22133b(0x2fd)+_0x66312d['id']+'\x22>'+escapeHTML(_0x66312d[_0x22133b(0x276)])+_0x22133b(0x3be),_0x5e9008[_0x22133b(0x388)]('input')['addEventListener'](_0x22133b(0x3a6),_0x1676ab=>toggleSubtopicTask(_0x1676ab[_0x22133b(0x1e7)]['id'],_0x5e9008)),_0x247f30[_0x22133b(0x376)](_0x5e9008);});}async function addSubtopicTask(){const _0x3a9f2c=_0x1b5e35,_0x22263f=getCurrentSubtopic();if(!_0x22263f){toast(t(_0x3a9f2c(0x402)));return;}const _0x1d2819=$('#newSubtopicTaskInput'),_0x1b30b2=_0x1d2819[_0x3a9f2c(0x117)][_0x3a9f2c(0x287)]();if(_0x1b30b2){if(!_0x22263f['tasks'])_0x22263f[_0x3a9f2c(0x3b8)]=[];_0x22263f[_0x3a9f2c(0x3b8)][_0x3a9f2c(0x134)]({'id':uid(_0x3a9f2c(0x259)),'text':_0x1b30b2,'isCompleted':![],'createdAt':todayISO()}),await saveData(),renderSubtopicTasks(),_0x1d2819[_0x3a9f2c(0x117)]='';}_0x1d2819[_0x3a9f2c(0xf6)]();}async function toggleSubtopicTask(_0x1ff772,_0x36e41f){const _0x385992=_0x1b5e35,_0xcbf2d=getCurrentSubtopic();if(!_0xcbf2d||!_0xcbf2d[_0x385992(0x3b8)])return;const _0x50933c=_0xcbf2d[_0x385992(0x3b8)]['find'](_0x450742=>_0x450742['id']===_0x1ff772);_0x50933c&&(_0x50933c[_0x385992(0x37e)]=!![],_0xcbf2d['stats'][_0x385992(0x304)]=(_0xcbf2d[_0x385992(0x1b5)][_0x385992(0x304)]||0x0)+0x1,await saveData(),_0x36e41f[_0x385992(0x299)][_0x385992(0x11e)](_0x385992(0x152)),setTimeout(()=>{renderSubtopicTasks(),renderStatsHistory();},0xc8));}const timer={'state':'idle','prevState':null,'tickHandle':null,'endAt':null,'remaining':0x0,'segmentTotal':0x0,'cyclesTarget':0x4,'cycleIndex':0x0,'mode':'A','persistInterval':0x3c*0x3e8,'lastPersist':0x0,async 'setPreset'(_0xebec51,{silent:silent=![]}={}){const _0xd73f29=_0x1b5e35,_0x32e91a=data[_0xd73f29(0x241)];this[_0xd73f29(0x2a9)]=_0xebec51,this[_0xd73f29(0x3e2)]=_0xebec51==='A'?_0x32e91a[_0xd73f29(0x16f)]:_0xebec51==='B'?_0x32e91a[_0xd73f29(0x2f5)]:0x0,_0x32e91a[_0xd73f29(0x3e9)]=_0xebec51,await saveData(),this[_0xd73f29(0x1c3)]===_0xd73f29(0x21e)&&this['reset']();},'currentDurations'(){const _0x4674dc=_0x1b5e35,_0x41bfef=data[_0x4674dc(0x241)][_0x4674dc(0x11f)];if(this['mode']==='A')return{'work':_0x41bfef[_0x4674dc(0x39a)],'short':_0x41bfef[_0x4674dc(0x390)],'long':_0x41bfef[_0x4674dc(0x170)],'winddown':_0x41bfef[_0x4674dc(0x3ec)]??0x0};if(this['mode']==='B')return{'work':_0x41bfef[_0x4674dc(0x398)],'short':_0x41bfef[_0x4674dc(0x205)],'long':_0x41bfef[_0x4674dc(0x386)],'winddown':_0x41bfef[_0x4674dc(0x2bd)]??0x0};return{'work':0x0,'short':0x0,'long':0x0,'winddown':0x0};},'currentConfig'(){const _0x49d75a=_0x1b5e35,_0x384464=data[_0x49d75a(0x241)];if(this[_0x49d75a(0x2a9)]==='A')return{'cycles':_0x384464['cyclesA'],'interval':_0x384464[_0x49d75a(0x1af)]};if(this[_0x49d75a(0x2a9)]==='B')return{'cycles':_0x384464['cyclesB'],'interval':_0x384464[_0x49d75a(0x270)]};return{'cycles':0x0,'interval':0x0};},'updateUI'(){const _0x31228a=_0x1b5e35,_0x2f0b23=$(_0x31228a(0x2b6)),_0x4a203c=$(_0x31228a(0x2af)),_0x2edcee=$(_0x31228a(0x1db));if(!_0x2f0b23||!_0x4a203c||!_0x2edcee)return;const _0x32048b=this['mode']==='C';$(_0x31228a(0x1ed))[_0x31228a(0x299)][_0x31228a(0x1b2)](_0x31228a(0x31a),this[_0x31228a(0x1c3)]!=='idle'||_0x32048b&&this[_0x31228a(0x1c3)]===_0x31228a(0x121)),$(_0x31228a(0x26b))[_0x31228a(0x299)]['toggle'](_0x31228a(0x31a),!(_0x32048b&&this[_0x31228a(0x1c3)]==='work')),$(_0x31228a(0x305))[_0x31228a(0x299)][_0x31228a(0x1b2)](_0x31228a(0x31a),![_0x31228a(0x121),_0x31228a(0x2fc),_0x31228a(0x3ae)][_0x31228a(0x1e1)](this[_0x31228a(0x1c3)])),$('#btnResume')[_0x31228a(0x299)][_0x31228a(0x1b2)](_0x31228a(0x31a),this[_0x31228a(0x1c3)]!=='paused');let _0x4e750a=_0x31228a(0x13c);if(this[_0x31228a(0x1c3)]===_0x31228a(0x121))_0x2f0b23[_0x31228a(0x176)]=_0x32048b?_0x31228a(0x3c1):_0x31228a(0x35b),_0x2f0b23['className']='badge\x20state\x20work',_0x4e750a=_0x31228a(0x2f6);else{if(this['state']==='break')_0x2f0b23[_0x31228a(0x176)]='NGHỈ\x20NGẮN',_0x2f0b23[_0x31228a(0x223)]=_0x31228a(0xf0),_0x4e750a=_0x31228a(0x11a);else{if(this['state']==='long_break')_0x2f0b23['textContent']=_0x31228a(0x12a),_0x2f0b23[_0x31228a(0x223)]=_0x31228a(0x1bf),_0x4e750a=_0x31228a(0x149);else{if(this[_0x31228a(0x1c3)]===_0x31228a(0x3a0)){_0x2f0b23[_0x31228a(0x176)]='HẠ\x20NHIỆT',_0x2f0b23[_0x31228a(0x223)]='badge\x20state\x20work',_0x4e750a=_0x31228a(0x1ca);try{$('#windDownChecklist')[_0x31228a(0x299)][_0x31228a(0x289)]('hidden'),$(_0x31228a(0x10a))[_0x31228a(0x299)][_0x31228a(0x289)](_0x31228a(0x31a));}catch(_0x16dbcb){}}else this[_0x31228a(0x1c3)]===_0x31228a(0x30e)?(_0x2f0b23[_0x31228a(0x176)]=_0x31228a(0x13d),_0x2f0b23[_0x31228a(0x223)]=_0x31228a(0x38d)):(_0x2f0b23['textContent']=_0x31228a(0x22d),_0x2f0b23[_0x31228a(0x223)]=_0x31228a(0x38d));}}}[_0x31228a(0x121),'break',_0x31228a(0x3ae),'wind_down'][_0x31228a(0x1e1)](this['state'])?_0x2edcee[_0x31228a(0x299)][_0x31228a(0x11e)](_0x31228a(0x24b)):_0x2edcee[_0x31228a(0x299)][_0x31228a(0x289)](_0x31228a(0x24b));_0x4a203c['style'][_0x31228a(0x294)]=_0x4e750a,_0x2edcee[_0x31228a(0x299)][_0x31228a(0x289)](_0x31228a(0x3b4));const _0x5048a2=$(_0x31228a(0x369));if(_0x5048a2)_0x5048a2[_0x31228a(0x176)]=formatMMSS(this['remaining']);const _0x25ad83=_0x4a203c['r'][_0x31228a(0x1dc)]['value'],_0x5ca115=0x2*Math['PI']*_0x25ad83,_0x37597a=this[_0x31228a(0x107)]>0x0?_0x5ca115-this[_0x31228a(0x123)]/this[_0x31228a(0x107)]*_0x5ca115:_0x5ca115;_0x4a203c['style'][_0x31228a(0x2e2)]=_0x5ca115,_0x4a203c[_0x31228a(0x300)][_0x31228a(0x312)]=isNaN(_0x37597a)?_0x5ca115:_0x37597a;const _0x1d74db=$('#cycleInfo');if(_0x1d74db){const _0x454a76=this[_0x31228a(0x364)]();_0x1d74db[_0x31228a(0x176)]=t(_0x31228a(0x347),{'current':this[_0x31228a(0x1c0)],'target':_0x454a76[_0x31228a(0x277)]}),_0x1d74db[_0x31228a(0x299)]['toggle'](_0x31228a(0x31a),_0x32048b);}const _0x59f16a=$('#breakSuggestionDisplay');_0x59f16a&&_0x59f16a[_0x31228a(0x299)][_0x31228a(0x1b2)](_0x31228a(0x31a),_0x32048b&&this[_0x31228a(0x1c3)]===_0x31228a(0x121));const _0x663204=$(_0x31228a(0x36e));if(_0x663204)_0x663204[_0x31228a(0x176)]=formatMMSS(this[_0x31228a(0x123)]);if(this[_0x31228a(0x1c3)]!==_0x31228a(0x3a0))try{$(_0x31228a(0x2fa))[_0x31228a(0x299)][_0x31228a(0x11e)](_0x31228a(0x31a)),$('#btnBreakEarly')['classList'][_0x31228a(0x11e)](_0x31228a(0x31a));}catch(_0xb1d8c6){}},'persistTimerState'(_0x1fde2c=![]){const _0x50e261=_0x1b5e35;try{const _0x11e1a7=getCurrentSubtopic();if(!_0x11e1a7)return;const _0x4e8973={'state':this[_0x50e261(0x1c3)],'prevState':this[_0x50e261(0x210)],'remaining':this['remaining'],'segmentTotal':this[_0x50e261(0x107)],'cycleIndex':this[_0x50e261(0x1c0)]};_0x11e1a7['timerState']=_0x4e8973;try{localStorage[_0x50e261(0x2c6)]('timerState_'+_0x11e1a7['id'],JSON[_0x50e261(0x1ac)](_0x4e8973));}catch(_0x318f22){}this[_0x50e261(0x32a)]=Date[_0x50e261(0x115)]();}catch(_0x1eb571){}},'_startTick'(){const _0x1b41fb=_0x1b5e35;if(this[_0x1b41fb(0x261)])clearInterval(this[_0x1b41fb(0x261)]);if(this[_0x1b41fb(0x2a9)]==='C'&&this[_0x1b41fb(0x1c3)]===_0x1b41fb(0x121)){this[_0x1b41fb(0x261)]=setInterval(()=>{const _0x2e12a3=_0x1b41fb;this[_0x2e12a3(0x123)]+=0x1,this[_0x2e12a3(0x2d3)](),this[_0x2e12a3(0x323)]();},0x3e8);return;}this[_0x1b41fb(0x261)]=setInterval(()=>{const _0x4b2fe1=_0x1b41fb;this[_0x4b2fe1(0x123)]>0x0&&(this[_0x4b2fe1(0x123)]-=0x1,this[_0x4b2fe1(0x2d3)](),this['persistTimerState']()),this['remaining']<=0x0&&(clearInterval(this[_0x4b2fe1(0x261)]),this['tickHandle']=null,this['_onFinishSegment']());},0x3e8);},'_onFinishSegment'(){const _0x4ebcb8=_0x1b5e35;if(this[_0x4ebcb8(0x1c3)]==='work'){const _0x53da30=getCurrentSubtopic();if(_0x53da30){const _0x431238=this[_0x4ebcb8(0x411)]()[_0x4ebcb8(0x121)];_0x53da30['stats'][_0x4ebcb8(0x362)]=(_0x53da30['stats'][_0x4ebcb8(0x362)]||0x0)+_0x431238,_0x53da30[_0x4ebcb8(0x1b5)][_0x4ebcb8(0x321)]=(_0x53da30['stats'][_0x4ebcb8(0x321)]||0x0)+0x1;const _0x1d398d={'id':uid(_0x4ebcb8(0x335)),'dateISO':todayISO(),'durationMinutes':_0x431238,'mode':this[_0x4ebcb8(0x2a9)],'note':''};if(!_0x53da30[_0x4ebcb8(0x230)])_0x53da30[_0x4ebcb8(0x230)]=[];_0x53da30[_0x4ebcb8(0x230)][_0x4ebcb8(0x246)](_0x1d398d);if(data?.[_0x4ebcb8(0x241)]?.[_0x4ebcb8(0x2db)]!==![])try{openNoteModal(_0x1d398d['id']);}catch(_0x19eb53){}saveData(),renderStatsHistory(),checkAndShowMilestones();}this['cycleIndex']++;}if(typeof data!==_0x4ebcb8(0x158)&&data&&data[_0x4ebcb8(0x241)]&&data[_0x4ebcb8(0x241)][_0x4ebcb8(0x3e6)]===![]&&this[_0x4ebcb8(0x1c3)]===_0x4ebcb8(0x121))playSound(_0x4ebcb8(0x18a));else(this[_0x4ebcb8(0x1c3)]===_0x4ebcb8(0x3a0)||this[_0x4ebcb8(0x1c3)]===_0x4ebcb8(0x2fc)||this['state']===_0x4ebcb8(0x3ae))&&playSound(_0x4ebcb8(0x14b));const _0x291f88=$(_0x4ebcb8(0x1db));if(_0x291f88)_0x291f88['classList']['add'](_0x4ebcb8(0x3b4));if(data[_0x4ebcb8(0x241)][_0x4ebcb8(0x20c)]){if(this[_0x4ebcb8(0x1c3)]===_0x4ebcb8(0x121))data[_0x4ebcb8(0x241)][_0x4ebcb8(0x3e6)]===![]?this[_0x4ebcb8(0x163)]():this[_0x4ebcb8(0x406)]();else this[_0x4ebcb8(0x1c3)]===_0x4ebcb8(0x3a0)?this['beginBreak']():this[_0x4ebcb8(0x1e9)]();}else this[_0x4ebcb8(0x261)]&&(clearInterval(this[_0x4ebcb8(0x261)]),this['tickHandle']=null),this[_0x4ebcb8(0x1c3)]=_0x4ebcb8(0x21e),this[_0x4ebcb8(0x210)]=null,this['updateUI'](),toast(_0x4ebcb8(0x3b9));},'beginWindDown'(){const _0x32b7e6=_0x1b5e35;if(data?.[_0x32b7e6(0x241)]?.[_0x32b7e6(0x3e6)]===![]){this[_0x32b7e6(0x163)]();return;}this['prevState']=this[_0x32b7e6(0x1c3)],this[_0x32b7e6(0x1c3)]=_0x32b7e6(0x3a0);const _0x121971=(this[_0x32b7e6(0x411)]()[_0x32b7e6(0x167)]||0x0)*0x3c;if(_0x121971<=0x0){this[_0x32b7e6(0x163)]();return;}this['segmentTotal']=_0x121971,this[_0x32b7e6(0x123)]=_0x121971;try{playSound(_0x32b7e6(0x14b));}catch(_0x346fb2){}try{toast(_0x32b7e6(0x272));}catch(_0x120c7c){}this[_0x32b7e6(0x40b)](),this[_0x32b7e6(0x2d3)]();},'beginWork'(){const _0x2cdf92=_0x1b5e35;this['prevState']=this[_0x2cdf92(0x1c3)],this['state']=_0x2cdf92(0x121);if(this[_0x2cdf92(0x2a9)]==='C'){this['segmentTotal']=0x0;if(this[_0x2cdf92(0x210)]!=='paused')this[_0x2cdf92(0x123)]=0x0;}else{const _0x26daea=this[_0x2cdf92(0x411)]()[_0x2cdf92(0x121)]*0x3c;this[_0x2cdf92(0x107)]=_0x26daea;if(this[_0x2cdf92(0x210)]!=='paused')this['remaining']=_0x26daea;}const _0x3fb729=$(_0x2cdf92(0x252));_0x3fb729&&(_0x3fb729[_0x2cdf92(0x176)]=''),this[_0x2cdf92(0x40b)](),this[_0x2cdf92(0x2d3)]();},'finishFlowSession'(){const _0x5e6f40=_0x1b5e35;if(this['mode']!=='C'||this['state']!=='work')return;this[_0x5e6f40(0x261)]&&(clearInterval(this[_0x5e6f40(0x261)]),this[_0x5e6f40(0x261)]=null);const _0x3ac5b=Math['max'](0x1,parseInt(data[_0x5e6f40(0x241)][_0x5e6f40(0x2fe)]??0x5,0xa)),_0x39435c=Math[_0x5e6f40(0x228)](0x0,this[_0x5e6f40(0x123)]|0x0),_0xd85bb9=Math[_0x5e6f40(0x228)](0x3c,Math[_0x5e6f40(0x155)](_0x39435c/_0x3ac5b));try{const _0x17ae0b=getCurrentSubtopic();if(_0x17ae0b){const _0x37cf7b=Math[_0x5e6f40(0x228)](0x1,Math[_0x5e6f40(0x257)](_0x39435c/0x3c));_0x17ae0b[_0x5e6f40(0x1b5)][_0x5e6f40(0x362)]=(_0x17ae0b[_0x5e6f40(0x1b5)][_0x5e6f40(0x362)]||0x0)+_0x37cf7b,_0x17ae0b[_0x5e6f40(0x1b5)][_0x5e6f40(0x321)]=(_0x17ae0b[_0x5e6f40(0x1b5)]['sessionsCompleted']||0x0)+0x1;const _0x735622={'id':uid(_0x5e6f40(0x335)),'dateISO':todayISO(),'durationMinutes':_0x37cf7b,'mode':this[_0x5e6f40(0x2a9)],'note':''};if(!_0x17ae0b[_0x5e6f40(0x230)])_0x17ae0b['sessions']=[];_0x17ae0b[_0x5e6f40(0x230)][_0x5e6f40(0x246)](_0x735622),saveData(),renderStatsHistory(),data?.[_0x5e6f40(0x241)]?.['enableSessionNotes']!==![]&&openNoteModal(_0x735622['id']);}}catch(_0x3ef286){}this[_0x5e6f40(0x1c3)]=_0x5e6f40(0x2fc),this[_0x5e6f40(0x107)]=_0xd85bb9,this[_0x5e6f40(0x123)]=_0xd85bb9,this[_0x5e6f40(0x40b)](),this[_0x5e6f40(0x2d3)](),this[_0x5e6f40(0x323)](!![]);try{toast('Nghỉ\x20'+Math[_0x5e6f40(0x257)](_0xd85bb9/0x3c)+'\x20phút\x20theo\x20Flowtime\x20('+_0x3ac5b+').');}catch(_0x786d7){}},'beginBreak'(){const _0x244962=_0x1b5e35;this[_0x244962(0x210)]=this['state'];const _0x55da17=this[_0x244962(0x364)](),_0x33460c=this[_0x244962(0x411)]();if(this[_0x244962(0x1c0)]>0x0&&this[_0x244962(0x1c0)]%_0x55da17['interval']===0x0){this[_0x244962(0x1c3)]=_0x244962(0x3ae);const _0x107aef=_0x33460c[_0x244962(0x12f)]*0x3c;this[_0x244962(0x107)]=_0x107aef;if(this['prevState']!==_0x244962(0x30e))this[_0x244962(0x123)]=_0x107aef;toast(_0x244962(0x1f3));}else{this[_0x244962(0x1c3)]=_0x244962(0x2fc);const _0x150ce9=_0x33460c['short']*0x3c;this[_0x244962(0x107)]=_0x150ce9;if(this['prevState']!==_0x244962(0x30e))this[_0x244962(0x123)]=_0x150ce9;}const _0x30ee55=$(_0x244962(0x252));if(_0x30ee55){const _0x238ff7=Math[_0x244962(0x155)](Math[_0x244962(0x2d8)]()*breakSuggestions[_0x244962(0x1a1)]);_0x30ee55[_0x244962(0x176)]=_0x244962(0x33d)+breakSuggestions[_0x238ff7];}this[_0x244962(0x40b)](),this[_0x244962(0x2d3)]();},async 'start'(){const _0x28b148=_0x1b5e35;if(!getCurrentSubtopic()){toast(_0x28b148(0x350));return;}ensureAudio();if(this['mode']==='C'&&this[_0x28b148(0x1c3)]==='idle')this[_0x28b148(0x1c3)]=_0x28b148(0x121),this['remaining']=0x0,this[_0x28b148(0x107)]=0x0,this['cycleIndex']=0x0,this[_0x28b148(0x40b)](),this[_0x28b148(0x2d3)]();else{if(this['state']===_0x28b148(0x21e))this[_0x28b148(0x1c0)]=this['cycleIndex']||0x0,this[_0x28b148(0x1e9)]();else this['state']===_0x28b148(0x30e)&&this[_0x28b148(0x39b)]();}await this[_0x28b148(0x323)](!![]);},async 'pause'(){const _0x1cfc04=_0x1b5e35;this[_0x1cfc04(0x261)]&&(clearInterval(this[_0x1cfc04(0x261)]),this[_0x1cfc04(0x261)]=null),this[_0x1cfc04(0x210)]=this[_0x1cfc04(0x1c3)],this[_0x1cfc04(0x1c3)]=_0x1cfc04(0x30e),this['updateUI'](),await this[_0x1cfc04(0x323)](!![]);},async 'resume'(){const _0x27317d=_0x1b5e35;if(this[_0x27317d(0x1c3)]!=='paused')return;this[_0x27317d(0x1c3)]=this[_0x27317d(0x210)]||_0x27317d(0x121),this['_startTick'](),this[_0x27317d(0x2d3)](),await this[_0x27317d(0x323)](!![]);},async 'skip'(){const _0x430eaf=_0x1b5e35;if(this[_0x430eaf(0x2a9)]==='C'&&this[_0x430eaf(0x1c3)]===_0x430eaf(0x121)){this[_0x430eaf(0x3f2)](),await this[_0x430eaf(0x323)](!![]);return;}this[_0x430eaf(0x1c3)]===_0x430eaf(0x121)?(this[_0x430eaf(0x261)]&&(clearInterval(this['tickHandle']),this[_0x430eaf(0x261)]=null),this[_0x430eaf(0x123)]=0x0,this['_onFinishSegment']()):(this[_0x430eaf(0x123)]=0x0,this[_0x430eaf(0x261)]&&(clearInterval(this[_0x430eaf(0x261)]),this[_0x430eaf(0x261)]=null),this[_0x430eaf(0x1f1)]()),await this[_0x430eaf(0x323)](!![]);},async 'reset'(){const _0x490524=_0x1b5e35;this[_0x490524(0x261)]&&(clearInterval(this[_0x490524(0x261)]),this[_0x490524(0x261)]=null);this[_0x490524(0x1c3)]='idle',this[_0x490524(0x210)]=null,this[_0x490524(0x123)]=0x0,this[_0x490524(0x107)]=0x0,this[_0x490524(0x1c0)]=0x0;const _0x414ace=$(_0x490524(0x252));_0x414ace&&(_0x414ace['textContent']=''),this['updateUI'](),await this[_0x490524(0x323)](!![]);}};async function deleteSummary(_0x4575b3){const _0x3085d3=_0x1b5e35;showConfirmModal(_0x3085d3(0x3fb),_0x3085d3(0x135),async _0x50948a=>{const _0x5c9c43=_0x3085d3;if(!_0x50948a)return;const _0x1ee061=getCurrentSubtopic();if(!_0x1ee061||!_0x1ee061['summaries'])return;const _0xac7ba8=[..._0x1ee061['summaries']];_0x1ee061[_0x5c9c43(0x196)]=_0x1ee061['summaries'][_0x5c9c43(0x3b3)](_0x11c8dc=>_0x11c8dc['id']!==_0x4575b3);try{await storageManager[_0x5c9c43(0x17d)]('subtopics',_0x1ee061),renderSummaries(),toast(_0x5c9c43(0x248));}catch(_0x36f2a1){console['error'](_0x5c9c43(0x2e4),_0x36f2a1),_0x1ee061[_0x5c9c43(0x196)]=_0xac7ba8,toast(_0x5c9c43(0xf1));}});}function exportSummary(_0x4e9834){const _0x517558=_0x1b5e35,_0x2f2ca2=new Blob([_0x4e9834[_0x517558(0x263)]],{'type':_0x517558(0x381)}),_0x128878=document[_0x517558(0x2b4)]('a'),_0xf85d19=new Date(_0x4e9834[_0x517558(0x105)]),_0x958604=_0x537d76=>(''+_0x537d76)[_0x517558(0x1f4)](0x2,'0');_0x128878[_0x517558(0x201)]=URL[_0x517558(0x28c)](_0x2f2ca2),_0x128878[_0x517558(0x352)]=_0x517558(0x171)+_0xf85d19[_0x517558(0x1b4)]()+_0x958604(_0xf85d19[_0x517558(0x124)]()+0x1)+_0x958604(_0xf85d19[_0x517558(0x157)]())+'.txt',_0x128878[_0x517558(0x302)](),URL[_0x517558(0x3cd)](_0x128878[_0x517558(0x201)]);}function renderStatsHistory(){const _0xe01eab=_0x1b5e35,_0x51eeae=getCurrentSubtopic(),_0x29acb4=$(_0xe01eab(0x2eb)),_0x199535=$(_0xe01eab(0x3a4)),_0x4d7259=$('#statTasks'),_0x269022=$(_0xe01eab(0x3c4));if(!_0x29acb4||!_0x199535||!_0x4d7259||!_0x269022)return;if(!_0x51eeae){_0x29acb4[_0xe01eab(0x176)]=_0xe01eab(0x3ea),_0x199535[_0xe01eab(0x176)]='0',_0x4d7259[_0xe01eab(0x176)]='0',_0x269022[_0xe01eab(0x33b)]=_0xe01eab(0x410);return;}const _0x4f32f0=_0x51eeae[_0xe01eab(0x1b5)]&&_0x51eeae[_0xe01eab(0x1b5)][_0xe01eab(0x362)]?_0x51eeae['stats'][_0xe01eab(0x362)]:0x0,_0x1c5f91=_0x51eeae[_0xe01eab(0x1b5)]&&_0x51eeae[_0xe01eab(0x1b5)][_0xe01eab(0x321)]?_0x51eeae[_0xe01eab(0x1b5)]['sessionsCompleted']:0x0,_0x5b7068=_0x51eeae['tasks']?_0x51eeae[_0xe01eab(0x3b8)]['filter'](_0x38b06b=>_0x38b06b['isCompleted'])[_0xe01eab(0x1a1)]:0x0;_0x29acb4['textContent']=formatDaysHoursMinutes(_0x4f32f0),_0x199535[_0xe01eab(0x176)]=String(_0x1c5f91),_0x4d7259[_0xe01eab(0x176)]=String(_0x5b7068),_0x269022[_0xe01eab(0x33b)]='';const _0x3f2b1c=Array[_0xe01eab(0x39c)](_0x51eeae['sessions'])?_0x51eeae[_0xe01eab(0x230)]:[];if(_0x3f2b1c[_0xe01eab(0x1a1)]===0x0){_0x269022[_0xe01eab(0x33b)]=_0xe01eab(0x36b);return;}_0x3f2b1c[_0xe01eab(0x378)](_0x4673f7=>{const _0x526892=_0xe01eab,_0x5a7ace=document[_0x526892(0x2b4)](_0x526892(0x340));_0x5a7ace[_0x526892(0x223)]='hist-item';const _0x4758bc=document[_0x526892(0x2b4)]('div'),_0x915964=_0x4673f7[_0x526892(0x361)]?new Date(_0x4673f7[_0x526892(0x361)]):new Date(),_0x488a0=_0x4673f7['durationMinutes']!=null?_0x4673f7[_0x526892(0x1fb)]:_0x4673f7[_0x526892(0x2e7)]||0x0,_0x364f27=_0x526892(0x21a)+_0x915964[_0x526892(0x2ca)]()+_0x526892(0x341)+_0x488a0+_0x526892(0x36a)+(_0x4673f7['mode']||'')+_0x526892(0x164);let _0x532f34='';if(_0x4673f7[_0x526892(0x374)])_0x532f34='<div>'+escapeHTML(_0x4673f7[_0x526892(0x374)])+_0x526892(0x164);else data?.['settings']?.[_0x526892(0x2db)]!==![]&&(_0x532f34=_0x526892(0x348));_0x4758bc[_0x526892(0x33b)]=_0x364f27+_0x532f34,_0x5a7ace[_0x526892(0x376)](_0x4758bc),_0x269022[_0x526892(0x376)](_0x5a7ace);});}function renderGeneralNotes(){const _0x5ea93f=_0x1b5e35,_0x40495b=$('#generalNotesList');if(!_0x40495b)return;const _0x2442bd=getCurrentSubtopic();if(!_0x2442bd){_0x40495b[_0x5ea93f(0x33b)]='<div\x20class=\x22tiny\x22>Vui\x20lòng\x20chọn\x20một\x20chủ\x20đề\x20con.</div>';return;}_0x2442bd[_0x5ea93f(0x1ab)]=_0x2442bd[_0x5ea93f(0x1ab)]||[];if(_0x2442bd[_0x5ea93f(0x1ab)][_0x5ea93f(0x1a1)]===0x0){_0x40495b[_0x5ea93f(0x33b)]=_0x5ea93f(0x200);return;}_0x40495b[_0x5ea93f(0x33b)]='',_0x2442bd[_0x5ea93f(0x1ab)][_0x5ea93f(0x378)](_0x3b4937=>{const _0x17e1b2=_0x5ea93f,_0x4cdcb8=document[_0x17e1b2(0x2b4)](_0x17e1b2(0x340));_0x4cdcb8[_0x17e1b2(0x223)]=_0x17e1b2(0x3bf);const _0x4e5940=document[_0x17e1b2(0x2b4)](_0x17e1b2(0x340));_0x4e5940[_0x17e1b2(0x223)]='note-content',_0x4e5940['textContent']=typeof _0x3b4937===_0x17e1b2(0x17e)?_0x3b4937:_0x3b4937[_0x17e1b2(0x276)]||'';const _0x5b4a12=document['createElement'](_0x17e1b2(0x340));_0x5b4a12[_0x17e1b2(0x223)]='note-meta',_0x5b4a12[_0x17e1b2(0x176)]=_0x3b4937[_0x17e1b2(0x105)]?new Date(_0x3b4937[_0x17e1b2(0x105)])['toLocaleString']():'';const _0x5bb0d7=document[_0x17e1b2(0x2b4)]('div'),_0x2cd4fb=document[_0x17e1b2(0x2b4)](_0x17e1b2(0x2c0));_0x2cd4fb[_0x17e1b2(0x223)]=_0x17e1b2(0x2d9),_0x2cd4fb[_0x17e1b2(0x176)]=_0x17e1b2(0x16c),_0x2cd4fb[_0x17e1b2(0x297)]=async _0x18f424=>{const _0x321ceb=_0x17e1b2;_0x18f424[_0x321ceb(0x187)]();const _0x385b3c=getCurrentSubtopic();if(!_0x385b3c)return;_0x385b3c[_0x321ceb(0x1ab)]=(_0x385b3c[_0x321ceb(0x1ab)]||[])[_0x321ceb(0x3b3)](_0x2d1833=>(_0x2d1833['id']||_0x2d1833)!==(_0x3b4937['id']||_0x3b4937)),await saveData(),renderGeneralNotes();},_0x5bb0d7[_0x17e1b2(0x376)](_0x2cd4fb);const _0x47d4c0=document[_0x17e1b2(0x2b4)](_0x17e1b2(0x340));_0x47d4c0['className']=_0x17e1b2(0x1d6),_0x47d4c0[_0x17e1b2(0x1bd)](_0x4e5940,_0x5b4a12),_0x4cdcb8[_0x17e1b2(0x1bd)](_0x47d4c0,_0x5bb0d7),_0x40495b[_0x17e1b2(0x376)](_0x4cdcb8);});}function renderMethods(){const _0x2da37a=_0x1b5e35,_0xde6b8c=document[_0x2da37a(0x388)](_0x2da37a(0x112));if(!_0xde6b8c)return;_0xde6b8c[_0x2da37a(0x33b)]='';const _0x529953=getCurrentSubtopic();if(!_0x529953){_0xde6b8c[_0x2da37a(0x33b)]=_0x2da37a(0x17f);return;}const _0x27c07c=Array[_0x2da37a(0x39c)](_0x529953[_0x2da37a(0x1de)])?_0x529953[_0x2da37a(0x1de)]:[];if(_0x27c07c[_0x2da37a(0x1a1)]===0x0){_0xde6b8c[_0x2da37a(0x33b)]=_0x2da37a(0x3b6);return;}_0x27c07c[_0x2da37a(0x378)](_0x419065=>{const _0x3a9915=_0x2da37a,_0x49e692=document[_0x3a9915(0x2b4)](_0x3a9915(0x340));_0x49e692[_0x3a9915(0x223)]=_0x3a9915(0x2b7),_0x49e692[_0x3a9915(0xfd)][_0x3a9915(0x30b)]=_0x419065['id'];const _0x3e3aa6=document[_0x3a9915(0x2b4)](_0x3a9915(0x340)),_0x3b6b38=document[_0x3a9915(0x2b4)]('span');_0x3b6b38[_0x3a9915(0x223)]='method-title',_0x3b6b38['textContent']=_0x419065['title']||_0x3a9915(0x315),_0x3b6b38[_0x3a9915(0x2f7)](_0x3a9915(0x302),_0x229f30=>{const _0x1f8afd=_0x3a9915;_0x229f30['preventDefault'](),_0x229f30[_0x1f8afd(0x187)]();const _0x428fad=_0x49e692['querySelector']('.method-content');if(!_0x428fad)return;const _0x4ade95=_0x428fad['hidden'];_0xde6b8c['querySelectorAll'](_0x1f8afd(0x103))['forEach'](_0x5110f8=>{const _0x3aa106=_0x1f8afd;_0x5110f8[_0x3aa106(0x31a)]=!![];}),_0x428fad['hidden']=!_0x4ade95;});const _0x16cc70=document[_0x3a9915(0x2b4)](_0x3a9915(0x340));_0x16cc70[_0x3a9915(0x223)]='topic-actions';const _0x4e9bb0=document[_0x3a9915(0x2b4)](_0x3a9915(0x2c0));_0x4e9bb0[_0x3a9915(0x223)]='btn\x20small\x20ghost\x20method-edit',_0x4e9bb0[_0x3a9915(0x176)]=_0x3a9915(0x18e),_0x4e9bb0[_0x3a9915(0xfd)]['id']=_0x419065['id'];const _0x533fa7=document[_0x3a9915(0x2b4)](_0x3a9915(0x2c0));_0x533fa7[_0x3a9915(0x223)]='btn\x20small\x20danger\x20method-delete',_0x533fa7['textContent']=_0x3a9915(0x16c),_0x533fa7[_0x3a9915(0xfd)]['id']=_0x419065['id'],_0x16cc70[_0x3a9915(0x1bd)](_0x4e9bb0,_0x533fa7),_0x3e3aa6[_0x3a9915(0x1bd)](_0x3b6b38,_0x16cc70);const _0xaf9d6d=document[_0x3a9915(0x2b4)](_0x3a9915(0x340));_0xaf9d6d[_0x3a9915(0x223)]=_0x3a9915(0x31f),_0xaf9d6d[_0x3a9915(0x33b)]=_0x419065[_0x3a9915(0x263)]||'',_0xaf9d6d['hidden']=!![],_0x49e692[_0x3a9915(0x1bd)](_0x3e3aa6,_0xaf9d6d),_0xde6b8c[_0x3a9915(0x376)](_0x49e692),_0x49e692[_0x3a9915(0x2f7)](_0x3a9915(0x302),_0x342427=>{const _0x15f5ec=_0x3a9915,_0x12d481=_0x342427['target'];if(!_0x12d481)return;if(_0x12d481[_0x15f5ec(0x308)](_0x15f5ec(0x2c0))||_0x12d481[_0x15f5ec(0x308)]('a')||_0x12d481['closest']('.color-picker-wrapper')||_0x12d481[_0x15f5ec(0x308)](_0x15f5ec(0x2c2)))return;const _0xff243d=_0xaf9d6d[_0x15f5ec(0x31a)];_0xde6b8c['querySelectorAll']('.method-item\x20.method-content')['forEach'](_0x42dad3=>{const _0x3ceb7b=_0x15f5ec;_0x42dad3[_0x3ceb7b(0x31a)]=!![];}),_0xaf9d6d[_0x15f5ec(0x31a)]=!_0xff243d;});});const _0x366062=_0xde6b8c[_0x2da37a(0x363)](_0x2da37a(0x180));_0x366062['forEach'](_0x39ddc1=>{_0x39ddc1['addEventListener']('toggle',()=>{const _0x502946=_0x2c31;_0x39ddc1[_0x502946(0xfe)]&&_0x366062[_0x502946(0x378)](_0x546914=>{const _0x2ec912=_0x502946;if(_0x546914!==_0x39ddc1)_0x546914[_0x2ec912(0xfe)]=![];});});}),window[_0x2da37a(0x177)]&&new Sortable(_0xde6b8c,{'animation':0x96,'draggable':_0x2da37a(0x180),'onEnd':async function(_0x3ae527){const _0x683747=_0x2da37a;if(_0x3ae527[_0x683747(0x1cc)]===_0x3ae527[_0x683747(0x1c9)])return;const _0x53265d=getCurrentSubtopic();if(!_0x53265d||!Array['isArray'](_0x53265d[_0x683747(0x1de)]))return;const _0x485c6d=_0x53265d['methods'][_0x683747(0x1fc)](_0x3ae527[_0x683747(0x1cc)],0x1)[0x0];_0x53265d[_0x683747(0x1de)][_0x683747(0x1fc)](_0x3ae527['newIndex'],0x0,_0x485c6d),await saveData();}});}function addGeneralNote(){const _0x1f7934=_0x1b5e35;showInputModal(_0x1f7934(0x1a6),async _0x2d4440=>{const _0x54a4e0=_0x1f7934;if(!_0x2d4440)return;const _0x3c8222=getCurrentSubtopic();if(!_0x3c8222){toast(_0x54a4e0(0x2c3));return;}_0x3c8222['generalNotes']=_0x3c8222['generalNotes']||[],_0x3c8222['generalNotes'][_0x54a4e0(0x246)]({'id':uid('gn'),'text':_0x2d4440,'createdAt':todayISO()}),await saveData(),renderGeneralNotes();},'');}async function summarizeNotes(){const _0x2b138e=_0x1b5e35,_0x14c8cf=getCurrentSubtopic();if(!_0x14c8cf){toast(_0x2b138e(0x2e5));return;}const _0x2b2156=(_0x14c8cf['generalNotes']||[])['map'](_0x321b7a=>typeof _0x321b7a===_0x2b138e(0x17e)?_0x321b7a:_0x321b7a[_0x2b138e(0x276)]||'')['filter'](Boolean);if(_0x2b2156[_0x2b138e(0x1a1)]===0x0){toast(_0x2b138e(0x14f));return;}const _0x324381=$(_0x2b138e(0x23b));_0x324381&&(_0x324381[_0x2b138e(0x16e)]=!![],_0x324381[_0x2b138e(0x33b)]=_0x2b138e(0x2e6));try{const _0x2e95d8=_0x2b138e(0x37c)+_0x2b2156[_0x2b138e(0x345)](_0x2b138e(0x3dd)),_0x29e057=await callGeminiAPI(_0x2e95d8);if(!_0x14c8cf[_0x2b138e(0x196)])_0x14c8cf['summaries']=[];_0x14c8cf[_0x2b138e(0x196)][_0x2b138e(0x246)]({'id':uid('sum'),'content':_0x29e057||_0x2b138e(0x2b0),'createdAt':todayISO()}),await saveData(),renderSummaries();}catch(_0x5e5052){console[_0x2b138e(0x12e)](_0x5e5052),toast(_0x2b138e(0x111));}finally{_0x324381&&(_0x324381['disabled']=![],_0x324381['textContent']=_0x2b138e(0x19f));}}function renderSummaries(){const _0x5ac8f9=_0x1b5e35,_0x30e2b3=$(_0x5ac8f9(0x265));if(!_0x30e2b3)return;const _0x77ca19=getCurrentSubtopic();if(!_0x77ca19){_0x30e2b3['innerHTML']=_0x5ac8f9(0x110);return;}_0x30e2b3[_0x5ac8f9(0x33b)]='';if(!_0x77ca19[_0x5ac8f9(0x196)]||_0x77ca19[_0x5ac8f9(0x196)][_0x5ac8f9(0x1a1)]===0x0){_0x30e2b3[_0x5ac8f9(0x33b)]=_0x5ac8f9(0x385);return;}_0x77ca19['summaries'][_0x5ac8f9(0x378)](_0x356e8f=>{const _0x220b21=_0x5ac8f9,_0x395dac=document[_0x220b21(0x2b4)](_0x220b21(0x340));_0x395dac[_0x220b21(0x223)]=_0x220b21(0x3bf);const _0x257fc9=document[_0x220b21(0x2b4)]('div');_0x257fc9[_0x220b21(0x223)]=_0x220b21(0x1d6);const _0x26395d=document[_0x220b21(0x2b4)](_0x220b21(0x340));_0x26395d[_0x220b21(0x223)]='note-content',_0x26395d['textContent']=_0x356e8f['content'];const _0x51916a=document['createElement'](_0x220b21(0x340));_0x51916a[_0x220b21(0x223)]=_0x220b21(0x3c5),_0x51916a['textContent']=new Date(_0x356e8f[_0x220b21(0x105)])[_0x220b21(0x2ca)](),_0x257fc9['append'](_0x26395d,_0x51916a);const _0x4cb2a5=document[_0x220b21(0x2b4)](_0x220b21(0x340)),_0x207753=document[_0x220b21(0x2b4)](_0x220b21(0x2c0));_0x207753[_0x220b21(0x223)]='btn\x20small',_0x207753[_0x220b21(0x176)]='Xuất',_0x207753[_0x220b21(0x297)]=_0x1fe5cc=>{_0x1fe5cc['stopPropagation'](),exportSummary(_0x356e8f);};const _0x5bc599=document[_0x220b21(0x2b4)](_0x220b21(0x2c0));_0x5bc599['className']=_0x220b21(0x2d9),_0x5bc599[_0x220b21(0x176)]=_0x220b21(0x16c),_0x5bc599[_0x220b21(0x297)]=_0x256520=>{const _0x2e24f2=_0x220b21;_0x256520[_0x2e24f2(0x187)](),deleteSummary(_0x356e8f['id']);},_0x4cb2a5[_0x220b21(0x1bd)](_0x207753,_0x5bc599),_0x395dac[_0x220b21(0x1bd)](_0x257fc9,_0x4cb2a5),_0x395dac[_0x220b21(0x2f7)](_0x220b21(0x302),()=>_0x26395d[_0x220b21(0x299)][_0x220b21(0x1b2)]('expanded')),_0x30e2b3[_0x220b21(0x376)](_0x395dac);});}function loadEditingPresetFields(){const _0x31ff51=_0x1b5e35,_0x31d3b6=data[_0x31ff51(0x241)],_0x1f776a=_0x31d3b6[_0x31ff51(0x11f)],_0x322330=$(_0x31ff51(0x34c)),_0x25d701=$(_0x31ff51(0x34e));if(_0x322330&&_0x25d701){const _0xc1eb8a=editingPreset==='C';_0x322330[_0x31ff51(0x299)][_0x31ff51(0x1b2)](_0x31ff51(0x31a),_0xc1eb8a),_0x25d701['classList']['toggle']('hidden',!_0xc1eb8a);}if(editingPreset==='A'){$(_0x31ff51(0x3ca))[_0x31ff51(0x117)]=_0x1f776a['A_work'];if($('#set_winddown'))$('#set_winddown')[_0x31ff51(0x117)]=_0x1f776a[_0x31ff51(0x3ec)]??0x0;$(_0x31ff51(0x3d7))[_0x31ff51(0x117)]=_0x1f776a['A_short'],$(_0x31ff51(0x295))[_0x31ff51(0x117)]=_0x1f776a[_0x31ff51(0x170)],$(_0x31ff51(0x344))['value']=_0x31d3b6[_0x31ff51(0x16f)],$(_0x31ff51(0x2ad))[_0x31ff51(0x117)]=_0x31d3b6[_0x31ff51(0x1af)];}else{if(editingPreset==='B'){$(_0x31ff51(0x3ca))[_0x31ff51(0x117)]=_0x1f776a['B_work'];if($('#set_winddown'))$('#set_winddown')[_0x31ff51(0x117)]=_0x1f776a['B_winddown']??0x0;$(_0x31ff51(0x3d7))['value']=_0x1f776a[_0x31ff51(0x205)],$(_0x31ff51(0x295))[_0x31ff51(0x117)]=_0x1f776a[_0x31ff51(0x386)],$(_0x31ff51(0x344))[_0x31ff51(0x117)]=_0x31d3b6[_0x31ff51(0x2f5)],$(_0x31ff51(0x2ad))[_0x31ff51(0x117)]=_0x31d3b6['longBreakIntervalB'];}else{if(editingPreset==='C'){const _0x5e8f64=$(_0x31ff51(0x279));if(_0x5e8f64)_0x5e8f64[_0x31ff51(0x117)]=_0x31d3b6[_0x31ff51(0x2fe)]??0x5;}}}}function highlightPresetSelector(){const _0xfa3b5f=_0x1b5e35;$$(_0xfa3b5f(0x26c))[_0xfa3b5f(0x378)](_0x45b156=>{const _0x2f0499=_0xfa3b5f,_0xf71642=_0x45b156[_0x2f0499(0xfd)]['presetTarget']===editingPreset;_0x45b156[_0x2f0499(0x299)][_0x2f0499(0x1b2)](_0x2f0499(0x3b1),_0xf71642),_0x45b156['classList']['toggle'](_0x2f0499(0x203),!_0xf71642);});}function openSettings(){const _0x42f120=_0x1b5e35,_0x46da2f=data[_0x42f120(0x241)];editingPreset=_0x46da2f[_0x42f120(0x3e9)],$(_0x42f120(0x1ff))[_0x42f120(0x117)]=_0x46da2f[_0x42f120(0x3e4)]||'',loadEditingPresetFields(),highlightPresetSelector(),$(_0x42f120(0x3fa))[_0x42f120(0x117)]=_0x46da2f[_0x42f120(0x2cf)]??0.8,$(_0x42f120(0x2f2))['value']=_0x46da2f[_0x42f120(0xf5)]||_0x42f120(0x3ba),$(_0x42f120(0x1cb))[_0x42f120(0x117)]=_0x46da2f[_0x42f120(0x3a1)]||_0x42f120(0x27c);const _0x3413f9=getActiveYoutubeUrl();$('#set_youtubeUrl')[_0x42f120(0x117)]=_0x3413f9||'';const _0xda3b01=extractYouTubeID(_0x3413f9);$(_0x42f120(0x2e8))[_0x42f120(0x16e)]=!_0xda3b01;$(_0x42f120(0x209))&&($(_0x42f120(0x209))[_0x42f120(0x176)]='');$(_0x42f120(0x3bd))['value']=_0x46da2f[_0x42f120(0x3ef)]||0x50,$(_0x42f120(0x393))[_0x42f120(0x19c)]=!!_0x46da2f[_0x42f120(0x310)],$('#set_panelOpacity')[_0x42f120(0x117)]=_0x46da2f[_0x42f120(0x2ed)]||0.85;$(_0x42f120(0x317))&&($(_0x42f120(0x317))['value']=_0x46da2f[_0x42f120(0x3d3)]||'cover');$(_0x42f120(0x20f))&&($(_0x42f120(0x20f))[_0x42f120(0x19c)]=!!_0x46da2f[_0x42f120(0x20c)]);$(_0x42f120(0x20e))&&($('#set_enableWinddown')[_0x42f120(0x19c)]=_0x46da2f[_0x42f120(0x3e6)]!==![]);$(_0x42f120(0x351))&&($('#set_enableSessionNotes')['checked']=_0x46da2f[_0x42f120(0x2db)]!==![]);$(_0x42f120(0x2a0))&&($('#set_backupDays')[_0x42f120(0x117)]=_0x46da2f[_0x42f120(0x28d)]||0x7);const _0x2298c9=$(_0x42f120(0x234));_0x2298c9&&storageManager[_0x42f120(0xf2)]()[_0x42f120(0x1b6)](_0x290669=>{const _0x33c032=_0x42f120;_0x2298c9[_0x33c032(0x33b)]='<option\x20value=\x22\x22>--\x20Chọn\x20ngày\x20để\x20phục\x20hồi\x20--</option>',_0x290669&&_0x290669[_0x33c032(0x1a1)]>0x0?_0x290669[_0x33c032(0x378)](_0x582c49=>{const _0x34c3dd=_0x33c032,_0x100cf0=document['createElement'](_0x34c3dd(0x274));_0x100cf0[_0x34c3dd(0x117)]=_0x582c49[_0x34c3dd(0x145)],_0x100cf0[_0x34c3dd(0x176)]=_0x34c3dd(0x2cc)+new Date(_0x582c49['date'])[_0x34c3dd(0xff)](_0x34c3dd(0x30a)),_0x2298c9[_0x34c3dd(0x376)](_0x100cf0);}):_0x2298c9['innerHTML']=_0x33c032(0x139);});$(_0x42f120(0x181))['classList'][_0x42f120(0x11e)](_0x42f120(0x1ba));try{trapFocus($('#modalSettings'));}catch(_0x29e2e9){}}function closeSettings(){const _0x460e52=_0x1b5e35;$('#modalSettings')[_0x460e52(0x299)]['remove']('show');try{releaseFocus();}catch(_0xeae51d){}}async function setDefaults(){const _0x14c099=_0x1b5e35;data[_0x14c099(0x241)][_0x14c099(0x11f)]={'A_work':0x19,'A_short':0x5,'A_long':0xf,'A_winddown':0x2,'B_work':0x32,'B_short':0xa,'B_long':0x1e,'B_winddown':0x5},data['settings']['cyclesA']=0x4,data['settings'][_0x14c099(0x1af)]=0x4,data[_0x14c099(0x241)][_0x14c099(0x2f5)]=0x4,data['settings'][_0x14c099(0x270)]=0x4,data[_0x14c099(0x241)][_0x14c099(0x2fe)]=0x5,data['settings'][_0x14c099(0x3e9)]='A',data[_0x14c099(0x241)][_0x14c099(0x2cf)]=0.8,data[_0x14c099(0x241)][_0x14c099(0xf5)]='beep',await saveData(),openSettings(),toast(_0x14c099(0x3df));}async function saveSettings(){const _0x574339=_0x1b5e35,_0x2a7911=data[_0x574339(0x241)];_0x2a7911[_0x574339(0x3e4)]=$('#set_apiKey')['value'][_0x574339(0x287)]();const _0x4cf001=_0x2a7911[_0x574339(0x11f)];if(editingPreset==='A')_0x4cf001[_0x574339(0x39a)]=clampInt($(_0x574339(0x3ca))[_0x574339(0x117)],0x1,0x3e7),_0x4cf001[_0x574339(0x3ec)]=clampInt($(_0x574339(0x1ea))[_0x574339(0x117)],0x0,0x3e7),_0x4cf001['A_short']=clampInt($(_0x574339(0x3d7))['value'],0x1,0x3e7),_0x4cf001[_0x574339(0x170)]=clampInt($(_0x574339(0x295))[_0x574339(0x117)],0x1,0x3e7),_0x2a7911['cyclesA']=clampInt($('#set_cycles')[_0x574339(0x117)],0x1,0xc),_0x2a7911[_0x574339(0x1af)]=clampInt($(_0x574339(0x2ad))[_0x574339(0x117)],0x2,0xc);else{if(editingPreset==='B')_0x4cf001[_0x574339(0x398)]=clampInt($(_0x574339(0x3ca))[_0x574339(0x117)],0x1,0x3e7),_0x4cf001[_0x574339(0x2bd)]=clampInt($(_0x574339(0x1ea))[_0x574339(0x117)],0x0,0x3e7),_0x4cf001[_0x574339(0x205)]=clampInt($(_0x574339(0x3d7))[_0x574339(0x117)],0x1,0x3e7),_0x4cf001[_0x574339(0x386)]=clampInt($(_0x574339(0x295))['value'],0x1,0x3e7),_0x2a7911[_0x574339(0x2f5)]=clampInt($('#set_cycles')[_0x574339(0x117)],0x1,0xc),_0x2a7911['longBreakIntervalB']=clampInt($(_0x574339(0x2ad))[_0x574339(0x117)],0x2,0xc);else{if(editingPreset==='C'){const _0xbb5e08=$(_0x574339(0x279));if(_0xbb5e08)_0x2a7911[_0x574339(0x2fe)]=clampInt(_0xbb5e08[_0x574339(0x117)],0x1,0x14);}}}_0x2a7911['volume']=clampFloat($(_0x574339(0x3fa))['value'],0x0,0x1,0.8),_0x2a7911['soundTheme']=$('#set_theme')[_0x574339(0x117)]===_0x574339(0x35c)?_0x574339(0x35c):_0x574339(0x3ba),_0x2a7911['theme']=$('#set_theme_color')[_0x574339(0x117)],_0x2a7911[_0x574339(0x2ed)]=parseFloat($(_0x574339(0x14a))[_0x574339(0x117)])||0.85;$('#set_backgroundMode')&&(_0x2a7911[_0x574339(0x3d3)]=$(_0x574339(0x317))[_0x574339(0x117)]);_0x2a7911[_0x574339(0x20c)]=!!($(_0x574339(0x20f))&&$('#set_autoStartNext')[_0x574339(0x19c)]),_0x2a7911[_0x574339(0x3e6)]=!!($(_0x574339(0x20e))&&$(_0x574339(0x20e))[_0x574339(0x19c)]),_0x2a7911['enableSessionNotes']=!!($(_0x574339(0x351))&&$(_0x574339(0x351))[_0x574339(0x19c)]);$(_0x574339(0x2a0))&&(_0x2a7911['backupDaysToKeep']=clampInt($(_0x574339(0x2a0))[_0x574339(0x117)],0x1,0x1e));_0x2a7911['theme']===_0x574339(0x141)||_0x2a7911[_0x574339(0x3a1)]===_0x574339(0x2c1)?(_0x2a7911[_0x574339(0x310)]=![],typeof _0x2a7911['customBg']===_0x574339(0x17e)&&_0x2a7911[_0x574339(0x3f7)]['includes'](_0x574339(0x1d0))&&(_0x2a7911[_0x574339(0x3f7)]='')):_0x2a7911[_0x574339(0x310)]=!![];const _0x4230a4=$('#set_youtubeUrl')[_0x574339(0x117)][_0x574339(0x287)]();_0x2a7911[_0x574339(0x310)]=$(_0x574339(0x393))[_0x574339(0x19c)],_0x2a7911[_0x574339(0x3ef)]=parseInt($(_0x574339(0x3bd))[_0x574339(0x117)],0xa),sessionYoutubeUrl=_0x4230a4;try{if(!IS_FILE_PROTOCOL){if(ytPlayer&&ytPlayer['setVolume'])ytPlayer[_0x574339(0x1a0)](_0x2a7911['youtubeVolume']);}else try{fallbackPostMessage('setVolume',[_0x2a7911['youtubeVolume']]);}catch(_0x37dbcb){}}catch(_0x34ae69){}await saveData(),applyTheme(),applyCustomBg(),applyPanelOpacity(),updatePresetButtonsText(),timer[_0x574339(0x225)](_0x2a7911[_0x574339(0x3e9)],{'silent':!![]}),closeSettings(),toast(_0x574339(0x36d));}function clampInt(_0x6baa99,_0x2e08c0,_0x16b366){const _0x4c3c58=_0x1b5e35;_0x6baa99=parseInt(_0x6baa99||0x0,0xa);if(isNaN(_0x6baa99))_0x6baa99=_0x2e08c0;return Math[_0x4c3c58(0x228)](_0x2e08c0,Math[_0x4c3c58(0x307)](_0x16b366,_0x6baa99));}function clampFloat(_0x15d66d,_0x3f0617,_0x4287b6,_0xcece4a){const _0x5eeabb=_0x1b5e35;_0x15d66d=parseFloat(_0x15d66d);if(Number[_0x5eeabb(0x172)](_0x15d66d))_0x15d66d=_0xcece4a;return Math[_0x5eeabb(0x228)](_0x3f0617,Math[_0x5eeabb(0x307)](_0x4287b6,_0x15d66d));}const dbPromise=new Promise((_0x4fb257,_0x397df9)=>{const _0x113d4d=_0x1b5e35,_0x234b1c=indexedDB[_0x113d4d(0xfe)](_0x113d4d(0x2b2),0x1);_0x234b1c['onupgradeneeded']=_0x423a5f=>_0x423a5f[_0x113d4d(0x1e7)][_0x113d4d(0x236)][_0x113d4d(0x2ff)]('files'),_0x234b1c[_0x113d4d(0x24c)]=_0x3eb8f7=>_0x4fb257(_0x3eb8f7[_0x113d4d(0x1e7)][_0x113d4d(0x236)]),_0x234b1c[_0x113d4d(0x247)]=_0x3707c3=>_0x397df9(_0x3707c3);}),fileCache={};function handleFileUpload(_0x34af6c,_0x5be6d5){const _0x5c3dc3=_0x1b5e35;if(!_0x34af6c)return;dbPromise[_0x5c3dc3(0x1b6)](_0x1ae496=>{const _0x3f50a9=_0x5c3dc3,_0xc14c20=uid('file'),_0x1de745=_0x1ae496['transaction'](_0x3f50a9(0x25e),_0x3f50a9(0x28a));_0x1de745[_0x3f50a9(0x30d)](_0x3f50a9(0x25e))[_0x3f50a9(0x215)](_0x34af6c,_0xc14c20),_0x1de745['oncomplete']=()=>_0x5be6d5(_0xc14c20),_0x1de745[_0x3f50a9(0x247)]=()=>toast('Lỗi\x20lưu\x20file.');});}function getStoredFileUrl(_0x1cbfc2){const _0x3fa3b9=_0x1b5e35;if(!_0x1cbfc2)return Promise[_0x3fa3b9(0x22e)]('');if(fileCache[_0x1cbfc2])return Promise[_0x3fa3b9(0x22e)](fileCache[_0x1cbfc2]);return dbPromise[_0x3fa3b9(0x1b6)](_0x17c4ac=>new Promise(_0x4213a6=>{const _0x10ed8a=_0x3fa3b9,_0x18552c=_0x17c4ac['transaction'](_0x10ed8a(0x25e),_0x10ed8a(0x316)),_0xd36c3e=_0x18552c[_0x10ed8a(0x30d)](_0x10ed8a(0x25e))['get'](_0x1cbfc2);_0xd36c3e[_0x10ed8a(0x24c)]=_0x393de4=>{const _0x233e2d=_0x10ed8a,_0xe545d=_0x393de4[_0x233e2d(0x1e7)][_0x233e2d(0x236)];if(_0xe545d){const _0x365380=URL['createObjectURL'](_0xe545d);fileCache[_0x1cbfc2]=_0x365380,_0x4213a6(_0x365380);}else _0x4213a6('');},_0xd36c3e[_0x10ed8a(0x247)]=()=>_0x4213a6('');}));}function applyCustomBg(){const _0x4bcd95=_0x1b5e35,_0xb9b165=data['settings'],_0x25fb6e=_0xb9b165['customBg'],_0x226219=_0xb9b165['theme'],_0x2802b8=[_0x4bcd95(0x29a),_0x4bcd95(0x24a)]['includes'](_0x226219),_0x534810=_0x226219===_0x4bcd95(0x141)||_0x226219==='pastel',_0x5ce94c=_0xb9b165[_0x4bcd95(0x3d3)]||_0x4bcd95(0x192);document[_0x4bcd95(0xfa)][_0x4bcd95(0x300)][_0x4bcd95(0x1b0)]=_0x5ce94c,document[_0x4bcd95(0xfa)][_0x4bcd95(0x300)]['backgroundRepeat']=_0x5ce94c===_0x4bcd95(0x1cf)?_0x4bcd95(0x18c):'no-repeat';const _0x290a7f=()=>{const _0x1e89ba=_0x4bcd95;try{document[_0x1e89ba(0xfa)]['style']['backgroundImage']='';}catch(_0x1c577d){}};if(_0x25fb6e){const _0x3d7c84=_0x25fb6e[_0x4bcd95(0x24e)](_0x4bcd95(0x30f))||_0x25fb6e[_0x4bcd95(0x24e)](_0x4bcd95(0x1f7))||_0x25fb6e[_0x4bcd95(0x24e)](_0x4bcd95(0x2e3))?Promise[_0x4bcd95(0x22e)](_0x25fb6e):getStoredFileUrl(_0x25fb6e);_0x3d7c84[_0x4bcd95(0x1b6)](_0x18fcd2=>{const _0x20bc86=_0x4bcd95;_0x18fcd2?document[_0x20bc86(0xfa)][_0x20bc86(0x300)][_0x20bc86(0x18b)](_0x20bc86(0x1ec),_0x20bc86(0x1f6)+_0x18fcd2+')'):document['body'][_0x20bc86(0x300)][_0x20bc86(0x18b)](_0x20bc86(0x1ec),_0x534810?_0x20bc86(0x13b):''),_0x290a7f();});}else!_0x2802b8?_0x534810?(document[_0x4bcd95(0xfa)]['style']['setProperty'](_0x4bcd95(0x1ec),'none'),_0x290a7f()):document[_0x4bcd95(0xfa)]['style']['setProperty'](_0x4bcd95(0x1ec),_0x4bcd95(0x2d7)):(document[_0x4bcd95(0xfa)]['style']['removeProperty'](_0x4bcd95(0x1ec)),_0x290a7f());}function applyPanelOpacity(){const _0x3df4b9=_0x1b5e35;document[_0x3df4b9(0x338)][_0x3df4b9(0x300)][_0x3df4b9(0x18b)](_0x3df4b9(0x16d),data[_0x3df4b9(0x241)]['panelOpacity']);}function renderDashboard(){const _0xea7417=_0x1b5e35,_0x3da3ac=data['topics']['flatMap'](_0xed3f40=>_0xed3f40['subtopics'][_0xea7417(0x137)](_0x3659dd=>({'topic':_0xed3f40[_0xea7417(0x359)],'subtopic':_0x3659dd[_0xea7417(0x359)],'m':_0x3659dd['stats'][_0xea7417(0x362)]||0x0,'c':_0x3659dd[_0xea7417(0x1b5)][_0xea7417(0x321)]||0x0,'t':_0x3659dd['stats'][_0xea7417(0x304)]||0x0}))),_0x515b29=_0x3da3ac['reduce']((_0x2682ce,_0x544cae)=>_0x2682ce+_0x544cae['m'],0x0),_0x1c27a7=_0x3da3ac[_0xea7417(0x126)]((_0x955410,_0x59a451)=>_0x955410+_0x59a451['c'],0x0),_0x51b2de=_0x3da3ac[_0xea7417(0x126)]((_0x1f59c4,_0x296b9e)=>_0x1f59c4+_0x296b9e['t'],0x0);let _0x5d1108=_0xea7417(0x284)+formatDaysHoursMinutes(_0x515b29)+_0xea7417(0x40d)+_0x1c27a7+_0xea7417(0x2ce)+_0x51b2de+_0xea7417(0x38a);_0x3da3ac[_0xea7417(0x378)](_0x5813aa=>{const _0x19e8ef=_0xea7417;_0x5d1108+=_0x19e8ef(0x2a3)+escapeHTML(_0x5813aa[_0x19e8ef(0x22f)])+'</td><td>'+escapeHTML(_0x5813aa[_0x19e8ef(0x35e)])+_0x19e8ef(0x38f)+formatDaysHoursMinutes(_0x5813aa['m'])+_0x19e8ef(0x38f)+_0x5813aa['c']+_0x19e8ef(0x38f)+_0x5813aa['t']+'</td></tr>';}),_0x5d1108+=_0xea7417(0x38e);const _0x3be5f0=$(_0xea7417(0x1c5));if(_0x3be5f0)_0x3be5f0[_0xea7417(0x33b)]=_0x5d1108;}function getMilestones(){const _0x4b2ab1=_0x1b5e35;return[{'hours':0x5,'title':'Gửi\x20bạn,\x205\x20giờ\x20đầu\x20tiên\x20(Khởi\x20động)','message':_0x4b2ab1(0x15b)},{'hours':0x14,'title':_0x4b2ab1(0x293),'message':_0x4b2ab1(0x1e5)},{'hours':0x32,'title':_0x4b2ab1(0x13f),'message':_0x4b2ab1(0x1c4)},{'hours':0x64,'title':_0x4b2ab1(0x14d),'message':_0x4b2ab1(0x35a)},{'hours':0xfa,'title':_0x4b2ab1(0x2ec),'message':_0x4b2ab1(0x3ed)},{'hours':0x1f4,'title':_0x4b2ab1(0x219),'message':'Nửa\x20nghìn\x20giờ\x20tập\x20trung.\x20Bạn\x20đã\x20dành\x20một\x20khoảng\x20thời\x20gian\x20đáng\x20kể\x20để\x20theo\x20đuổi\x20điều\x20quan\x20trọng\x20với\x20mình.\x20Mức\x20độ\x20chuyên\x20tâm\x20này\x20chắc\x20chắn\x20đang\x20tạo\x20ra\x20những\x20kết\x20quả\x20sâu\x20sắc\x20và\x20khác\x20biệt.\x20Thật\x20đáng\x20ngưỡng\x20mộ.'},{'hours':0x3e8,'title':_0x4b2ab1(0x116),'message':_0x4b2ab1(0x13e)},{'hours':0x1388,'title':_0x4b2ab1(0x256),'message':_0x4b2ab1(0x2c9)}][_0x4b2ab1(0x109)]((_0x50538b,_0x698bc7)=>_0x698bc7[_0x4b2ab1(0x1c7)]-_0x50538b[_0x4b2ab1(0x1c7)]);}async function checkAndShowMilestones(){const _0x5c49aa=_0x1b5e35;if(!data||!data[_0x5c49aa(0x241)])return;if(!Array[_0x5c49aa(0x39c)](data[_0x5c49aa(0x241)][_0x5c49aa(0x288)]))data[_0x5c49aa(0x241)][_0x5c49aa(0x288)]=[];const _0x584e5c=data[_0x5c49aa(0x28e)]['reduce']((_0x5da07c,_0x3404a3)=>{const _0x4bde88=_0x5c49aa;return _0x5da07c+_0x3404a3[_0x4bde88(0x2d5)][_0x4bde88(0x126)]((_0x2c3a2a,_0x264395)=>{const _0x92ec38=_0x4bde88;return _0x2c3a2a+(_0x264395[_0x92ec38(0x1b5)][_0x92ec38(0x362)]||0x0);},0x0);},0x0),_0x2a2fa8=_0x584e5c/0x3c,_0xc26b2f=getMilestones(),_0x35c70e=Array[_0x5c49aa(0x39c)](data[_0x5c49aa(0x241)][_0x5c49aa(0x288)])?data[_0x5c49aa(0x241)][_0x5c49aa(0x288)]:[],_0x164a24=_0xc26b2f[_0x5c49aa(0x3b3)](_0x104865=>_0x2a2fa8>=_0x104865[_0x5c49aa(0x1c7)]&&!_0x35c70e['includes'](_0x104865[_0x5c49aa(0x1c7)]));if(_0x164a24[_0x5c49aa(0x1a1)]===0x0)return![];const _0x304aa7=_0x164a24['reduce']((_0x1deaec,_0x342388)=>_0x1deaec&&_0x1deaec[_0x5c49aa(0x1c7)]>_0x342388[_0x5c49aa(0x1c7)]?_0x1deaec:_0x342388,null);if(!_0x304aa7)return![];$(_0x5c49aa(0x237))[_0x5c49aa(0x176)]=_0x304aa7[_0x5c49aa(0x32c)],$(_0x5c49aa(0x2e9))[_0x5c49aa(0x176)]=_0x304aa7[_0x5c49aa(0x1a2)],$(_0x5c49aa(0x3f1))[_0x5c49aa(0x299)][_0x5c49aa(0x11e)](_0x5c49aa(0x1ba));try{trapFocus($(_0x5c49aa(0x3f1)));}catch(_0x3f1694){}return data[_0x5c49aa(0x241)][_0x5c49aa(0x288)][_0x5c49aa(0x134)](_0x304aa7[_0x5c49aa(0x1c7)]),await saveData(),!![];}async function seedAchievedMilestones(){const _0x4c41a4=_0x1b5e35;if(!data||!data['settings'])return;!Array['isArray'](data[_0x4c41a4(0x241)][_0x4c41a4(0x288)])&&(data[_0x4c41a4(0x241)][_0x4c41a4(0x288)]=[],await saveData());}async function handleSendMessage(){const _0x102725=_0x1b5e35,_0x14bcb7=$('#btnSendMessage'),_0x2350e3=$(_0x102725(0x3e8)),_0x1b72c9=_0x2350e3[_0x102725(0x117)][_0x102725(0x287)](),_0x532d60=getCurrentSubtopic();if(!_0x1b72c9)return;if(!_0x532d60){toast(t(_0x102725(0x402)));return;}_0x2350e3[_0x102725(0x117)]='',_0x14bcb7[_0x102725(0x16e)]=!![],_0x14bcb7[_0x102725(0x33b)]=_0x102725(0x2e6),_0x532d60[_0x102725(0x108)][_0x102725(0x134)]({'role':_0x102725(0x38b),'text':_0x1b72c9}),renderChat();const _0x10696b=await callGeminiAPI(_0x1b72c9);_0x10696b&&(_0x532d60[_0x102725(0x108)][_0x102725(0x134)]({'role':_0x102725(0x2c4),'text':_0x10696b}),await saveData(),renderChat()),_0x14bcb7['disabled']=![],_0x14bcb7['innerHTML']=_0x102725(0x191);}function renderChat(){const _0x325267=_0x1b5e35,_0x52a0f9=getCurrentSubtopic(),_0x9479bc=$('#chatMessages'),_0x51ea39=$(_0x325267(0x3e8)),_0x36bd9a=$(_0x325267(0x20a));if(!_0x9479bc||!_0x51ea39||!_0x36bd9a)return;if(!_0x52a0f9){_0x9479bc[_0x325267(0x33b)]=_0x325267(0x251),_0x51ea39['disabled']=!![],_0x36bd9a[_0x325267(0x16e)]=!![];return;}_0x51ea39[_0x325267(0x16e)]=![],_0x36bd9a[_0x325267(0x16e)]=![],_0x9479bc['innerHTML']='';if(!_0x52a0f9[_0x325267(0x108)]||_0x52a0f9[_0x325267(0x108)][_0x325267(0x1a1)]===0x0){_0x9479bc[_0x325267(0x33b)]=_0x325267(0x1e4);return;}_0x52a0f9['chatHistory']['forEach'](_0x3efdbc=>{const _0x2e60b=_0x325267,_0x483ce8=document[_0x2e60b(0x2b4)](_0x2e60b(0x340));_0x483ce8['className']='chat-msg\x20'+_0x3efdbc[_0x2e60b(0x2d2)],_0x483ce8[_0x2e60b(0x176)]=_0x3efdbc[_0x2e60b(0x276)],_0x9479bc[_0x2e60b(0x376)](_0x483ce8);}),_0x9479bc[_0x325267(0x16a)]=_0x9479bc[_0x325267(0x32e)];}async function handleSummarizeNote(){const _0x48388f=_0x1b5e35,_0x3e9ff2=$('#btnSummarizeNote'),_0x285c79=$(_0x48388f(0x156)),_0x1c3b0e=_0x285c79['value'][_0x48388f(0x287)](),_0x142c31=getCurrentSubtopic();if(!_0x1c3b0e){toast('Vui\x20lòng\x20nhập\x20ghi\x20chú\x20trước\x20khi\x20tóm\x20tắt.');return;}const _0x2ecb1e=_0x3e9ff2[_0x48388f(0x33b)];_0x3e9ff2['innerHTML']='<div\x20class=\x22spinner\x22></div>',_0x3e9ff2[_0x48388f(0x16e)]=!![];const _0x37f247=_0x48388f(0x1cd)+(_0x142c31?.[_0x48388f(0x359)]||'không\x20rõ')+'\x22\x0a-\x20Ghi\x20chú\x20của\x20người\x20dùng\x20sau\x20một\x20phiên\x20làm\x20việc:\x20\x22'+_0x1c3b0e+_0x48388f(0x2a7),_0x526ea8=await callGeminiAPI(_0x37f247);_0x526ea8&&(_0x285c79[_0x48388f(0x117)]+='\x0a\x0a'+_0x526ea8),_0x3e9ff2[_0x48388f(0x33b)]=_0x2ecb1e,_0x3e9ff2[_0x48388f(0x16e)]=![];}function clearChat(){const _0x148ac3=_0x1b5e35,_0x2292db=getCurrentSubtopic();if(!_0x2292db){toast(t(_0x148ac3(0x402)));return;}showConfirmModal(_0x148ac3(0x3fb),_0x148ac3(0x1e3),async _0x5a28cc=>{const _0x2f4f87=_0x148ac3;_0x5a28cc&&(_0x2292db['chatHistory']=[],await saveData(),renderChat(),toast(_0x2f4f87(0x3c2)));});}let ytPlayer,ytUserPaused=![],ytFallbackFrame=null,ytFallbackIsPlaying=![];function buildFallbackSrc(_0x2b7022,{autoplay:autoplay=0x1,mute:mute=0x1}={}){const _0x57b817=_0x1b5e35,_0x42ff04=new URLSearchParams({'autoplay':String(autoplay),'mute':String(mute),'controls':'0','playsinline':'1','loop':'1','playlist':_0x2b7022,'enablejsapi':'1','origin':_0x57b817(0x104)})['toString']();return _0x57b817(0x267)+_0x2b7022+'?'+_0x42ff04;}function ensureFallbackFrame(){const _0x4247e3=_0x1b5e35,_0x161ae1=document[_0x4247e3(0x262)](_0x4247e3(0x1d7));if(!_0x161ae1)return null;if(ytFallbackFrame&&ytFallbackFrame[_0x4247e3(0x1b7)])return ytFallbackFrame;const _0x51afc2=document[_0x4247e3(0x2b4)](_0x4247e3(0x17a));return _0x51afc2['id']=_0x4247e3(0x40f),_0x51afc2[_0x4247e3(0x142)]='1',_0x51afc2[_0x4247e3(0x255)]='1',_0x51afc2[_0x4247e3(0x300)][_0x4247e3(0x258)]=_0x4247e3(0x221),_0x51afc2[_0x4247e3(0x300)][_0x4247e3(0x1f2)]=_0x4247e3(0x1a7),_0x51afc2[_0x4247e3(0x300)][_0x4247e3(0x118)]=_0x4247e3(0x1a7),_0x51afc2[_0x4247e3(0x290)]=_0x4247e3(0x159),_0x161ae1[_0x4247e3(0x33b)]='',_0x161ae1[_0x4247e3(0x376)](_0x51afc2),ytFallbackFrame=_0x51afc2,_0x51afc2;}function fallbackLoadVideo(_0x507a7d,{autoplay:autoplay=0x1,mute:mute=0x1}={}){const _0x51ef0c=_0x1b5e35,_0x170f96=document['getElementById'](_0x51ef0c(0x1d7));if(!_0x170f96)return;_0x170f96[_0x51ef0c(0x33b)]='';const _0x5a6864=document['createElement'](_0x51ef0c(0x17a));_0x5a6864['id']=_0x51ef0c(0x40f),_0x5a6864[_0x51ef0c(0x142)]='1',_0x5a6864['height']='1',_0x5a6864['style']['position']=_0x51ef0c(0x221),_0x5a6864[_0x51ef0c(0x300)][_0x51ef0c(0x1f2)]='-9999px',_0x5a6864[_0x51ef0c(0x300)][_0x51ef0c(0x118)]=_0x51ef0c(0x1a7),_0x5a6864[_0x51ef0c(0x290)]=_0x51ef0c(0x159),_0x5a6864[_0x51ef0c(0x325)]=buildFallbackSrc(_0x507a7d,{'autoplay':autoplay,'mute':mute}),_0x170f96[_0x51ef0c(0x376)](_0x5a6864),ytFallbackFrame=_0x5a6864,ytFallbackIsPlaying=!!autoplay;try{const _0x725760=document[_0x51ef0c(0x262)](_0x51ef0c(0x1f0));if(_0x725760)_0x725760[_0x51ef0c(0x176)]=ytFallbackIsPlaying?'⏸️':'▶';}catch(_0x38b515){}}function fallbackPostMessage(_0x56a502,_0x4dc32e=[]){const _0x331323=_0x1b5e35;try{if(!ytFallbackFrame||!ytFallbackFrame['contentWindow'])return;ytFallbackFrame[_0x331323(0x3a8)]['postMessage'](JSON[_0x331323(0x1ac)]({'event':_0x331323(0x320),'func':_0x56a502,'args':_0x4dc32e}),'https://www.youtube.com');}catch(_0x142087){}}function fallbackPlay(){const _0x5e2fe3=_0x1b5e35;fallbackPostMessage(_0x5e2fe3(0x244));}function fallbackStop(){const _0x4c6eaf=_0x1b5e35;try{ytFallbackFrame&&(ytFallbackFrame[_0x4c6eaf(0x325)]=_0x4c6eaf(0x1fe),ytFallbackIsPlaying=![]);}catch(_0x27a424){}}function fallbackPause(){fallbackStop();}function fallbackUnMute(){const _0xc0cda4=_0x1b5e35;fallbackPostMessage(_0xc0cda4(0x354));}function fallbackMute(){const _0x572a96=_0x1b5e35;fallbackPostMessage(_0x572a96(0x168));}window[_0x1b5e35(0x3ab)]=function(){const _0x428536=_0x1b5e35;if(IS_FILE_PROTOCOL){try{window[_0x428536(0x204)]&&window['__ytApiWatchdog'][_0x428536(0x401)]();}catch(_0x1cdcb3){}return;}const _0x3fa811={'height':'1','width':'1','playerVars':{'autoplay':0x0,'controls':0x0,'playsinline':0x1},'events':{'onReady':onPlayerReady,'onStateChange':onPlayerStateChange},'host':_0x428536(0x104)};(window[_0x428536(0x15f)][_0x428536(0x3fe)]===_0x428536(0x3e7)||window['location'][_0x428536(0x3fe)]==='https:')&&(_0x3fa811[_0x428536(0x11b)]=window[_0x428536(0x15f)][_0x428536(0x11b)]);ytPlayer=new YT[(_0x428536(0x208))](_0x428536(0x1d7),_0x3fa811);try{window[_0x428536(0x204)]&&window[_0x428536(0x204)][_0x428536(0x401)]();const _0x1f644c=document['getElementById'](_0x428536(0x1c2));_0x1f644c&&(_0x1f644c['textContent']='');}catch(_0x5464c9){}};let _ytPrimed=![],_ytUnlocked=![];try{_ytUnlocked=localStorage[_0x1b5e35(0x178)](_0x1b5e35(0x189))==='1';}catch(_0x2184f6){}function showSoundPermission(){const _0x2e5f78=_0x1b5e35,_0x27e610=document[_0x2e5f78(0x262)](_0x2e5f78(0x29c));if(!_0x27e610)return;if(_ytUnlocked){_0x27e610[_0x2e5f78(0x299)][_0x2e5f78(0x289)](_0x2e5f78(0x1ba));return;}_0x27e610[_0x2e5f78(0x299)]['add'](_0x2e5f78(0x1ba));}function hideSoundPermission(){const _0x128aa2=_0x1b5e35,_0x577157=document['getElementById']('soundPermissionBar');if(!_0x577157)return;_0x577157['classList']['remove'](_0x128aa2(0x1ba));}function unlockAudioChain(){const _0x22e452=_0x1b5e35;try{if(AUDIO_CTX&&typeof AUDIO_CTX[_0x22e452(0x39b)]===_0x22e452(0xf3))AUDIO_CTX['resume']();}catch(_0x4468eb){}try{if(IS_FILE_PROTOCOL)fallbackUnMute(),fallbackPlay();else ytPlayer&&ytPlayer[_0x22e452(0x354)]&&(ytPlayer[_0x22e452(0x354)](),ytPlayer[_0x22e452(0x244)]());}catch(_0x52fcae){}_ytUnlocked=!![];try{localStorage[_0x22e452(0x2c6)](_0x22e452(0x189),'1');}catch(_0x35495c){}hideSoundPermission(),toast(_0x22e452(0x1d9));}function onPlayerReady(_0x2cfd5d){const _0x435c22=_0x1b5e35;try{const _0xe779eb=ytPlayer&&ytPlayer['getIframe']?ytPlayer[_0x435c22(0x311)]():null;_0xe779eb&&_0xe779eb['setAttribute']('allow',_0x435c22(0x159));}catch(_0x1cc8c8){}try{if(ytPlayer&&ytPlayer[_0x435c22(0x1a0)])ytPlayer[_0x435c22(0x1a0)](data&&data['settings']&&data[_0x435c22(0x241)]['youtubeVolume']||0x50);}catch(_0x1d59d5){}try{const _0x32e3b2=getActiveVideoId&&getActiveVideoId();if(_0x32e3b2&&ytPlayer&&ytPlayer[_0x435c22(0x168)]&&ytPlayer[_0x435c22(0x244)]){ytPlayer[_0x435c22(0x168)](),ytPlayer['playVideo'](),_ytPrimed=!![];const _0x5f01d7=()=>{const _0x277dc9=_0x435c22;if(_ytUnlocked)return;try{unlockAudioChain();}catch(_0x32fb84){}window[_0x277dc9(0x3f4)](_0x277dc9(0x3b0),_0x5f01d7,!![]),window[_0x277dc9(0x3f4)](_0x277dc9(0x131),_0x5f01d7,!![]);};window[_0x435c22(0x2f7)]('pointerdown',_0x5f01d7,!![]),window[_0x435c22(0x2f7)](_0x435c22(0x131),_0x5f01d7,!![]),showSoundPermission();}}catch(_0x4a0f4f){}updateYouTubePlayer();}function onPlayerStateChange(_0x3d5a99){const _0x3a453d=_0x1b5e35,_0x311713=$(_0x3a453d(0x2e8));_0x3d5a99[_0x3a453d(0x29f)]==YT[_0x3a453d(0x3c8)][_0x3a453d(0x409)]?(_0x311713[_0x3a453d(0x176)]='⏸️',hideSoundPermission()):_0x311713['textContent']='▶';if(_0x3d5a99[_0x3a453d(0x29f)]===YT['PlayerState']['ENDED']){if(!ytUserPaused)ytPlayer[_0x3a453d(0x244)]();}}async function ytFadeTo(_0x40dd07,_0xbc586b=0xfa){const _0xec16fb=_0x1b5e35;try{if(!ytPlayer||!ytPlayer['getVolume']||!ytPlayer[_0xec16fb(0x1a0)])return;ytPlayer[_0xec16fb(0x354)]();const _0x4c08bc=ytPlayer['getVolume'](),_0x3ffed4=_0x40dd07-_0x4c08bc;if(Math['abs'](_0x3ffed4)<0x1||_0xbc586b<=0x0){ytPlayer[_0xec16fb(0x1a0)](_0x40dd07);return;}const _0x339b33=performance[_0xec16fb(0x115)]();await new Promise(_0x93aa1f=>{const _0x46c6ed=_0x4de7a3=>{const _0x5f2c86=_0x2c31,_0x4a671b=Math[_0x5f2c86(0x307)](0x1,(_0x4de7a3-_0x339b33)/_0xbc586b),_0x2f9646=Math[_0x5f2c86(0x257)](_0x4c08bc+_0x3ffed4*_0x4a671b);ytPlayer[_0x5f2c86(0x1a0)](_0x2f9646);if(_0x4a671b<0x1)requestAnimationFrame(_0x46c6ed);else _0x93aa1f();};requestAnimationFrame(_0x46c6ed);});}catch(_0x5ec2cc){}}async function ytFadeInPlay(_0x1836a6=0xdc){const _0x3e1aba=_0x1b5e35;try{const _0x56dbb9=Math[_0x3e1aba(0x228)](0x0,Math[_0x3e1aba(0x307)](0x64,data&&data[_0x3e1aba(0x241)]&&data[_0x3e1aba(0x241)]['youtubeVolume']||0x50));if(!IS_FILE_PROTOCOL){if(!ytPlayer)return;ytPlayer[_0x3e1aba(0x354)](),ytPlayer[_0x3e1aba(0x244)]();try{ytPlayer[_0x3e1aba(0x1a0)](0x0);}catch(_0x14ec7b){}await ytFadeTo(_0x56dbb9,_0x1836a6);}else{const _0xe74488=getActiveVideoId();_0xe74488&&fallbackLoadVideo(_0xe74488,{'autoplay':0x1,'mute':0x0});}}catch(_0x594fba){}}async function ytFadeOutPause(_0x287318=0xb4){const _0x7df3a1=_0x1b5e35;try{const _0x1e5be2=Math['max'](0x0,Math['min'](0x64,data&&data['settings']&&data['settings'][_0x7df3a1(0x3ef)]||0x50));if(!IS_FILE_PROTOCOL){if(!ytPlayer)return;await ytFadeTo(0x0,_0x287318);try{ytPlayer[_0x7df3a1(0x391)](),ytPlayer[_0x7df3a1(0x1a0)](_0x1e5be2);}catch(_0x65a787){}}else try{fallbackPause();}catch(_0x33be78){}}catch(_0x5b251d){}}async function updateYouTubePlayer(){const _0x22d837=_0x1b5e35,_0x44793a=getActiveVideoId();if(data[_0x22d837(0x241)]['useYtThumbnailAsBg']&&_0x44793a){const _0x12b750=_0x22d837(0x329)+_0x44793a+_0x22d837(0x380),_0x223e7a=new Image();_0x223e7a[_0x22d837(0x2f0)]=async()=>{const _0x150033=_0x22d837;data[_0x150033(0x241)][_0x150033(0x3f7)]=_0x12b750,await saveData(),applyCustomBg();},_0x223e7a[_0x22d837(0x247)]=async()=>{const _0x53986a=_0x22d837,_0xbab8d7=_0x53986a(0x329)+_0x44793a+_0x53986a(0x102);data['settings'][_0x53986a(0x3f7)]=_0xbab8d7,await saveData(),applyCustomBg();},_0x223e7a[_0x22d837(0x325)]=_0x12b750;}else!_0x44793a&&(data['settings']['customBg']='',await saveData(),applyCustomBg());if(IS_FILE_PROTOCOL){if(!_0x44793a){fallbackStop(),hideSoundPermission();return;}const _0x3dc2ff=_ytUnlocked?0x0:0x1;fallbackLoadVideo(_0x44793a,{'autoplay':0x1,'mute':_0x3dc2ff});!_ytUnlocked&&showSoundPermission();return;}if(!ytPlayer||!ytPlayer[_0x22d837(0x10f)]){try{ensureYouTubeAPI();}catch(_0x4739d5){}return;}if(!_0x44793a){if(ytPlayer[_0x22d837(0x403)])ytPlayer['stopVideo']();hideSoundPermission();return;}ytPlayer[_0x22d837(0x10f)](_0x44793a),ytPlayer[_0x22d837(0x1a0)](data['settings'][_0x22d837(0x3ef)]);}function toggleYtSound(){const _0x1a8506=_0x1b5e35;if(!_ytUnlocked){try{ensureAudio();}catch(_0x4f9e81){}try{unlockAudioChain();}catch(_0x5beb87){}return;}if(IS_FILE_PROTOCOL){const _0x41a065=getActiveVideoId();if(!ytFallbackFrame||!ytFallbackFrame['isConnected']){if(!_0x41a065){toast('Chưa\x20có\x20link\x20hợp\x20lệ.\x20Dán\x20link\x20rồi\x20bấm\x20▶.');return;}fallbackLoadVideo(_0x41a065,{'autoplay':0x1,'mute':0x0}),ytFallbackIsPlaying=!![];try{const _0x39bbad=document['getElementById'](_0x1a8506(0x1f0));if(_0x39bbad)_0x39bbad[_0x1a8506(0x176)]='⏸️';}catch(_0x54b71f){}toast(_0x1a8506(0x333));return;}if(ytFallbackIsPlaying)fallbackPostMessage('pauseVideo'),ytFallbackIsPlaying=![],toast(_0x1a8506(0x334));else{if(!_0x41a065){toast(_0x1a8506(0x16b));return;}fallbackPostMessage(_0x1a8506(0x244)),ytFallbackIsPlaying=!![],toast('Đang\x20phát\x20nhạc\x20nền...');}try{const _0x1f397e=document[_0x1a8506(0x262)](_0x1a8506(0x1f0));if(_0x1f397e)_0x1f397e[_0x1a8506(0x176)]=ytFallbackIsPlaying?'⏸️':'▶';}catch(_0x582fa7){}return;}if(!ytPlayer||typeof ytPlayer[_0x1a8506(0x3a9)]!==_0x1a8506(0xf3)){try{ensureYouTubeAPI();}catch(_0x464d4c){}return;}const _0x5e500e=ytPlayer[_0x1a8506(0x3a9)]();_0x5e500e===YT[_0x1a8506(0x3c8)]['PLAYING']||_0x5e500e===YT['PlayerState']['BUFFERING']?(ytFadeOutPause(),ytUserPaused=!![],toast('Đã\x20dừng\x20nhạc\x20nền.')):(ytFadeInPlay(),ytUserPaused=![],toast(_0x1a8506(0x333)));}function bindEvents(){const _0x4de976=_0x1b5e35;try{const _0x2aace6=document[_0x4de976(0x388)](_0x4de976(0x1e6));_0x2aace6&&(_0x2aace6[_0x4de976(0x33b)]='Hãy\x20bắt\x20đầu\x20bằng\x20cách\x20chọn\x20một\x20<strong>Chủ\x20đề\x20con</strong>\x20hoặc\x20tạo\x20Chủ\x20đề.');}catch(_0x490fd2){}on($(_0x4de976(0x1eb)),_0x4de976(0x302),toggleBackgroundView),on($(_0x4de976(0x31d)),_0x4de976(0x302),()=>{const _0x5b46ba=_0x4de976;$(_0x5b46ba(0x3f1))[_0x5b46ba(0x299)][_0x5b46ba(0x289)]('show');try{releaseFocus();}catch(_0x1a9cd4){}}),on($(_0x4de976(0x122)),_0x4de976(0x302),()=>showInputModal(_0x4de976(0x328),async _0x1a949e=>{const _0x54744b=_0x4de976;if(!_0x1a949e)return;data[_0x54744b(0x28e)]['push']({'id':uid('t'),'name':_0x1a949e,'subtopics':[]}),await saveData(),renderTopics();})),on($(_0x4de976(0x235)),'click',()=>storageManager[_0x4de976(0x283)](data)),on($(_0x4de976(0x128)),_0x4de976(0x3a6),_0x532d1f=>{const _0x5c81b7=_0x4de976,_0x5b3fd6=_0x532d1f[_0x5c81b7(0x1e7)]['files'][0x0];if(!_0x5b3fd6)return;storageManager[_0x5c81b7(0x199)](_0x5b3fd6)[_0x5c81b7(0x1b6)](async _0x293e0e=>{const _0x2015da=_0x5c81b7;data=_0x293e0e,normalizeDataStructure(data),await ensureValidSelection(),await seedAchievedMilestones(),toast(_0x2015da(0x281)),renderAll();})[_0x5c81b7(0x285)](_0x523519=>toast(_0x5c81b7(0x3e5)+_0x523519[_0x5c81b7(0x1a2)])),_0x532d1f[_0x5c81b7(0x1e7)][_0x5c81b7(0x117)]=null;}),on($(_0x4de976(0xfb)),'click',()=>{const _0x2ca29c=_0x4de976,_0x4a83c6=$(_0x2ca29c(0x234)),_0x621d62=_0x4a83c6?_0x4a83c6[_0x2ca29c(0x117)]:'';if(!_0x621d62){toast(_0x2ca29c(0x399));return;}showConfirmModal(_0x2ca29c(0x2cb),_0x2ca29c(0x2f3)+new Date(_0x621d62)[_0x2ca29c(0xff)]()+_0x2ca29c(0x25b),_0xa29798=>{const _0x57d855=_0x2ca29c;_0xa29798&&storageManager[_0x57d855(0x368)](_0x621d62)[_0x57d855(0x1b6)](_0x140d87=>{const _0x56dff6=_0x57d855;data=_0x140d87,toast(_0x56dff6(0x37d)),setTimeout(()=>window[_0x56dff6(0x15f)][_0x56dff6(0x3f0)](),0x5dc);})[_0x57d855(0x285)](_0x2dbcf0=>{toast('Lỗi:\x20'+_0x2dbcf0['message']);});});}),on($(_0x4de976(0x1cb)),'input',_0x5d753=>{const _0x16877e=_0x4de976,_0x1488ac=_0x5d753[_0x16877e(0x1e7)][_0x16877e(0x117)];applyTheme(_0x1488ac);if(_0x1488ac===_0x16877e(0x141)||_0x1488ac===_0x16877e(0x2c1)){const _0x1f3e16=$(_0x16877e(0x393));_0x1f3e16&&(_0x1f3e16[_0x16877e(0x19c)]=![],toast(_0x16877e(0x27e),0x7d0));try{document[_0x16877e(0xfa)][_0x16877e(0x300)][_0x16877e(0x18b)](_0x16877e(0x1ec),_0x16877e(0x13b));}catch(_0xd9162e){}}else{const _0x342cfe=$(_0x16877e(0x393));_0x342cfe&&(_0x342cfe[_0x16877e(0x19c)]=!![]);try{updateYouTubePlayer();}catch(_0x341e5e){}}}),on($(_0x4de976(0x179)),_0x4de976(0x302),openSettings),on($(_0x4de976(0x404)),'click',()=>{const _0x3bbd80=_0x4de976;switchView(_0x3bbd80(0x28e)),$(_0x3bbd80(0x122))[_0x3bbd80(0x302)]();}),on($(_0x4de976(0x38c)),_0x4de976(0x302),()=>{const _0x1f79f0=_0x4de976;renderDashboard(),$(_0x1f79f0(0x119))[_0x1f79f0(0x299)][_0x1f79f0(0x11e)](_0x1f79f0(0x1ba));}),on($(_0x4de976(0x27a)),_0x4de976(0x302),()=>{const _0x9a8c95=_0x4de976;$(_0x9a8c95(0x119))['classList'][_0x9a8c95(0x289)](_0x9a8c95(0x1ba));}),on($('#btnCloseSettings'),_0x4de976(0x302),closeSettings),on($(_0x4de976(0x3ff)),_0x4de976(0x302),saveSettings),on($(_0x4de976(0x28f)),_0x4de976(0x302),setDefaults),on($(_0x4de976(0x40c)),_0x4de976(0x302),()=>{const _0x249ab4=_0x4de976;ensureAudio(),playSound(_0x249ab4(0x18a));}),on($(_0x4de976(0x15d)),'click',_0x21aa6d=>{const _0x3e1c01=_0x4de976;_0x21aa6d[_0x3e1c01(0x309)]();const _0x34cbf1=$('#customSoundsContainer');if(_0x34cbf1)_0x34cbf1[_0x3e1c01(0x299)][_0x3e1c01(0x1b2)](_0x3e1c01(0x31a));}),on($(_0x4de976(0x1ae)),'click',async()=>{const _0x35655a=_0x4de976,_0x1c9ff4=getCurrentSubtopic();if(!_0x1c9ff4)return;const _0xa19833=pendingNoteSessionId,_0x4e8fe6=_0x1c9ff4[_0x35655a(0x230)][_0x35655a(0x3b7)](_0x1cb8b6=>_0x1cb8b6['id']===_0xa19833);_0x4e8fe6&&(_0x4e8fe6[_0x35655a(0x374)]=$(_0x35655a(0x156))[_0x35655a(0x117)]['trim'](),await saveData(),renderStatsHistory(),toast(_0x35655a(0x33c))),closeNoteModal();}),on($(_0x4de976(0x17c)),_0x4de976(0x302),()=>closeNoteModal()),on($(_0x4de976(0x1d2)),_0x4de976(0x302),addGeneralNote),on($('#btnSummarizeNote'),_0x4de976(0x302),handleSummarizeNote),on($('#btnSendMessage'),_0x4de976(0x302),handleSendMessage),on($(_0x4de976(0x3e8)),_0x4de976(0x131),_0x3fa3d0=>{const _0x22d348=_0x4de976;if(_0x3fa3d0[_0x22d348(0x291)]===_0x22d348(0x1be))handleSendMessage();}),$$(_0x4de976(0x238))[_0x4de976(0x378)](_0x40e1a0=>{const _0x2011db=_0x4de976;on(_0x40e1a0,_0x2011db(0x302),()=>{const _0x5a164c=_0x2011db,_0x3c87c7=_0x40e1a0[_0x5a164c(0xfd)][_0x5a164c(0x2a6)];$(_0x5a164c(0x3e8))[_0x5a164c(0x117)]=_0x3c87c7,$(_0x5a164c(0x3e8))[_0x5a164c(0xf6)]();});}),on($('#btnClearChat'),_0x4de976(0x302),clearChat),on($(_0x4de976(0x1ad)),_0x4de976(0x302),addSubtopicTask),on($('#newSubtopicTaskInput'),_0x4de976(0x131),_0x37a596=>{const _0x364b41=_0x4de976;if(_0x37a596[_0x364b41(0x291)]===_0x364b41(0x1be))addSubtopicTask();}),on($(_0x4de976(0x2e8)),_0x4de976(0x302),toggleYtSound),on($(_0x4de976(0x3af)),_0x4de976(0x302),()=>{ensureAudio(),unlockAudioChain();}),on($(_0x4de976(0x3bd)),_0x4de976(0x28b),_0x28dbfa=>{const _0x132846=_0x4de976,_0x70645a=parseInt(_0x28dbfa[_0x132846(0x1e7)][_0x132846(0x117)],0xa);ytPlayer&&ytPlayer[_0x132846(0x1a0)]&&ytPlayer['setVolume'](_0x70645a);}),on($('#set_youtubeUrl'),_0x4de976(0x28b),handleYoutubeUrlInput),$$(_0x4de976(0x24f))['forEach'](_0x2a32a5=>{const _0x5533e1=_0x4de976;_0x2a32a5[_0x5533e1(0x2f7)](_0x5533e1(0x302),()=>{const _0x4c4fca=_0x5533e1,_0x75db04=_0x2a32a5['dataset'][_0x4c4fca(0x2f9)],_0x41211b=data?.[_0x4c4fca(0x241)]?.[_0x4c4fca(0x3c3)]||_0x4c4fca(0x1a9);if(_0x41211b===_0x75db04&&_0x75db04!==_0x4c4fca(0x1a9))switchView(_0x4c4fca(0x1a9));else switchView(_0x75db04);});}),$$('.tab-btn')[_0x4de976(0x378)](_0x1e1a64=>{const _0x42ab67=_0x4de976;_0x1e1a64[_0x42ab67(0x2f7)](_0x42ab67(0x302),()=>{const _0x5b21dc=_0x42ab67,_0x2a3369=_0x1e1a64[_0x5b21dc(0xfd)][_0x5b21dc(0x239)],_0x57ce00=_0x1e1a64[_0x5b21dc(0x308)](_0x5b21dc(0x242));if(!_0x57ce00)return;_0x57ce00[_0x5b21dc(0x363)](_0x5b21dc(0x21d))[_0x5b21dc(0x378)](_0x306110=>_0x306110[_0x5b21dc(0x299)][_0x5b21dc(0x289)](_0x5b21dc(0x2ef))),_0x1e1a64[_0x5b21dc(0x299)][_0x5b21dc(0x11e)](_0x5b21dc(0x2ef)),_0x57ce00[_0x5b21dc(0x363)](_0x5b21dc(0x1e2))['forEach'](_0x2d740f=>{const _0x225496=_0x5b21dc;_0x2d740f[_0x225496(0x299)]['remove']('active'),_0x2d740f[_0x225496(0x300)]['display']='none';});const _0x39267f=_0x57ce00[_0x5b21dc(0x388)]('#'+_0x2a3369);_0x39267f&&(_0x39267f[_0x5b21dc(0x299)][_0x5b21dc(0x11e)](_0x5b21dc(0x2ef)),_0x39267f[_0x5b21dc(0x300)]['display']=_0x5b21dc(0x2c5),_0x57ce00['closest'](_0x5b21dc(0x181))&&(_0x39267f[_0x5b21dc(0x300)][_0x5b21dc(0x336)]=_0x5b21dc(0x1e0)));});});const _0x501cbe=$('#methodEditorContentInput');function _0x455a3b(_0x36c542,_0x4f37c4=null){const _0x2e9c9a=_0x4de976;try{document[_0x2e9c9a(0x144)]('styleWithCSS',![],!![]);}catch(_0x1098a0){}try{document[_0x2e9c9a(0x144)](_0x36c542,![],_0x4f37c4);}catch(_0x4533e9){}if(_0x501cbe)_0x501cbe[_0x2e9c9a(0xf6)]();}on($(_0x4de976(0x1c8)),'click',()=>_0x455a3b(_0x4de976(0x212))),on($(_0x4de976(0x173)),_0x4de976(0x302),()=>_0x455a3b(_0x4de976(0x23f))),on($(_0x4de976(0x32f)),'click',()=>_0x455a3b(_0x4de976(0x2aa),_0x4de976(0xef))),on($(_0x4de976(0x19e)),_0x4de976(0x302),()=>_0x455a3b('insertOrderedList')),on($('#toolBullet'),_0x4de976(0x302),()=>_0x455a3b(_0x4de976(0x314)));const _0x1149bd=$(_0x4de976(0x26d)),_0x5db007=$('.color-palette');on($(_0x4de976(0x2dc)),_0x4de976(0x302),_0x3830b5=>{const _0x364e31=_0x4de976;if(!_0x5db007)return;_0x3830b5['stopPropagation'](),_0x5db007['classList'][_0x364e31(0x1b2)](_0x364e31(0x31a));}),$$('.color-swatch')['forEach'](_0x369064=>{const _0x48e510=_0x4de976;on(_0x369064,_0x48e510(0x302),_0x149ee2=>{const _0x55bbd5=_0x48e510;_0x149ee2[_0x55bbd5(0x309)]();const _0x29ea38=_0x369064[_0x55bbd5(0xfd)][_0x55bbd5(0x342)]||'';let _0x3e12ca=_0x29ea38;try{const _0x557e44=_0x29ea38[_0x55bbd5(0x3b2)](/--[a-zA-Z0-9_-]+/);if(_0x557e44)_0x3e12ca=getComputedStyle(document[_0x55bbd5(0xfa)])['getPropertyValue'](_0x557e44[0x0])[_0x55bbd5(0x287)]();}catch(_0x32c431){}_0x455a3b(_0x55bbd5(0x146),_0x3e12ca);if(_0x5db007)_0x5db007['classList'][_0x55bbd5(0x11e)](_0x55bbd5(0x31a));});}),on(document,_0x4de976(0x302),_0x1f7835=>{const _0x9b2019=_0x4de976;if(!_0x1149bd||!_0x5db007)return;!_0x1149bd[_0x9b2019(0x1b9)](_0x1f7835[_0x9b2019(0x1e7)])&&!_0x5db007[_0x9b2019(0x299)][_0x9b2019(0x1b9)](_0x9b2019(0x31a))&&_0x5db007['classList']['add']('hidden');});function _0x238b7f(_0x39d4db){const _0xede6c5=_0x4de976,_0x401311=getCurrentSubtopic();if(!_0x401311){toast(_0xede6c5(0x154));return;}_0x401311[_0xede6c5(0x1de)]=Array['isArray'](_0x401311[_0xede6c5(0x1de)])?_0x401311[_0xede6c5(0x1de)]:[];const _0x14f10b=_0x401311[_0xede6c5(0x1de)],_0x6ed362=_0x39d4db?_0x14f10b[_0xede6c5(0x3b7)](_0x4dc05b=>_0x4dc05b['id']===_0x39d4db):null;$(_0xede6c5(0x220))[_0xede6c5(0x117)]=_0x6ed362&&_0x6ed362['id']||'',$(_0xede6c5(0x1a8))[_0xede6c5(0x176)]=_0x6ed362?_0xede6c5(0x408):_0xede6c5(0x3f8),$(_0xede6c5(0x322))[_0xede6c5(0x117)]=_0x6ed362&&_0x6ed362[_0xede6c5(0x32c)]||'';const _0x162583=$(_0xede6c5(0x2a1));if(_0x162583)_0x162583[_0xede6c5(0x33b)]=_0x6ed362&&_0x6ed362[_0xede6c5(0x263)]||'';$(_0xede6c5(0x127))[_0xede6c5(0x299)]['add'](_0xede6c5(0x1ba));try{trapFocus($('#modalMethodEditor'));}catch(_0x3ed7e4){}try{const _0x1a0b29=$('#btnAutoFormat');if(_0x1a0b29){const _0x2336aa=!!(data?.[_0xede6c5(0x241)]?.[_0xede6c5(0x3e4)]&&data[_0xede6c5(0x241)][_0xede6c5(0x3e4)][_0xede6c5(0x287)]());_0x1a0b29[_0xede6c5(0x16e)]=!_0x2336aa,_0x1a0b29[_0xede6c5(0x32c)]=_0x2336aa?_0xede6c5(0x3d6):_0xede6c5(0x39f);}}catch(_0xf0aae3){}}on($(_0x4de976(0x130)),_0x4de976(0x302),()=>{const _0x113f1d=_0x4de976;$('#modalMethodEditor')[_0x113f1d(0x299)][_0x113f1d(0x289)](_0x113f1d(0x1ba));try{releaseFocus();}catch(_0x398354){}}),on($('#btnSaveMethod'),_0x4de976(0x302),async()=>{const _0x489367=_0x4de976,_0x40fedb=getCurrentSubtopic();if(!_0x40fedb){toast(_0x489367(0x154));return;}_0x40fedb['methods']=Array['isArray'](_0x40fedb[_0x489367(0x1de)])?_0x40fedb[_0x489367(0x1de)]:[];const _0x1b325a=$(_0x489367(0x220))[_0x489367(0x117)]||uid('m'),_0x271b07=($(_0x489367(0x322))[_0x489367(0x117)]||'')[_0x489367(0x287)](),_0x2dd0ef=$(_0x489367(0x2a1)),_0x566be4=_0x2dd0ef?_0x2dd0ef[_0x489367(0x33b)]||'':'',_0x295149=_0x40fedb[_0x489367(0x1de)]['findIndex'](_0x10b5ab=>_0x10b5ab['id']===_0x1b325a),_0x361531={'id':_0x1b325a,'title':_0x271b07,'content':_0x566be4};if(_0x295149>=0x0)_0x40fedb[_0x489367(0x1de)][_0x295149]=_0x361531;else _0x40fedb[_0x489367(0x1de)][_0x489367(0x246)](_0x361531);await storageManager['update']('subtopics',_0x40fedb),renderMethods(),$('#modalMethodEditor')[_0x489367(0x299)]['remove']('show');try{releaseFocus();}catch(_0x1eff1b){}}),on($(_0x4de976(0x3a7)),_0x4de976(0x302),async()=>{const _0x5386d5=_0x4de976,_0x58889c=$('#methodEditorContentInput');if(!_0x58889c)return;const _0x173d3c=(_0x58889c['textContent']||'')[_0x5386d5(0x287)]();if(!_0x173d3c||_0x173d3c[_0x5386d5(0x1a1)]<0x14){toast('Cần\x20có\x20nội\x20dung\x20để\x20AI\x20định\x20dạng.');return;}const _0x4d8ed0=$(_0x5386d5(0x3a7));_0x4d8ed0&&(_0x4d8ed0['disabled']=!![],_0x4d8ed0['innerHTML']=_0x5386d5(0x2e6));const _0x15ffbc=_0x5386d5(0x2fb)+_0x173d3c+'\x22',_0x235631=await callGeminiAPI(_0x15ffbc);_0x235631?(_0x58889c[_0x5386d5(0x33b)]=_0x235631,toast(_0x5386d5(0x136))):toast(_0x5386d5(0x25f)),_0x4d8ed0&&(_0x4d8ed0[_0x5386d5(0x16e)]=![],_0x4d8ed0[_0x5386d5(0x33b)]='✨\x20Tự\x20động\x20định\x20dạng');}),on($('#btnAddMethod'),_0x4de976(0x302),()=>{const _0x184e3f=_0x4de976;if(!getCurrentSubtopic()){toast(_0x184e3f(0x154));return;}_0x238b7f();});const _0x259970=document['querySelector'](_0x4de976(0x394));_0x259970&&_0x259970[_0x4de976(0x2f7)]('click',_0x256602=>{const _0x1e7114=_0x4de976,_0xb8c168=_0x256602[_0x1e7114(0x1e7)]['closest']&&_0x256602[_0x1e7114(0x1e7)][_0x1e7114(0x308)](_0x1e7114(0x190)),_0x4bde7e=!_0xb8c168&&_0x256602[_0x1e7114(0x1e7)]['closest']&&_0x256602[_0x1e7114(0x1e7)][_0x1e7114(0x308)](_0x1e7114(0x1d8));if(_0xb8c168){_0x256602[_0x1e7114(0x309)](),_0x256602[_0x1e7114(0x187)]();const _0x52a0ea=_0xb8c168[_0x1e7114(0xfd)]['id'];if(_0x52a0ea)_0x238b7f(_0x52a0ea);return;}if(_0x4bde7e){_0x256602[_0x1e7114(0x309)](),_0x256602[_0x1e7114(0x187)]();const _0x4d9e6c=_0x4bde7e[_0x1e7114(0xfd)]['id'];if(!_0x4d9e6c)return;const _0x54b51f=getCurrentSubtopic();if(!_0x54b51f)return;_0x54b51f['methods']=Array[_0x1e7114(0x39c)](_0x54b51f['methods'])?_0x54b51f['methods']:[];const _0x24dbfb=_0x54b51f[_0x1e7114(0x1de)][_0x1e7114(0x3b7)](_0x5516b0=>_0x5516b0['id']===_0x4d9e6c);if(!_0x24dbfb)return;showConfirmModal(_0x1e7114(0x3fb),'Xóa\x20tri\x20thức\x20\x22'+(_0x24dbfb[_0x1e7114(0x32c)]||'')+'\x22?',async _0x583645=>{const _0x4d64a1=_0x1e7114;if(!_0x583645)return;_0x54b51f['methods']=_0x54b51f[_0x4d64a1(0x1de)]['filter'](_0x1ac5f2=>_0x1ac5f2['id']!==_0x4d9e6c),await storageManager['update'](_0x4d64a1(0x2d5),_0x54b51f),renderMethods();});}});$$(_0x4de976(0x26c))['forEach'](_0x5b6b2d=>{const _0x37e972=_0x4de976;_0x5b6b2d[_0x37e972(0x2f7)](_0x37e972(0x302),()=>{const _0x403f76=_0x37e972;editingPreset=_0x5b6b2d['dataset'][_0x403f76(0x319)],highlightPresetSelector(),loadEditingPresetFields();});}),$$(_0x4de976(0x1f9))[_0x4de976(0x378)](_0x3aa951=>{const _0x406f85=_0x4de976;_0x3aa951['addEventListener'](_0x406f85(0x302),_0x72b63a=>{const _0x23a1a9=_0x406f85,_0x31573c=_0x72b63a['target'][_0x23a1a9(0xfd)][_0x23a1a9(0x3e9)],_0x4e8079=data[_0x23a1a9(0x241)][_0x23a1a9(0x3e9)];if(_0x31573c===_0x4e8079)return;timer[_0x23a1a9(0x1c3)]!==_0x23a1a9(0x21e)?showConfirmModal(_0x23a1a9(0x166),_0x23a1a9(0x358)+_0x31573c+_0x23a1a9(0x12d),_0x23815a=>{const _0x142255=_0x23a1a9;_0x23815a&&(timer[_0x142255(0x1e8)](),timer['setPreset'](_0x31573c),renderAll(),toast('Đã\x20chuyển\x20sang\x20Kiểu\x20'+_0x31573c+'.'));}):(timer[_0x23a1a9(0x225)](_0x31573c),renderAll(),toast('Đã\x20chuyển\x20sang\x20Kiểu\x20'+_0x31573c+'.'));});}),on($('#btnStart'),_0x4de976(0x302),()=>timer['start']()),on($('#btnFinishFlow'),'click',()=>timer[_0x4de976(0x3f2)]()),on($('#btnPause'),_0x4de976(0x302),()=>timer['pause']()),on($(_0x4de976(0x2dd)),_0x4de976(0x302),()=>timer['resume']()),on($(_0x4de976(0x24d)),_0x4de976(0x302),()=>timer[_0x4de976(0x193)]()),on($('#btnReset'),_0x4de976(0x302),()=>timer[_0x4de976(0x1e8)]()),on($(_0x4de976(0x10a)),_0x4de976(0x302),()=>timer[_0x4de976(0x163)]()),on($(_0x4de976(0x2a8)),_0x4de976(0x3a6),_0xba8a73=>{const _0x443ffc=_0x4de976;handleFileUpload(_0xba8a73[_0x443ffc(0x1e7)][_0x443ffc(0x25e)][0x0],async _0x4c6d25=>{const _0xe5ce7a=_0x443ffc;data[_0xe5ce7a(0x241)][_0xe5ce7a(0x3f7)]=_0x4c6d25,await saveData(),applyCustomBg(),toast(_0xe5ce7a(0x268));}),_0xba8a73[_0x443ffc(0x1e7)][_0x443ffc(0x117)]=null;}),on($(_0x4de976(0x2bf)),_0x4de976(0x302),async()=>{const _0x1c9f46=_0x4de976;data[_0x1c9f46(0x241)][_0x1c9f46(0x3f7)]='',data['settings'][_0x1c9f46(0x310)]=![],await saveData(),applyCustomBg(),toast(_0x1c9f46(0x29b)),$(_0x1c9f46(0x181))[_0x1c9f46(0x299)][_0x1c9f46(0x1b9)](_0x1c9f46(0x1ba))&&openSettings();}),on($(_0x4de976(0x2da)),'change',_0x3d98d8=>{const _0x30bc45=_0x4de976;handleFileUpload(_0x3d98d8[_0x30bc45(0x1e7)][_0x30bc45(0x25e)][0x0],async _0x4825ba=>{const _0x4932ec=_0x30bc45;data['settings']['customSounds'][_0x4932ec(0x18a)]=_0x4825ba,await saveData(),toast('Đã\x20lưu\x20âm\x20báo\x20hết\x20LÀM\x20VIỆC.');}),_0x3d98d8[_0x30bc45(0x1e7)][_0x30bc45(0x117)]=null;}),on($('#uploadSoundBreak'),_0x4de976(0x3a6),_0x31909d=>{const _0x55c96f=_0x4de976;handleFileUpload(_0x31909d[_0x55c96f(0x1e7)][_0x55c96f(0x25e)][0x0],async _0x28a6ab=>{const _0x297abe=_0x55c96f;data[_0x297abe(0x241)][_0x297abe(0xf4)][_0x297abe(0x14b)]=_0x28a6ab,await saveData(),toast(_0x297abe(0x250));}),_0x31909d[_0x55c96f(0x1e7)]['value']=null;}),on($(_0x4de976(0x153)),_0x4de976(0x3a6),_0x388f26=>{const _0x1a3f24=_0x4de976;handleFileUpload(_0x388f26[_0x1a3f24(0x1e7)][_0x1a3f24(0x25e)][0x0],async _0xe6b832=>{data['settings']['customSounds']['long_end']=_0xe6b832,await saveData(),toast('Đã\x20lưu\x20âm\x20báo\x20hết\x20NGHỈ\x20DÀI.');}),_0x388f26[_0x1a3f24(0x1e7)][_0x1a3f24(0x117)]=null;}),on($(_0x4de976(0xee)),_0x4de976(0x302),toggleFullScreen),document[_0x4de976(0x2f7)](_0x4de976(0x143),updateFullscreenButton),window[_0x4de976(0x2f7)](_0x4de976(0x131),_0x110e35=>{const _0x2e312b=_0x4de976,_0x5c3b32=_0x110e35['target'],_0x558bf8=(_0x5c3b32[_0x2e312b(0x11d)]||'')['toLowerCase'](),_0xadcd7a=['input','textarea',_0x2e312b(0x3da)]['includes'](_0x558bf8)||_0x5c3b32[_0x2e312b(0x2bb)];if(_0x110e35[_0x2e312b(0x371)]===_0x2e312b(0x254)&&!_0xadcd7a){_0x110e35[_0x2e312b(0x309)]();if(timer[_0x2e312b(0x1c3)]===_0x2e312b(0x21e)||timer['state']==='paused')timer['start']();else timer[_0x2e312b(0x330)]();}(_0x110e35[_0x2e312b(0x291)]==='n'||_0x110e35['key']==='N')&&(!_0xadcd7a&&(_0x110e35[_0x2e312b(0x309)](),timer[_0x2e312b(0x193)]()));if(_0x110e35[_0x2e312b(0x291)]==='Escape'){$$(_0x2e312b(0x2a2))[_0x2e312b(0x378)](_0x1c62f1=>_0x1c62f1[_0x2e312b(0x299)]['remove']('show'));try{releaseFocus();}catch(_0xe3878e){}}if(_0x110e35['altKey']&&!_0xadcd7a){if(_0x110e35[_0x2e312b(0x291)]===_0x2e312b(0x34b))_0x110e35[_0x2e312b(0x309)](),_0x6b9e57(0x0,-0xa);else{if(_0x110e35['key']===_0x2e312b(0x3db))_0x110e35['preventDefault'](),_0x6b9e57(0x0,0xa);else{if(_0x110e35[_0x2e312b(0x291)]===_0x2e312b(0xf7))_0x110e35[_0x2e312b(0x309)](),_0x6b9e57(-0xa,0x0);else _0x110e35[_0x2e312b(0x291)]===_0x2e312b(0x377)&&(_0x110e35[_0x2e312b(0x309)](),_0x6b9e57(0xa,0x0));}}}}),$$(_0x4de976(0x2a2))[_0x4de976(0x378)](_0x2efe30=>_0x2efe30[_0x4de976(0x2f7)](_0x4de976(0x302),_0x57bc79=>{const _0x239ae0=_0x4de976;if(_0x57bc79&&_0x57bc79[_0x239ae0(0x1e7)]&&_0x57bc79[_0x239ae0(0x1e7)]['id']==='modalMethodEditor')return;if(_0x57bc79[_0x239ae0(0x1e7)]===_0x2efe30){_0x2efe30[_0x239ae0(0x299)][_0x239ae0(0x289)](_0x239ae0(0x1ba));try{releaseFocus();}catch(_0x3d6c0e){}}})),window[_0x4de976(0x2f7)](_0x4de976(0x302),_0x5151ff=>{const _0x3e5a8c=_0x4de976;!_0x5151ff[_0x3e5a8c(0x1e7)]['closest'](_0x3e5a8c(0x229))&&!_0x5151ff[_0x3e5a8c(0x1e7)][_0x3e5a8c(0x308)](_0x3e5a8c(0x125))&&closeAllMenus();});try{const _0x43be26=document[_0x4de976(0x388)](_0x4de976(0x1a3));if(_0x43be26)_0x43be26[_0x4de976(0x2f7)](_0x4de976(0x202),closeAllMenus);}catch(_0x30d1c8){}try{window[_0x4de976(0x2f7)](_0x4de976(0x202),closeAllMenus,!![]);}catch(_0x5679cf){}window['addEventListener'](_0x4de976(0x3f5),()=>timer[_0x4de976(0x323)](!![]));try{const _0x175aca=Array[_0x4de976(0x150)](document[_0x4de976(0x363)](_0x4de976(0x2e0)));_0x175aca[_0x4de976(0x1a1)]&&_0x175aca[_0x4de976(0x378)](_0x2946b0=>{const _0x6dd438=_0x4de976;_0x2946b0['addEventListener'](_0x6dd438(0x1b2),()=>{const _0x21eb81=_0x6dd438;_0x2946b0[_0x21eb81(0xfe)]&&_0x175aca['forEach'](_0x2c439c=>{if(_0x2c439c!==_0x2946b0)_0x2c439c['open']=![];});});});}catch(_0x321daa){}const _0x5ec725=$(_0x4de976(0x36e));let _0x2f49a5=![],_0x56ee0f,_0x530eeb;_0x5ec725&&(_0x5ec725['addEventListener']('mousedown',_0x394472=>{const _0x2b9811=_0x4de976;_0x2f49a5=!![];const _0x2c4a4c=_0x5ec725[_0x2b9811(0x17b)]();_0x56ee0f=_0x394472[_0x2b9811(0x3d9)]-_0x2c4a4c['left'],_0x530eeb=_0x394472[_0x2b9811(0x278)]-_0x2c4a4c[_0x2b9811(0x1f2)],_0x5ec725[_0x2b9811(0x300)]['transition']='none';}),document['addEventListener'](_0x4de976(0x35d),_0x2d85c7=>{const _0x44ecd7=_0x4de976;if(!_0x2f49a5)return;let _0x3eba0d=_0x2d85c7['clientX']-_0x56ee0f,_0x168179=_0x2d85c7[_0x44ecd7(0x278)]-_0x530eeb;const _0x5a643b=window[_0x44ecd7(0x3d8)]-_0x5ec725['offsetWidth'],_0x27db0c=window[_0x44ecd7(0x253)]-_0x5ec725['offsetHeight'];_0x3eba0d=Math['max'](0x0,Math[_0x44ecd7(0x307)](_0x3eba0d,_0x5a643b)),_0x168179=Math['max'](0x0,Math['min'](_0x168179,_0x27db0c)),_0x5ec725[_0x44ecd7(0x300)]['left']=_0x3eba0d+'px',_0x5ec725[_0x44ecd7(0x300)][_0x44ecd7(0x1f2)]=_0x168179+'px',_0x5ec725[_0x44ecd7(0x300)][_0x44ecd7(0x32d)]=_0x44ecd7(0x1cf),_0x5ec725['style'][_0x44ecd7(0x101)]=_0x44ecd7(0x1cf);}),document['addEventListener']('mouseup',()=>{const _0x425329=_0x4de976;if(!_0x2f49a5)return;_0x2f49a5=![],_0x5ec725[_0x425329(0x300)][_0x425329(0x19a)]='';}));function _0x47ab3e(_0x953846){const _0x140fdf=_0x4de976,_0x24af6a=$('#draggableTimer');if(!_0x24af6a)return;_0x24af6a['style']['position']='fixed',_0x24af6a['style'][_0x140fdf(0x19a)]='',_0x24af6a[_0x140fdf(0x300)][_0x140fdf(0x118)]='auto',_0x24af6a[_0x140fdf(0x300)]['top']=_0x140fdf(0x1cf),_0x24af6a['style'][_0x140fdf(0x101)]=_0x140fdf(0x1cf),_0x24af6a[_0x140fdf(0x300)][_0x140fdf(0x32d)]=_0x140fdf(0x1cf);const _0x251dae=0x10;_0x953846==='tl'&&(_0x24af6a[_0x140fdf(0x300)]['left']=_0x251dae+'px',_0x24af6a[_0x140fdf(0x300)][_0x140fdf(0x1f2)]=_0x251dae+'px'),_0x953846==='tr'&&(_0x24af6a['style']['right']=_0x251dae+'px',_0x24af6a[_0x140fdf(0x300)][_0x140fdf(0x1f2)]=_0x251dae+'px'),_0x953846==='bl'&&(_0x24af6a[_0x140fdf(0x300)][_0x140fdf(0x118)]=_0x251dae+'px',_0x24af6a[_0x140fdf(0x300)][_0x140fdf(0x32d)]=_0x251dae+'px'),_0x953846==='br'&&(_0x24af6a['style']['right']=_0x251dae+'px',_0x24af6a[_0x140fdf(0x300)]['bottom']=_0x251dae+'px');}function _0x6b9e57(_0x5b2ce8,_0x362942){const _0x164747=_0x4de976,_0x41f9ec=$(_0x164747(0x36e));if(!_0x41f9ec)return;const _0x5ed64c=_0x41f9ec[_0x164747(0x17b)](),_0x3aec8e=Math[_0x164747(0x228)](0x0,Math[_0x164747(0x307)](_0x5ed64c[_0x164747(0x118)]+_0x5b2ce8,window['innerWidth']-_0x41f9ec[_0x164747(0x31b)])),_0x2b9a55=Math['max'](0x0,Math[_0x164747(0x307)](_0x5ed64c[_0x164747(0x1f2)]+_0x362942,window['innerHeight']-_0x41f9ec[_0x164747(0x2f8)]));_0x41f9ec[_0x164747(0x300)]['left']=_0x3aec8e+'px',_0x41f9ec['style']['top']=_0x2b9a55+'px',_0x41f9ec[_0x164747(0x300)][_0x164747(0x101)]='auto',_0x41f9ec['style']['bottom']=_0x164747(0x1cf);}}function toggleBackgroundView(){const _0x550cac=_0x1b5e35,_0x46dcbf=document['body'];_0x46dcbf[_0x550cac(0x299)][_0x550cac(0x1b2)](_0x550cac(0x226));const _0x41c6f3=_0x46dcbf[_0x550cac(0x299)][_0x550cac(0x1b9)](_0x550cac(0x226)),_0x37f0f0=$('#btnToggleBg');if(!_0x37f0f0)return;_0x41c6f3?(_0x37f0f0[_0x550cac(0x32c)]=_0x550cac(0x32b),_0x37f0f0['innerHTML']='<svg\x20xmlns=\x22http://www.w3.org/2000/svg\x22\x20width=\x2216\x22\x20height=\x2216\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22><path\x20d=\x22M9.88\x209.88a3\x203\x200\x201\x200\x204.24\x204.24\x22/><path\x20d=\x22M10.73\x205.08A10.43\x2010.43\x200\x200\x201\x2012\x205c7\x200\x2010\x207\x2010\x207a13.16\x2013.16\x200\x200\x201-1.67\x202.68\x22/><path\x20d=\x22M6.61\x206.61A13.526\x2013.526\x200\x200\x200\x202\x2012s3\x207\x2010\x207a9.74\x209.74\x200\x200\x200\x205.39-1.61\x22/><line\x20x1=\x222\x22\x20y1=\x222\x22\x20x2=\x2222\x22\x20y2=\x2222\x22/></svg>'):(_0x37f0f0['title']=_0x550cac(0x372),_0x37f0f0['innerHTML']=_0x550cac(0x3bc));}function updateMainViewVisibility(){const _0x28963e=_0x1b5e35,_0x250207=!!getCurrentSubtopic(),_0x7dc724=$('#view-timer'),_0x482459=$(_0x28963e(0x1d4));_0x482459&&_0x482459['classList'][_0x28963e(0x1b2)](_0x28963e(0x31a),_0x250207),_0x7dc724&&(_0x250207?_0x7dc724['classList'][_0x28963e(0x289)](_0x28963e(0x3c0)):_0x7dc724[_0x28963e(0x299)][_0x28963e(0x11e)](_0x28963e(0x3c0)));}function updatePresetButtonsText(){const _0x5a722f=_0x1b5e35,_0x25e263=data[_0x5a722f(0x241)],_0x3079fd=_0x25e263[_0x5a722f(0x16f)],_0x141b44=_0x25e263[_0x5a722f(0x2f5)],_0x52410e=_0x25e263[_0x5a722f(0x11f)]['A_work'],_0xd7245=_0x25e263[_0x5a722f(0x11f)][_0x5a722f(0x398)],_0x37e92d=$('#btnPresetA'),_0x2e2bde=$(_0x5a722f(0x3ce)),_0x3d645b=$(_0x5a722f(0x2c7));_0x37e92d&&(_0x37e92d['textContent']=_0x3079fd+'×'+_0x52410e+'\x20(A)'),_0x2e2bde&&(_0x2e2bde[_0x5a722f(0x176)]=_0x141b44+'×'+_0xd7245+_0x5a722f(0x185)),_0x3d645b&&(_0x3d645b[_0x5a722f(0x176)]=_0x5a722f(0x1f5));}function renderAll(){const _0x1839b0=_0x1b5e35;updatePresetButtonsText();const _0x543fc3=data[_0x1839b0(0x241)][_0x1839b0(0x3e9)];$$(_0x1839b0(0x1f9))[_0x1839b0(0x378)](_0x163191=>{const _0x2d6943=_0x1839b0,_0x34247b=_0x163191['dataset'][_0x2d6943(0x3e9)]===_0x543fc3;_0x163191[_0x2d6943(0x299)][_0x2d6943(0x1b2)]('acc',_0x34247b),_0x163191[_0x2d6943(0x299)]['toggle'](_0x2d6943(0x203),!_0x34247b),_0x163191[_0x2d6943(0x31c)](_0x2d6943(0x106),_0x34247b);}),updateMainViewVisibility(),timer[_0x1839b0(0x225)](data[_0x1839b0(0x241)][_0x1839b0(0x3e9)],{'silent':!![]}),renderTopics(),renderContextBadge(),renderStatsHistory(),renderGeneralNotes(),renderMethods(),renderChat(),applyCustomBg(),applyPanelOpacity(),renderSubtopicTasks(),updateFullscreenButton(),switchView(data[_0x1839b0(0x241)][_0x1839b0(0x3c3)]);}function toggleFullScreen(){const _0x3f37de=_0x1b5e35;!document[_0x3f37de(0x2ab)]?document[_0x3f37de(0x338)][_0x3f37de(0x186)]()[_0x3f37de(0x285)](_0x5e7bd4=>{const _0x4bd107=_0x3f37de;toast(_0x4bd107(0x273)+_0x5e7bd4[_0x4bd107(0x1a2)]);}):document[_0x3f37de(0x2d1)]&&document[_0x3f37de(0x2d1)]();}function updateFullscreenButton(){const _0x126e2c=_0x1b5e35,_0x4185b3=$(_0x126e2c(0xee));document[_0x126e2c(0x2ab)]?(_0x4185b3[_0x126e2c(0x33b)]='↙',_0x4185b3['title']=_0x126e2c(0x3a2)):(_0x4185b3[_0x126e2c(0x33b)]='↗',_0x4185b3[_0x126e2c(0x32c)]=_0x126e2c(0x23d));}async function initializeApp(){const _0x321125=_0x1b5e35;try{await storageManager[_0x321125(0x216)]();const [_0x3df927,_0x1b3a2e,_0x3a2370]=await Promise[_0x321125(0x2ea)]([storageManager[_0x321125(0x327)](),storageManager[_0x321125(0x2df)](_0x321125(0x28e)),storageManager[_0x321125(0x2df)](_0x321125(0x2d5))]);let _0x954820;if(!_0x3df927){const _0xf8b547=JSON[_0x321125(0x113)](JSON[_0x321125(0x1ac)](defaults));await storageManager[_0x321125(0x148)](_0xf8b547['settings']);for(const _0x2d159a of _0xf8b547['topics']){const {subtopics:_0x586b56,..._0x366a6a}=_0x2d159a;await storageManager[_0x321125(0x11e)]('topics',_0x366a6a);for(const _0x2d0e0d of _0x586b56){await storageManager['add']('subtopics',{..._0x2d0e0d,'topicId':_0x2d159a['id']});}}_0x954820=_0xf8b547;}else{const _0x188ecd={};for(const _0x2e8fe2 of _0x1b3a2e)_0x188ecd[_0x2e8fe2['id']]={..._0x2e8fe2,'subtopics':[]};for(const _0x4fe50c of _0x3a2370)_0x188ecd[_0x4fe50c[_0x321125(0x197)]]?.[_0x321125(0x2d5)]['push'](_0x4fe50c);_0x954820={'version':defaults[_0x321125(0x26f)],'settings':_0x3df927,'topics':Object['values'](_0x188ecd)};}data=window[_0x321125(0x29f)]=_0x954820,normalizeDataStructure(data),await ensureValidSelection(),await seedAchievedMilestones(),renderAll();try{storageManager[_0x321125(0x271)](data);}catch(_0x17ff70){console[_0x321125(0x370)](_0x321125(0x165),_0x17ff70);}bindEvents(),applyTheme();}catch(_0x25bb56){console[_0x321125(0x12e)](_0x321125(0x353),_0x25bb56),toast(_0x321125(0x10c)+_0x25bb56[_0x321125(0x1a2)]);}}callGeminiAPI=async function(_0x56490c,_0x118558=0x3,_0x48d3a1=0x3e8){const _0x34e7b2=_0x1b5e35,_0x455cb7=data?.['settings']?.[_0x34e7b2(0x3e4)]||'';if(!_0x455cb7)return toast(_0x34e7b2(0x1dd)),null;const _0x1462ce=_0x34e7b2(0x22a)+_0x455cb7,_0x2fadc9={'contents':[{'role':_0x34e7b2(0x38b),'parts':[{'text':_0x56490c}]}]};try{const _0x12a60d=await fetch(_0x1462ce,{'method':_0x34e7b2(0x3aa),'headers':{'Content-Type':_0x34e7b2(0x355)},'body':JSON[_0x34e7b2(0x1ac)](_0x2fadc9)});if(!_0x12a60d['ok']){if(_0x12a60d['status']===0x1ad&&_0x118558>0x0)return await new Promise(_0xa249a6=>setTimeout(_0xa249a6,_0x48d3a1)),callGeminiAPI(_0x56490c,_0x118558-0x1,_0x48d3a1*0x2);let _0x23e5cc=null;try{_0x23e5cc=await _0x12a60d[_0x34e7b2(0x12c)]();}catch(_0x345334){}let _0x473c29=_0x34e7b2(0x19d)+_0x12a60d[_0x34e7b2(0x40e)];if(_0x12a60d[_0x34e7b2(0x40e)]===0x190)_0x473c29=_0x34e7b2(0x194);else{if(_0x12a60d[_0x34e7b2(0x40e)]===0x1ad)_0x473c29='Lỗi:\x20Đã\x20vượt\x20quá\x20hạn\x20mức\x20yêu\x20cầu\x20tới\x20Gemini.\x20Vui\x20lòng\x20thử\x20lại\x20sau\x20ít\x20phút.';else _0x23e5cc?.['error']?.[_0x34e7b2(0x1a2)]&&(_0x473c29=_0x34e7b2(0x151)+_0x23e5cc['error']['message']);}return toast(_0x473c29,0xfa0),console[_0x34e7b2(0x12e)](_0x34e7b2(0x245),_0x23e5cc||_0x12a60d[_0x34e7b2(0x231)]),null;}const _0x2fff44=await _0x12a60d[_0x34e7b2(0x12c)]();if(_0x2fff44['candidates']&&_0x2fff44[_0x34e7b2(0x233)][0x0]?.['content']?.[_0x34e7b2(0x260)]?.[0x0]?.[_0x34e7b2(0x276)])return formatGeminiResponse(_0x2fff44[_0x34e7b2(0x233)][0x0]['content'][_0x34e7b2(0x260)][0x0]['text']);else{console[_0x34e7b2(0x12e)](_0x34e7b2(0x184),_0x2fff44);if(_0x2fff44[_0x34e7b2(0x160)]?.[_0x34e7b2(0x22b)])return'Nội\x20dung\x20bị\x20chặn\x20vì:\x20'+_0x2fff44[_0x34e7b2(0x160)][_0x34e7b2(0x22b)]+_0x34e7b2(0x397);return'Không\x20nhận\x20được\x20nội\x20dung\x20hợp\x20lệ\x20từ\x20AI.';}}catch(_0x2dd6f3){return console[_0x34e7b2(0x12e)](_0x34e7b2(0x12b),_0x2dd6f3),toast('Lỗi\x20mạng\x20khi\x20kết\x20nối\x20đến\x20Gemini.\x20Vui\x20lòng\x20kiểm\x20tra\x20kết\x20nối\x20internet.',0xfa0),null;}},loadLanguage(localStorage['getItem'](_0x1b5e35(0x15e))||'vi')['then'](initializeApp);
    </script>
</body>
</html>
